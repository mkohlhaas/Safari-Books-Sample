<!--[if IE]><![endif]--><!DOCTYPE html><!--[if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/beginning-lua-programming/9780470069172/ch11.html"
data-csrf-cookie="csrfsafari"


  data-user-id="11366403"
  data-user-uuid="ce47de5b-ce80-49f0-b5cd-c60d3d33b198"
  data-username="michaelschiner"
  data-account-type="Trial"
  
  data-activated-trial-date="05/13/2021"


  data-archive="9780470069172"
  data-publishers="Wrox"



  data-htmlfile-name="ch11.html"
  data-epub-title="Beginning Lua Programming" data-debug=0 data-testing=0><![endif]--><!--[if gt IE 8]><!--><html class="no-js" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/beginning-lua-programming/9780470069172/ch11.html"
data-csrf-cookie="csrfsafari"


  data-user-id="11366403"
  data-user-uuid="ce47de5b-ce80-49f0-b5cd-c60d3d33b198"
  data-username="michaelschiner"
  data-account-type="Trial"
  
  data-activated-trial-date="05/13/2021"


  data-archive="9780470069172"
  data-publishers="Wrox"



  data-htmlfile-name="ch11.html"
  data-epub-title="Beginning Lua Programming" data-debug=0 data-testing=0><!--<![endif]--><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="author" content="O'Reilly Media" /><meta name="format-detection" content="telephone=no"><meta http-equiv="cleartype" content="on"/><meta name="HandheldFriendly" content="True"/><meta name="MobileOptimized" content="320"/><meta name="apple-itunes-app" content="app-id=881697395, app-argument=safaridetail://9780470069172"/><link rel="shortcut icon" href="https://www.oreilly.com/favicon.ico" /><meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0"/><meta property="twitter:account_id" content="4503599627559754" /><link rel="shortcut icon" href="https://learning.oreilly.com/favicon.ico" type="image/x-icon"><link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900,200italic,300italic,400italic,600italic,700italic,900italic' rel='stylesheet' type='text/css'><title>11. Exploring Lua&#39;s Libraries - Beginning Lua Programming</title><link rel="stylesheet" href="https://learning.oreilly.com/static/CACHE/css/output.5bdb4fcb2aad.css" type="text/css"><link rel="stylesheet" type="text/css" href="https://learning.oreilly.com/static/css/annotator.e3b0c44298fc.css"/><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css"><style type="text/css" title="ibis-book"></style><script> // <![CDATA[
    var g = {
      position_cache: {
        
          "chapter": "/api/v1/book/9780470069172/chapter/ch11.html",
          "book_id": "9780470069172",
          "chapter_uri": "ch11.html",
          "position": 0,
          "user_uuid": "ce47de5b-ce80-49f0-b5cd-c60d3d33b198",
          "next_chapter_uri": "/library/view/beginning-lua-programming/9780470069172/ch12.html"
        
      },
      title: "Beginning Lua Programming",
      author_list: "Aaron Brown, Kurt Jung",
      format: "book",
      source: "application/epub+zip",
      is_system_book: true,
      is_public: false,
      loaded_from_server: true,
      allow_scripts: false,
      has_mathml: false
    };
    // ]]></script><script src="https://learning.oreilly.com/static/js/src/modernizr.8e35451ddb64.js"></script><script>
    
      

      
        
          window.PUBLIC_ANNOTATIONS = true;
        
      

      window.MOBILE_PUBLIC_ANNOTATIONS = false;

    

    
      window.PRIVACY_CONTROL_OVERRIDE = false;
    

      window.PRIVACY_CONTROL_SWITCH = true;

      window.PUBLISHER_PAGES = true;

      window.SBO = {
        "constants": {
          "SITB_ENDPOINT": "/api/v2/sitb/",
          "SEARCH_SELECT_ENDPOINT": "https://learning.oreilly.com/api/v2/search/select/",
        }
      };
  </script><link rel="canonical" href="ch11.html"/><meta name="description" content="Chapter 11. Exploring Lua&#39;s Libraries Up to this point in the book you&#39;ve been learning about the fundamentals of Lua, occasionally using some of its library functions. In this chapter, ... "><meta property="og:title" content="11. Exploring Lua&#39;s Libraries" /><meta itemprop="isPartOf" content="/library/view/beginning-lua-programming/9780470069172/" /><meta itemprop="name" content="11. Exploring Lua&#39;s Libraries" /><meta property="og:url" itemprop="url" content="https://learning.oreilly.com/library/view/beginning-lua-programming/9780470069172/ch11.html" /><meta property="og:site_name" content="Safari" /><meta property="og:image" itemprop="thumbnailUrl" content="https://learning.oreilly.com/library/cover/9780470069172/" /><meta property="og:description" itemprop="description" content="Chapter 11. Exploring Lua&#39;s Libraries Up to this point in the book you&#39;ve been learning about the fundamentals of Lua, occasionally using some of its library functions. In this chapter, ... "><meta itemprop="inLanguage" content="en" /><meta itemprop="publisher" content="Wrox" /><meta property="og:type" content="book" /><meta property="og:book:isbn" itemprop="isbn" content="9780470069172" /><meta property="og:book:author" itemprop="author" content="Aaron Brown" /><meta property="og:book:author" itemprop="author" content="Kurt Jung" /><meta property="og:book:tag" itemprop="about" content="Core Programming" /><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@OReillyMedia"><style type="text/css" id="font-styles" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-size: <%= font_size %> !important; }"></style><style type="text/css" id="font-family" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-family: <%= font_family %> !important; }"></style><style type="text/css" id="column-width" data-template="#sbo-rt-content { max-width: <%= column_width %>% !important; margin: 0 auto !important; }"></style><noscript><meta http-equiv="refresh" content="0; URL=https://learning.oreilly.com/library/no-js/" /></noscript><script>
    var dataLayer = window.dataLayer || [];

    
      window.medalliaVsgUserIdentifier = 'ce47de5b-ce80-49f0-b5cd-c60d3d33b198';
      dataLayer.push({userIdentifier: 'ce47de5b-ce80-49f0-b5cd-c60d3d33b198'});
      dataLayer.push({loggedIn: 'yes'});

      
        window.medalliaVsgAccountIdentifier = '29964b7b-68d8-4532-9a9b-32e089689c1f';
        

        window.medalliaVsgIsIndividual = true;
        
          
          dataLayer.push({learningAccountType: 'free trial'});
          
        

        
      
    

    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-5P4V6Z');
    (function () {
      var VERSION = 'V1.1';
      var AUTHOR = 'Awwad';
      if (!window.GtmHelper)
        window.GtmHelper = function () {
          var instance = this;
          var loc = document.location;
          this.version = VERSION;
          this.author = AUTHOR;
          this.readCookie = function (name) {
            var nameEQ = name + "=";
            var ca = document.cookie.split(';');
            for (var i = 0; i < ca.length; i++) {
              var c = ca[i];
              while (c.charAt(0) == ' ') c = c.substring(1, c.length);
              if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
          };
          this.createCookie = function (name, value, days, cookieDomain) {
            var domain = "";
            var expires = "";

            if (days) {
              var date = new Date();
              date.setTime(date.getTime() + Math.ceil(days * 24 * 60 * 60 * 1000));
              var expires = " expires=" + date.toGMTString() + ";";
            }

            if (typeof (cookieDomain) != 'undefined')
              domain = " domain=" + cookieDomain + "; ";

            document.cookie = name + "=" + value + ";" + expires + domain + "path=/";
          };

          this.isDuplicated = function (currentTransactionId) {
            // the previous transaction id:
            var previousTransIdValue = this.readCookie("previousTransId");

            if (currentTransactionId === previousTransIdValue) {
              return true; // Duplication
            } else {
              return false;
            }
          };
        }
    })()
  </script><script defer src="https://learning.oreilly.com/static/js/build/vendor.0eac897f11ed.js"></script><script defer src="https://learning.oreilly.com/static/js/build/reader.c745ea9296ac.js"></script></head>


<body class="reading sidenav nav-collapsed  scalefonts">

    
  <noscript> 
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5P4V6Z"
            height="0" width="0"
            style="display:none;visibility:hidden">
    </iframe>
  </noscript>



    
      <div class="hide working" role="status">
        <div class="working-image"></div>
      </div>
      <div class="sbo-site-nav">
        

  


<a href="ch11.html#container" class="skip">Skip to content</a><header class="topbar t-topbar"><nav role="navigation" class="js-site-nav"><ul class="topnav"><li><a href="https://learning.oreilly.com/home/" class="l0 nav-icn"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.738 14H9.254v-3.676a.617.617 0 0 0-.621-.613H7.39a.617.617 0 0 0-.62.613V14H4.284a.617.617 0 0 1-.622-.613V10.22c0-.327.132-.64.367-.87l3.547-3.493a.627.627 0 0 1 .875 0l3.54 3.499c.234.229.366.54.367.864v3.167a.617.617 0 0 1-.62.613zM7.57 2.181a.625.625 0 0 1 .882 0l5.77 5.692-.93.92-5.28-5.209-5.28 5.208-.932-.919 5.77-5.692z" /></svg><span>Home</span></a></li><li class="search"><a href="ch11.html#" class="t-search-nav trigger nav-icn l0" data-dropdown-selector=".searchbox"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>search icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M31.3 0C20.9 0 12.5 8.4 12.5 18.8 12.5 22.5 13.6 25.9 15.4 28.8L1.2 42.9C-0.4 44.5-0.4 47.2 1.2 48.8 2 49.6 3.1 50 4.2 50 5.2 50 6.3 49.6 7.1 48.8L21.2 34.6C24.1 36.5 27.5 37.5 31.3 37.5 41.6 37.5 50 29.1 50 18.8 50 8.4 41.6 0 31.3 0ZM31.3 31.3C24.4 31.3 18.8 25.6 18.8 18.8 18.8 11.9 24.4 6.3 31.3 6.3 38.1 6.3 43.8 11.9 43.8 18.8 43.8 25.6 38.1 31.3 31.3 31.3Z"/></g></svg><span>Search</span></a></li><li class="usermenu dropdown"><a href="ch11.html#" class="trigger l0 nav-icn nav-dropdown"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>navigation arrow</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M0.1 12.5L9.7 3.1C9.8 3 9.9 3 10 3 10.1 3 10.2 3 10.3 3.1L19.9 12.5C20 12.5 20 12.6 20 12.8 20 12.9 20 13 19.9 13L17 15.9C16.9 16 16.8 16 16.7 16 16.5 16 16.4 16 16.4 15.9L10 9.7 3.6 15.9C3.6 16 3.5 16 3.3 16 3.2 16 3.1 16 3 15.9L0.1 13C0 12.9 0 12.8 0 12.7 0 12.7 0 12.6 0.1 12.5Z"/></g></svg><span>Expand Nav</span></a><div class="drop-content"><ul><li class="flyout-parent"><a
                href="ch11.html#"
                class="l1 nav-icn "
                
              ><?xml version="1.0" encoding="UTF-8"?><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M8,8 C6.34321755,8 5.00013,6.65691245 5.00013,5.00013 C5.00013,3.34334755 6.34321755,2.00026001 8,2.00026001 C9.65678245,2.00026001 10.99987,3.34334755 10.99987,5.00013 C10.99987,6.65691245 9.65678245,8 8,8 Z M2.33024571,11.3523547 L2.33774538,11.3523547 C3.7622187,9.70968996 5.82947484,8.76608166 8.00374984,8.76608166 C10.1780248,8.76608166 12.245281,9.70968996 13.6697543,11.3523547 C13.8892083,11.6177474 14.0062813,11.9530021 13.99974,12.2973138 L13.99974,13.99974 L2.00026001,13.99974 L2.00026001,12.2973138 C1.99371867,11.9530021 2.11079172,11.6177474 2.33024571,11.3523547 Z" id="path-1"></path></svg><span>Your O&#39;Reilly</span></a><ul class="flyout"><li><a
                    href="https://learning.oreilly.com/profile/"
                    class="l2 nav-icn"
                    
                  ><span>Profile</span></a></li><li><a
                    href="https://learning.oreilly.com/history/"
                    class="l2 nav-icn"
                    
                  ><span>History</span></a></li><li><a
                    href="https://learning.oreilly.com/playlists/"
                    class="l2 nav-icn"
                    
                  ><span>Playlists</span></a></li><li><a
                    href="https://learning.oreilly.com/u/ce47de5b-ce80-49f0-b5cd-c60d3d33b198/"
                    class="l2 nav-icn"
                    
                  ><span>Highlights</span></a></li></ul></li><li ><a
                href="https://learning.oreilly.com/answers/"
                class="l1 nav-icn "
                
              ><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path d="M2.31032699,3.75609006 C4.65421571,1.41371359 8.45302454,1.41472092 10.7955702,3.75860838 C13.1381158,6.10249583 13.1369405,9.90130261 10.7930518,12.243847 C8.44916311,14.5863913 4.65018639,14.5852161 2.30780867,12.2413286 C-0.0346204845,9.89749489 -0.0334929936,6.09853298 2.31032699,3.75609006 Z M8.8198605,4.98016308 C7.34193969,3.86924672 5.23410194,3.98609692 3.88914868,5.33104946 C3.12814393,6.09032122 2.72818176,7.13880077 2.79015179,8.21201133 C2.79115912,8.23064692 2.79233434,8.24928252 2.79350956,8.26791811 L2.79350956,8.26791811 C2.83179539,8.8307976 2.9944077,9.37404287 3.26947292,9.86201677 L3.26947292,9.86201677 L2.77621706,11.7027432 C2.7699968,11.7259241 2.77662063,11.7506624 2.79359185,11.7676337 C2.8105631,11.7846049 2.83530144,11.7912287 2.85848233,11.7850085 L2.85848233,11.7850085 L4.69400524,11.2922565 C5.26306363,11.6167344 5.90703177,11.786885 6.56209849,11.7858479 C8.64827865,11.7858479 10.3395879,10.094542 10.3395879,8.00836292 C10.3405204,6.84135608 9.80105674,5.73967784 8.87862141,5.02482134 L8.87862141,5.02482134 L8.82825492,4.98654283 Z M13.7933062,2 C14.7073496,2.00009863 15.4482759,2.74110484 15.4482759,3.65514822 C15.4482759,4.32460943 15.0449926,4.92814782 14.4264842,5.18432286 C13.8079757,5.44049789 13.096053,5.29885769 12.6226979,4.82545158 C12.1493429,4.35204547 12.0077795,3.64010743 12.2640213,3.02162665 C12.5202631,2.40314587 13.123845,1.99992776 13.7933062,2 Z"/></svg><span>Answers</span></a></li><li class="flyout-parent"><a
                href="ch11.html#"
                class="l1 nav-icn "
                
              ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>queue icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 29.2C25.4 29.2 25.8 29.1 26.1 28.9L48.7 16.8C49.5 16.4 50 15.5 50 14.6 50 13.7 49.5 12.8 48.7 12.4L26.1 0.3C25.4-0.1 24.6-0.1 23.9 0.3L1.3 12.4C0.5 12.8 0 13.7 0 14.6 0 15.5 0.5 16.4 1.3 16.8L23.9 28.9C24.2 29.1 24.6 29.2 25 29.2ZM7.3 14.6L25 5.2 42.7 14.6 25 24 7.3 14.6ZM48.7 22.4L47.7 21.9 25 34.2 2.3 21.9 1.3 22.4C0.5 22.9 0 23.7 0 24.7 0 25.6 0.5 26.5 1.3 26.9L23.9 39.3C24.2 39.5 24.6 39.6 25 39.6 25.4 39.6 25.8 39.5 26.1 39.3L48.7 26.9C49.5 26.5 50 25.6 50 24.7 50 23.7 49.5 22.9 48.7 22.4ZM48.7 32.8L47.7 32.3 25 44.6 2.3 32.3 1.3 32.8C0.5 33.3 0 34.1 0 35.1 0 36 0.5 36.9 1.3 37.3L23.9 49.7C24.2 49.9 24.6 50 25 50 25.4 50 25.8 49.9 26.1 49.7L48.7 37.3C49.5 36.9 50 36 50 35.1 50 34.1 49.5 33.3 48.7 32.8Z"/></g></svg><span>Explore</span></a><ul class="flyout"><li><a
                    href="https://learning.oreilly.com/topics/"
                    class="l2 nav-icn"
                    
                  ><span>All Topics</span></a></li><li><a
                    href="https://learning.oreilly.com/search/?query=&amp;extended_publisher_data=true&amp;highlight=true&amp;include_assessments=false&amp;include_case_studies=true&amp;include_courses=true&amp;include_orioles=true&amp;include_playlists=true&amp;include_collections=true&amp;include_notebooks=true&amp;is_academic_institution_account=false&amp;source=user&amp;formats=book&amp;formats=case%20study&amp;formats=learning%20path&amp;formats=live%20online%20training&amp;formats=notebook&amp;formats=oriole&amp;formats=video&amp;sort=popularity&amp;facet_json=true&amp;page=0&amp;collection_type=expert"
                    class="l2 nav-icn"
                    
                  ><span>Most Popular Titles</span></a></li><li><a
                    href="https://learning.oreilly.com/recommendations/"
                    class="l2 nav-icn"
                    
                  ><span>Recommended</span></a></li><li><a
                    href="https://learning.oreilly.com/search/?query=&amp;extended_publisher_data=true&amp;highlight=true&amp;include_assessments=false&amp;include_case_studies=true&amp;include_courses=true&amp;include_orioles=true&amp;include_playlists=true&amp;include_collections=true&amp;include_notebooks=true&amp;is_academic_institution_account=false&amp;source=user&amp;formats=book&amp;sort=publication_date&amp;facet_json=true&amp;page=0"
                    class="l2 nav-icn"
                    
                  ><span>Early Releases</span></a></li><li><a
                    href="https://learning.oreilly.com/playlists/discover/"
                    class="l2 nav-icn"
                    
                  ><span>Shared Playlists</span></a></li><li><a
                    href="https://learning.oreilly.com/resource-centers/"
                    class="l2 nav-icn"
                    
                  ><span>Resource Centers</span></a></li></ul></li><li class="flyout-parent"><a
                href="ch11.html#"
                class="l1 nav-icn "
                
              ><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M12.8 3.2A1.2 1.2 0 0 1 14 4.4v8.4a1.2 1.2 0 0 1-1.2 1.2H3.2A1.2 1.2 0 0 1 2 12.8V4.4a1.2 1.2 0 0 1 1.2-1.2h1.2V2h1.2v1.2h4.8V2h1.2v1.2h1.2zm-9.6 9.6h9.6V6.2H3.2v6.6zM8 9.5a1.35 1.35 0 1 1 0-2.7 1.35 1.35 0 0 1 0 2.7zm2.7 2.148v.552H5.3v-.552c0-.321.124-.634.355-.858a3.358 3.358 0 0 1 4.69 0c.23.224.355.537.355.858z" /></svg><span>Live Events</span></a><ul class="flyout"><li><a
                    href="https://learning.oreilly.com/attend/"
                    class="l2 nav-icn"
                    
                  ><span>All Events</span></a></li><li><a
                    href="https://learning.oreilly.com/featured/architectural-katas/"
                    class="l2 nav-icn"
                    
                  ><span>Architectural Katas</span></a></li><li><a
                    href="https://learning.oreilly.com/featured/ai/"
                    class="l2 nav-icn"
                    
                  ><span>AI &amp; ML</span></a></li><li><a
                    href="https://learning.oreilly.com/featured/strata/"
                    class="l2 nav-icn"
                    
                  ><span>Data Sci &amp; Eng</span></a></li><li><a
                    href="https://learning.oreilly.com/featured/oscon/"
                    class="l2 nav-icn"
                    
                  ><span>Programming</span></a></li><li><a
                    href="https://learning.oreilly.com/featured/infrastructure-ops/"
                    class="l2 nav-icn"
                    
                  ><span>Infra &amp; Ops</span></a></li><li><a
                    href="https://learning.oreilly.com/featured/software-architecture/"
                    class="l2 nav-icn"
                    
                  ><span>Software Arch</span></a></li></ul></li><li class="flyout-parent"><a
                href="ch11.html#"
                class="l1 nav-icn "
                
              ><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.6467109,4.35328907 L14.7964612,7.51003884 C15.0678463,7.78304342 15.0678463,8.22395603 14.7964612,8.49696061 L11.6467109,11.6467109 L10.6597892,10.6597892 L13.3055794,8 L10.6597892,5.34021084 L11.6467109,4.35328907 Z M4.35328907,11.6467109 L1.20353875,8.48996116 C0.932153749,8.21695658 0.932153749,7.77604397 1.20353875,7.50303939 L4.35328907,4.35328907 L5.34021084,5.34021084 L2.69442057,8 L5.34021084,10.6597892 L4.35328907,11.6467109 Z M5.84417089,11.4997226 L8.67194674,4.50027742 L10.1838269,4.50027742 L7.35605105,11.4997226 L5.84417089,11.4997226 Z" id="Mask"></path></svg><span>Interactive</span></a><ul class="flyout"><li><a
                    href="https://learning.oreilly.com/scenarios/?classification=content-scenario"
                    class="l2 nav-icn"
                    
                  ><span>Scenarios</span></a></li><li><a
                    href="https://learning.oreilly.com/scenarios/?classification=sandbox-scenario"
                    class="l2 nav-icn"
                    
                  ><span>Sandboxes</span></a></li><li><a
                    href="https://learning.oreilly.com/interactive/?classification=jupyter-notebook"
                    class="l2 nav-icn"
                    
                  ><span>Jupyter Notebooks</span></a></li></ul></li><li ><a
                href="https://learning.oreilly.com/certifications/"
                class="l1 nav-icn "
                
              ><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path d="M12.912 9.18L14 8.014l-1.088-1.18a.304.304 0 01-.075-.268L13.195 5l-1.535-.463a.313.313 0 01-.194-.194l-.462-1.537-1.565.358c-.09.03-.194 0-.269-.074L8.007 2 6.845 3.09a.303.303 0 01-.269.074l-1.565-.358-.462 1.537a.313.313 0 01-.194.194L2.82 5l.358 1.567a.26.26 0 01-.075.269L2 8.015l1.088 1.164c.075.075.09.18.075.269l-.358 1.567 1.535.463c.09.03.164.104.194.194l.462 1.537 1.565-.358c.015 0 .045-.015.075-.015.075 0 .15.03.209.074L8.007 14l1.163-1.09a.303.303 0 01.269-.074l1.565.358.462-1.537a.313.313 0 01.194-.194L13.195 11l-.358-1.567a.338.338 0 01.075-.254zm-6.046 1.37L4.41 8.26l1.16-1.244 1.767 1.649L10.4 5.6l1.202 1.202-4.242 4.243-.495-.495z"/></svg><span>Certifications</span></a></li><li ><a
                href="https://learning.oreilly.com/preferences/"
                class="l1 nav-icn "
                
              ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"/></g></svg><span>Settings</span></a></li><li ><a
                href="https://learning.oreilly.com/public/support/"
                class="l1 nav-icn "
                
              ><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M7.363 6.656a2.692 2.692 0 0 1-2.681-2.703c0-1.493 1.2-2.703 2.681-2.703a2.692 2.692 0 0 1 2.682 2.703c0 1.493-1.2 2.703-2.682 2.703zm4.023 2.027c-1.852 0-3.352 1.513-3.352 3.379H2v-1.534c-.006-.31.099-.612.295-.852a6.666 6.666 0 0 1 9.09-.993zm-.543.676h1.12v.304c.003.284.16.543.408.676a.766.766 0 0 0 .77 0l.303-.176.556.966-.302.176a.772.772 0 0 0-.362.676v.08a.772.772 0 0 0 .362.677l.302.21-.556.965-.302-.175a.766.766 0 0 0-.771 0 .778.778 0 0 0-.409.675v.352h-1.106v-.372a.778.778 0 0 0-.409-.676.766.766 0 0 0-.77 0l-.303.176-.556-.912.302-.176a.772.772 0 0 0 .362-.676v-.04-.04a.772.772 0 0 0-.362-.676l-.302-.176.556-.966.289.155a.766.766 0 0 0 .77 0 .778.778 0 0 0 .41-.676V9.36zm1.562 2.703c0-.271-.108-.531-.3-.722a1.001 1.001 0 0 0-.72-.292 1.01 1.01 0 0 0-.992 1.023 1.01 1.01 0 0 0 1.01 1.004 1.01 1.01 0 0 0 1.002-1.013z" /></svg><span>Support</span></a></li><li ><a
                href="https://get.oreilly.com/email-signup.html"
                class="l1 nav-icn "
                target=&quot;_blank&quot;
              ><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.564 2.263l2.172 2.174c.17.168.264.397.264.636V11a.6.6 0 0 1-.6.6h-.6V6.2h-6V2.6a.6.6 0 0 1 .6-.6h3.527c.239 0 .468.095.637.263zM2.6 14a.6.6 0 0 1-.6-.6V6.8a.6.6 0 0 1 .6-.6h1.903a1.2 1.2 0 0 1 .849.352L6.2 7.4H11a.6.6 0 0 1 .6.6v5.4a.6.6 0 0 1-.6.6H2.6zM11 5h1.8L11 3.2V5z" /></svg><span>Newsletters</span></a></li><li ><a
                href="https://learning.oreilly.com/accounts/logout/"
                class="l1 nav-icn "
                
              ><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M2.613 12.63A.607.607 0 0 1 2 12.03V3.602C2 3.269 2.274 3 2.613 3h5.515v1.204H3.226v7.223h4.902v1.203H2.613zM5.677 9.02V6.611h4.903V4.926a.301.301 0 0 1 .19-.274.31.31 0 0 1 .33.063l2.722 2.673a.594.594 0 0 1 0 .849L11.1 10.909a.31.31 0 0 1-.331.063.301.301 0 0 1-.19-.274V9.02H5.677z" /></svg><span>Sign Out</span></a></li></ul></div></li></ul></nav></header>



      </div>
      <div id="container" class="application">
        
          <div class="nav-container clearfix">
            


            
            
          </div>

          

  <div class="js-toc">
    
      <div class="sbo-reading-menu sbo-menu-top"><section class="sbo-toc-container toc-menu"><a href="ch11.html#" class="sbo-toc-thumb"><span class="sbo-title ss-list"><h1><div class="visuallyhidden">Table of Contents for </div>
      
      Beginning Lua Programming
      
    </h1></span></a><div class="toc-contents"></div></section></div>

    

    <div class="interface-controls interface-controls-top">
      <ul class="interface-control-btns js-bitlist js-reader">
        <li class="js-search-in-archive search-in-archive t-search-in-archive"><a href="ch11.html#" title="Search in archive" class="js-search-controls search-controls" onclick="window.Appcues.track('SearchBook_HeronBook')"><span class="icon">Search in book...</span></a><form class="search-archive-bar js-search-form"><input type="search" name="query" placeholder="Search inside this book..." autocomplete="off"></form><div class="search-archive-results"><div class="js-sitb-results-region"></div></div></li><li class="queue-control"><div class="js-content-uri" data-content-uri="/api/v1/book/9780470069172/chapter/ch11.html"><div class="js-collections-dropdown collections-dropdown menu-bit-cards" onclick="window.Appcues.track('AddPlaylist_HeronBook')"></div></div></li><li class="js-font-control-panel font-control-activator"><a href="ch11.html#" data-push-state="false" id="font-controls" title="Change font size" aria-label="Change font size" onclick="window.Appcues.track('ChangeFont_HeronBook')"><span class="icon">Toggle Font Controls</span></a></li><li class="dropdown sharing-controls"><a href="ch11.html#" class="trigger" data-push-state="false" title="Share" aria-label="Share" onclick="window.Appcues.track('Share_HeronBook')"><i class="fa fa-share"></i></a><ul class="social-sharing dropdown-menu"><li><a
        class="twitter share-button t-twitter"
        target="_blank"
        aria-label="Share this section on Twitter"
        title="Share this section on Twitter"
      
        href="https://twitter.com/share?url=https://learning.oreilly.com/library/view/beginning-lua-programming/9780470069172/ch11.html&text=Beginning%20Lua%20Programming&via=OReillyMedia"
      ><span>Twitter</span></a></li><li><a
        class="facebook share-button t-facebook"
        target="_blank"
        aria-label="Share this section on Facebook"
        title="Share this section on Facebook"
        href="https://www.facebook.com/sharer/sharer.php?u=https://learning.oreilly.com/library/view/beginning-lua-programming/9780470069172/ch11.html"
      ><span>Facebook</span></a></li><li><a
        class="googleplus share-button t-googleplus"
        target="_blank"
        aria-label="Share this secton on Google Plus"
        title="Share this secton on Google Plus"
        href="https://plus.google.com/share?url=https://learning.oreilly.com/library/view/beginning-lua-programming/9780470069172/ch11.html"
      ><span>Google Plus</span></a></li><li><a
        class="email share-button t-email"
        aria-label="Share this section via email"
        title="Share this section via email"
      
        href="mailto:?subject=Safari: 11.%20Exploring%20Lua%27s%20Libraries&body=https://learning.oreilly.com/library/view/beginning-lua-programming/9780470069172/ch11.html%0D%0Afrom Beginning%20Lua%20Programming%0D%0A"
      ><span>Email</span></a></li></ul></li><!-- endif request.user.is_authenticated -->
      </ul>
    </div>

      
          
      

    <section role="document">
        
        




  <script defer src="https://learning.oreilly.com/static/js/build/djangoMessagesPage.bfaca9fd8619.js"></script>


        <script src="https://fast.appcues.com/48743.js"></script>
<script>
  var userId = "ce47de5b-ce80-49f0-b5cd-c60d3d33b198";

  var userObject = {
    firstName: "Michael",
    segment: "Trial",
    admin: "False",
    profileCreatedOn: "2021-05-13",
    academic: ""
  };
  window.Appcues.identify(userId, userObject);
  window.Appcues.page();

  setTimeout(function () {
    window.Appcues.track('ViewingBook_HeronBook')
  }, 20000);
</script>


	  <div class="t-sbo-prev sbo-prev sbo-nav-top">
  
    
      
        <a href="ch10.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">10. Looking Under the Hood</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-top">
  
    
      
        <a href="ch12.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">12. Using Community Libraries</div>
        </a>
    
  
  </div>



<div id="sbo-rt-content"><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="exploring_lua_apostrophy_s_libraries"></a>Chapter 11. Exploring Lua's Libraries</h1></div></div></div><p>Up to this point in the book you've been learning about the fundamentals of Lua, occasionally using some of its library functions. In this chapter, all of Lua's standard library functions are briefly summarized to remind you of their basic usage. Practically every function has many more features than can be covered in detail within the scope of this book, and the examples that are included here are mostly contrived for brevity. (For the definitive documentation of these features, see the <span class="emphasis"><em>Lua Reference Manual</em></span>.)<a id="IDX-CHP-11-0001" class="indexterm"></a><a id="IDX-CHP-11-0002" class="indexterm"></a><a id="IDX-CHP-11-0003" class="indexterm"></a></p><p>In this chapter, you'll find summaries of the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>General-purpose functions in the core library</p></li><li class="listitem"><p>Functions that manage coroutines</p></li><li class="listitem"><p>Package functions that implement Lua's module system</p></li><li class="listitem"><p>String conversion and pattern matching functions</p></li><li class="listitem"><p>Functions that help with using tables as arrays</p></li><li class="listitem"><p>Bindings to the C runtime library's math functions</p></li><li class="listitem"><p>Functions for reading from and writing to files and streams</p></li><li class="listitem"><p>Operating system functions</p></li><li class="listitem"><p>Functions to help with debugging your Lua programs</p></li></ul></div><p>An example is provided for each function or group of functions.</p><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="core_library"></a>Core Library</h1></div></div></div><p>The core library functions reside in the global environment. They have no containing namespace table.</p><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="environment_functions"></a>Environment Functions</h2></div></div></div><p>The following functions let you set and retrieve a function's environment—the table that Lua uses to resolve global references—and get or set the global environment of the running thread when given a stack level of 0:<a id="IDX-CHP-11-0004" class="indexterm"></a><a id="IDX-CHP-11-0005" class="indexterm"></a><a id="IDX-CHP-11-0006" class="indexterm"></a><a id="IDX-CHP-11-0007" class="indexterm"></a><a id="IDX-CHP-11-0008" class="indexterm"></a><a id="IDX-CHP-11-0009" class="indexterm"></a><a id="IDX-CHP-11-0010" class="indexterm"></a><a id="IDX-CHP-11-0011" class="indexterm"></a><a id="IDX-CHP-11-0012" class="indexterm"></a><a id="IDX-CHP-11-0013" class="indexterm"></a><a id="IDX-CHP-11-0014" class="indexterm"></a></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">getfenv</code>(<span class="emphasis"><em>optional function or stack level</em></span>): Returns the environment table of the given function, or the function running at the given stack level. The argument defaults to <code class="literal">1</code>, which is the stack level of the current function (the one calling <code class="literal">getfenv</code>).</p></li><li class="listitem"><p><code class="literal">setfenv</code>(<span class="emphasis"><em>function or stack level, environment table</em></span>): Gives an environment table to the given function or the function at the given stack level, and returns the function.</p></li></ul></div><p>This example demonstrates how you can set a global environment for a particular function:</p><pre class="programlisting">Str = "Global"

function Sandbox()
  print(getfenv(), Str)
end

setfenv(Sandbox, {print = print, getfenv = getfenv, Str = "Sandbox"})
Sandbox()
print(getfenv(), Str)</pre><p>The output generated by the example shows how the value of the global variable <code class="literal">Str</code> depends on the environment:</p><pre class="programlisting">table: 00765740 Sandbox
table: 00760300 Global</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="metatable_functions"></a>Metatable Functions</h2></div></div></div><p>These functions let you set, retrieve, and circumvent metatables, the mechanism by which you can modify the default behavior for various operations:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">getmetatable</code>(<span class="emphasis"><em>value</em></span>): Returns its argument's __<code class="literal">metatable</code> metamethod, its argument's metatable if there is no __<code class="literal">metatable</code> metamethod, or <code class="literal">nil</code> if there is no metatable.</p></li><li class="listitem"><p><code class="literal">setmetatable</code>(<span class="emphasis"><em>table, metatable</em></span>): Gives a metatable to a table. An error will be triggered if the table has a __<code class="literal">metatable</code> metamethod.</p></li><li class="listitem"><p><code class="literal">rawequal</code>(<span class="emphasis"><em>first value, second value</em></span>): Returns true if the two values are equal, bypassing any metamethods.</p></li><li class="listitem"><p><code class="literal">rawget</code>(<span class="emphasis"><em>table, index</em></span>): Retrieves <span class="emphasis"><em>table</em></span>[<span class="emphasis"><em>index</em></span>], bypassing any metamethods.</p></li><li class="listitem"><p><code class="literal">rawset</code>(<span class="emphasis"><em>table, index, value</em></span>): Assigns a value to <span class="emphasis"><em>table</em></span>[<span class="emphasis"><em>index</em></span>], bypassing any metamethods.</p></li></ul></div><p>This example shows how you can use the __<code class="literal">eq</code> metamethod to modify the way that the equality operator works for tables:</p><pre class="programlisting">MtTbl = {__eq = function(T1, T2) return T1.Val == T2.Val end}
A = {Val = 10}
setmetatable(A, MtTbl)
B = {Val = 10}
setmetatable(B, MtTbl)
C = {Val = 12}
setmetatable(C, MtTbl)
print(MtTbl, getmetatable(A), getmetatable(B), getmetatable(C))
print("A == B", A == B)
print("A == C", A == C)
print("rawequal(A, B)", rawequal(A, B))
print("rawequal(A, C)", rawequal(A, C))</pre><p>The example generates the following output, demonstrating that the <code class="literal">__eq</code> metamethod is engaged by the equality operator and bypassed with the <code class="literal">rawequal</code> function:</p><pre class="programlisting">table: 00765530 table: 00765530 table: 00765530 table: 00765530
A == B true
A == C false
rawequal(A, B) false
rawequal(A, C) false</pre><p>This example illustrates how extra functionality can be attached to the assignment and retrieval of a table's field.</p><pre class="programlisting">local function WindowCreate(TitleStr)

  local function WindowTextGet()
    -- Simulate GUI call
   io.write(" Retrieving ", TitleStr, "\n")
   return TitleStr
 end

 local function WindowTextSet(Str)
   -- Simulate GUI call
   local OldTitleStr = TitleStr
   io.write(" Setting ", Str, "\n")
   TitleStr = Str
   return OldTitleStr
 end

 local function MtIndex(Tbl, Key)
   return Key == "Title" and WindowTextGet() or Tbl[Key]
 end

 local function MtNewIndex(Tbl, Key, Val)
   if Key == "Title" then
     WindowTextSet(Val)
   else
     Tbl[Key] = Val
   end
 end</pre><pre class="programlisting">local Wnd, MtTbl = {}, {__index = MtIndex, __newindex = MtNewIndex}

  setmetatable(Wnd, MtTbl)

  return Wnd

end

local Wnd = WindowCreate("Title 1")
local Str = Wnd.Title
io.write("1 ", Str, "\n")
Wnd.Title = "Title 2"
Str = Wnd.Title
io.write("2 ", Str, "\n")
rawset(Wnd, "Title", "Title 3")
Str = rawget(Wnd, "Title")
io.write("3 ", Str, "\n")
Wnd.Title = "Title 4" -- No metamethod
Str = Wnd.Title -- No metamethod
io.write("4 ", Str, "\n")</pre><p>The output of the example shows how metamethods can define new behavior for indexing and assignments operations. Note that the use of <code class="literal">rawset</code> creates a field named <code class="literal">Title</code> in the <code class="literal">Wnd</code> table, effectively disabling the use of metamethods for subsequent indexing and assignments:<a id="IDX-CHP-11-0015" class="indexterm"></a><a id="IDX-CHP-11-0016" class="indexterm"></a><a id="IDX-CHP-11-0017" class="indexterm"></a><a id="IDX-CHP-11-0018" class="indexterm"></a><a id="IDX-CHP-11-0019" class="indexterm"></a><a id="IDX-CHP-11-0020" class="indexterm"></a><a id="IDX-CHP-11-0021" class="indexterm"></a></p><pre class="programlisting">Retrieving Title 1
1 Title 1
  Setting Title 2
  Retrieving Title 2
2 Title 2
3 Title 3
4 Title 4</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="chunk-loading_functions"></a>Chunk-Loading Functions</h2></div></div></div><p>The chunk-loading functions generate a function from a Lua chunk. The chunk can be in either source or precompiled form. Specifically, each of these functions does the following:<a id="IDX-CHP-11-0022" class="indexterm"></a></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">dofile(</code><span class="emphasis"><em>optional name of file</em></span><code class="literal">)</code>: Executes the specified Lua script, or standard input if the filename is missing.</p></li><li class="listitem"><p><code class="literal">load(</code><span class="emphasis"><em>loader function, optional chunk name</em></span><code class="literal">)</code>: Repeatedly calls the loader function to build up a Lua chunk. Each time the loader function is called it returns the next portion of the Lua script in the form of a string. When the entire script has been loaded, the loader function must return <code class="literal">nil</code>, at which point <code class="literal">load</code> compiles the chunk and returns the function without running it.</p></li><li class="listitem"><p><code class="literal">loadfile(</code><span class="emphasis"><em>optional name of file</em></span><code class="literal">)</code>: Loads the specified file as a Lua chunk and returns the compiled function without running it.</p></li><li class="listitem"><p><code class="literal">loadstring(</code><span class="emphasis"><em>script string, optional name</em></span><code class="literal">)</code>: Loads the specified string as a Lua chunk and returns the compiled function without running it.</p></li></ul></div><p>The following example demonstrates the preceding functions with a simple Lua chunk that simply prints the arguments that are passed to it. The first iteration of the loop loads the chuck in source form, the second in precompiled form:</p><pre class="programlisting">local FileStr = "test.lua"

for J = 1, 2 do
  local LuaStr
  if J == 1 then
    io.write("=== Source chunk ===\n")
    LuaStr = "print('source', ...)"
  else
    io.write("=== Compiled chunk ===\n")
    LuaStr = string.dump(function(...) print('compiled', ...) end)
  end
  local Hnd = io.open(FileStr, "wb")
  if Hnd then
    Hnd:write(LuaStr)
    Hnd:close()
    io.write("[dofile]  ")
    dofile(FileStr)
    io.write("[loadfile] ")
    local Fnc, ErrStr = loadfile(FileStr)
    if Fnc then
      Fnc(1, 2, 3)
      io.write("[loadstring] ")
      Fnc, ErrStr = loadstring(LuaStr)
      if Fnc then
        Fnc(1, 2, 3)
        io.write("[load]  ")
        local RetStr = LuaStr
        local function Loader()
          local Ret = RetStr
          RetStr = nil
          return Ret
        end
        Fnc, ErrStr = load(Loader)
        if Fnc then
          Fnc(1, 2, 3)
        else
          io.write(ErrStr, "\n")
        end
      else
        io.write(ErrStr, "\n")
      end
    else
      io.write(ErrStr, "\n")
    end
  else
    io.write("Error opening ", FileStr, " for writing\n")
  end
end
os.remove(FileStr)</pre><p>The example generates the following output:<a id="IDX-CHP-11-0023" class="indexterm"></a><a id="IDX-CHP-11-0024" class="indexterm"></a><a id="IDX-CHP-11-0025" class="indexterm"></a><a id="IDX-CHP-11-0026" class="indexterm"></a><a id="IDX-CHP-11-0027" class="indexterm"></a></p><pre class="programlisting">=== Source chunk ===
[dofile]       source
[loadfile]     source    1      2      3
[loadstring]   source    1      2      3
[load]         source    1      2      3
=== Compiled chunk ===
[dofile]       compiled
[loadfile]     compiled  1      2      3
[loadstring]   compiled  1      2      3
[load]         compiled  1      2      3</pre><p>Note that chunks executed with <code class="literal">dofile</code> can't accept arguments. Note also that all of the functions handle source chunks and precompiled chunks correctly.</p></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="error-containment_functions-033"></a>Error-Containment Functions</h2></div></div></div><p>These functions are used to keep runtime errors from propagating toward the host program:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">pcall(</code><span class="emphasis"><em>function, optional arguments</em></span><code class="literal">)</code>: The specified function is called with the specified arguments. In the event of an error, a one-line message is generated.</p></li><li class="listitem"><p><code class="literal">xpcall(</code><span class="emphasis"><em>function, error handler</em></span><code class="literal">)</code>: The specified function is called. In the event of an error, the specified error handler is invoked before the stack is reset, allowing a stack traceback to be constructed. The handler is passed an error string and returns an augmented error string.</p></li></ul></div><p>If the specified function runs without errors, both <code class="literal">pcall</code> and <code class="literal">xpcall</code> return <code class="literal">true</code> followed by the function's own return values. If an error occurs, <code class="literal">false</code> is returned followed by the error message.</p><p>This example shows how a runtime error can be caught and managed within a Lua program.</p><pre class="programlisting">io.write("Start of tests\n")
io.write("-- pcall --\n")
local BadLuaStr = "print('Intentional error ahead', ...) error('crash')"
Fnc, ErrStr = loadstring(BadLuaStr, "Demonstration")
if Fnc then
  local Code, ErrStr = pcall(Fnc, "pcall")
  if not Code then
    io.write("[pcall error] ", ErrStr, "\n")
  end
  io.write("-- xpcall --\n")
  local Code, ErrStr = xpcall(Fnc, debug.traceback)
  if not Code then
    io.write("[xpcall error] ", ErrStr, "\n")
  end
else
  io.write("[loadstring error] ", ErrStr, "\n")
end
io.write("End of tests\n")</pre><p>The example generates the following output, showing that the script recovers from both errors:<a id="IDX-CHP-11-0028" class="indexterm"></a><a id="IDX-CHP-11-0029" class="indexterm"></a><a id="IDX-CHP-11-0030" class="indexterm"></a><a id="IDX-CHP-11-0031" class="indexterm"></a><a id="IDX-CHP-11-0032" class="indexterm"></a><a id="IDX-CHP-11-0033" class="indexterm"></a></p><pre class="programlisting">Start of tests
<em class="replaceable"><code>-- pcall --</code></em>
Intentional error ahead pcall
[pcall error] [string "Demonstration"]:1: crash
<em class="replaceable"><code>-- xpcall --</code></em>
Intentional error ahead
[xpcall error] [string "Demonstration"]:1: crash
stack traceback:
       [C]: in function 'error'
       [string "Demonstration"]:1: in main chunk
       [C]: in function 'xpcall'
       test.lua:11: in main chunk
       [C]: ?
End of tests</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="module_functions"></a>Module Functions</h2></div></div></div><p>These functions are Lua's means to modularize your programs:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">module(</code><span class="emphasis"><em>module name, zero or more preparation functions</em></span><code class="literal">)</code>: Modularizes a script, storing all new global variables in a namespace table. This table will be assigned to a global variable with the specified module name. Any functions that are specified are called in turn with the namespace table as an argument. The <code class="literal">package.seeall</code> function is commonly used in this capacity.</p></li><li class="listitem"><p><code class="literal">require(</code><span class="emphasis"><em>module name</em></span><code class="literal">)</code>: Loads and executes the specified Lua file following a well-defined protocol.<a id="IDX-CHP-11-0034" class="indexterm"></a></p></li></ul></div><div class="blockquote"><blockquote class="blockquote"><p>See the <code class="literal">package</code> library functions for related functions.</p></blockquote></div><p>The following example generates a little module that simply assigns a greeting to a string, and then loads the module using Lua's module system:</p><pre class="programlisting">io.output("testmod.lua")
io.write [[module(...)

Str = "Hello from " .. (...)
]]

io.close()
io.output(io.stdout)
package.path = "?.lua"
require("testmod")
io.write(testmod.Str, "\n")</pre><p>The following output from the example shows that the module is successfully loaded:</p><pre class="programlisting">Hello from testmod</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="the_garbage-collection_function"></a>The Garbage-Collection Function</h2></div></div></div><p>Garbage collection refers to the automatic reclamation of memory used by Lua values that can no longer be accessed by your program. It has one function:<a id="IDX-CHP-11-0035" class="indexterm"></a><a id="IDX-CHP-11-0036" class="indexterm"></a><a id="IDX-CHP-11-0037" class="indexterm"></a><a id="IDX-CHP-11-0038" class="indexterm"></a><a id="IDX-CHP-11-0039" class="indexterm"></a><a id="IDX-CHP-11-0040" class="indexterm"></a><a id="IDX-CHP-11-0041" class="indexterm"></a><a id="IDX-CHP-11-0042" class="indexterm"></a><a id="IDX-CHP-11-0043" class="indexterm"></a><a id="IDX-CHP-11-0044" class="indexterm"></a></p><div class="blockquote"><blockquote class="blockquote"><p><code class="literal">collectgarbage</code>("<code class="literal">collect</code>" <span class="emphasis"><em>or</em></span> "<code class="literal">count</code>" <span class="emphasis"><em>or</em></span> "<code class="literal">restart</code>" <span class="emphasis"><em>or</em></span> "<code class="literal">setpause</code>" <span class="emphasis"><em>or</em></span> "<code class="literal">setstepmul</code>" <span class="emphasis"><em>or</em></span> "<code class="literal">step</code>" <span class="emphasis"><em>or</em></span> "<code class="literal">stop</code>" <span class="emphasis"><em>, optional extra argument</em></span> )</p></blockquote></div><p>This function performs one of actions described in the following table based on the value of the first argument.</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col1"><col class="col2"></colgroup><thead><tr><th style="text-align: left" valign="bottom"><p>Action</p></th><th style="text-align: left" valign="bottom"><p>Description</p></th></tr></thead><tbody><tr><td style="text-align: left" valign="top"><p>"<code class="literal">collect</code>"</p></td><td style="text-align: left" valign="top"><p>Forces a garbage-collection cycle.</p></td></tr><tr><td style="text-align: left" valign="top"><p>"<code class="literal">count</code>"</p></td><td style="text-align: left" valign="top"><p>Returns the amount (in kilobytes) of memory in use.</p></td></tr><tr><td style="text-align: left" valign="top"><p>"<code class="literal">restart</code>"</p></td><td style="text-align: left" valign="top"><p>Restarts garbage collection (if it has been stopped).</p></td></tr><tr><td style="text-align: left" valign="top"><p>"<code class="literal">setpause</code>"</p></td><td style="text-align: left" valign="top"><p>Sets the garbage-collection pause to the extra argument divided by 100.</p></td></tr><tr><td style="text-align: left" valign="top"><p>"<code class="literal">setstepmul</code>"</p></td><td style="text-align: left" valign="top"><p>Sets the garbage-collection step multiplier to the extra argument divided by 100.</p></td></tr><tr><td style="text-align: left" valign="top"><p>"<code class="literal">step</code>"</p></td><td style="text-align: left" valign="top"><p>Runs one step of garbage collection. The bigger the extra argument is, the bigger this step will be. (The exact relationship between the extra argument and the step size is undefined.) <code class="literal">collectgarbage</code> will return true if the triggered step was the last step of a garbage-collection cycle.</p></td></tr><tr><td style="text-align: left" valign="top"><p>"<code class="literal">stop</code>"</p></td><td style="text-align: left" valign="top"><p>Stops garbage collection.</p></td></tr></tbody></table></div><p>The following example shows the effect of collecting garbage after creating and then releasing a large string:</p><pre class="programlisting">local function KbUsed(Seq)
 io.write(string.format("%2d %8.2f KB\n", Seq, collectgarbage("count")))
end
KbUsed(1)
Str = string.rep("*", 1e5)
KbUsed(2)
Str = nil
collectgarbage("collect")
KbUsed(3)
collectgarbage("collect")
KbUsed(4)
collectgarbage("collect")
KbUsed(5)</pre><p>The example prints the following lines, showing how successive garbage collection cycles reclaim memory:</p><pre class="programlisting">1  21.15 KB
 2 324.48 KB
 3  44.19 KB
 4  25.88 KB
 5  21.30 KB</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="type_and_conversion_functions"></a>Type and Conversion Functions</h2></div></div></div><p>These functions let you identify types and convert between them:<a id="IDX-CHP-11-0045" class="indexterm"></a><a id="IDX-CHP-11-0046" class="indexterm"></a><a id="IDX-CHP-11-0047" class="indexterm"></a><a id="IDX-CHP-11-0048" class="indexterm"></a><a id="IDX-CHP-11-0049" class="indexterm"></a><a id="IDX-CHP-11-0050" class="indexterm"></a><a id="IDX-CHP-11-0051" class="indexterm"></a><a id="IDX-CHP-11-0052" class="indexterm"></a><a id="IDX-CHP-11-0053" class="indexterm"></a><a id="IDX-CHP-11-0054" class="indexterm"></a><a id="IDX-CHP-11-0055" class="indexterm"></a><a id="IDX-CHP-11-0056" class="indexterm"></a><a id="IDX-CHP-11-0057" class="indexterm"></a></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">tonumber(</code><span class="emphasis"><em>value, optional numeric base from 2 to 36</em></span><code class="literal">)</code>: Converts the specified value to a number using the specified base. The value must represent an unsigned integer if the base is other than 10. For base 10, the default, the value can represent a floating point number.</p></li><li class="listitem"><p><code class="literal">tostring(</code><span class="emphasis"><em>value</em></span><code class="literal">)</code>: Returns a string representation of the specified value, using the <code class="literal">__tostring</code> metamethod if one is registered.</p></li><li class="listitem"><p><code class="literal">type(</code><span class="emphasis"><em>value</em></span><code class="literal">)</code>: Returns a string representation of the specified value's type. This will be "<code class="literal">nil"</code>, "<code class="literal">boolean"</code>, "<code class="literal">number"</code>, "<code class="literal">string"</code>, "<code class="literal">table"</code>, "<code class="literal">function"</code>, "<code class="literal">thread"</code> or "<code class="literal">userdata"</code>.</p></li></ul></div><p>The following example demonstrates the conversion of a binary number to decimal:</p><pre class="programlisting">BinStr = "101010"
Num = tonumber(BinStr, 2)
DecStr = tostring(Num)
io.write(BinStr, " (", type(BinStr), "), ", Num, " (", type(Num), "), ",
  DecStr, " (", type(DecStr), ")\n")</pre><p>The example prints the following:</p><pre class="programlisting">101010 (string), 42 (number), 42 (string)</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="basic_output"></a>Basic Output</h2></div></div></div><p>This category provides a quick way for Lua programs to print values to standard output. The <code class="literal">print(</code><span class="emphasis"><em>zero or more values</em></span><code class="literal">)</code> function writes the string equivalent of each argument to standard output. A tab is written after each argument except the last in which case a newline is written.</p><p>This example prints an assortment of values to the standard output stream:</p><pre class="programlisting">print(nil, 1 == 1, 1 + 1, "one", function() end, {})</pre><p>The output shows how various values are rendered by the <code class="literal">print</code> function:</p><pre class="programlisting">nil   true   2   one   function: 003D9490    table: 003DA478</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="error-condition_functions"></a>Error-Condition Functions</h2></div></div></div><p>These functions conditionally or unconditionally cause an error to propagate toward the host program at runtime. The most recent protected call will contain the error and prevent it from propagating further.</p><p>Here are the error-condition functions and examples of each:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">assert(</code><span class="emphasis"><em>test expression, optional error message</em></span><code class="literal">)</code>: If the test expression evaluates to <code class="literal">false</code> or <code class="literal">nil</code>, an error is raised with the specified error message or, if it is missing, with the text <code class="literal">assertion failed!</code> For example, the following tests the assumption of a value's type:</p><pre class="programlisting">Val = 12
assert(type(Val) == "boolean", "Expecting boolean value")</pre><p>This outputs the following stack traceback when the assertion expression evaluates to false:<a id="IDX-CHP-11-0058" class="indexterm"></a><a id="IDX-CHP-11-0059" class="indexterm"></a><a id="IDX-CHP-11-0060" class="indexterm"></a><a id="IDX-CHP-11-0061" class="indexterm"></a><a id="IDX-CHP-11-0062" class="indexterm"></a><a id="IDX-CHP-11-0063" class="indexterm"></a></p><pre class="programlisting">lua: assert.lua:2: Expecting boolean value
stack traceback:
        [C]: in function 'assert'
        assert.lua:2: in main chunk
        [C]: ?</pre></li><li class="listitem"><p><code class="literal">error(</code><span class="emphasis"><em>error message, optional "skip" level</em></span><code class="literal">)</code>: Unconditionally causes an error using the specified message. The second argument specifies the number of stack frames to skip when reporting the error's origin. This is useful when writing a custom error handler. This example issues an error:</p><pre class="programlisting">error("Printer on fire.")</pre><p>The output of the example uses the Lua interpreter's default error handler:</p><pre class="programlisting">lua: err.lua:1: Printer on fire.
stack traceback:
        [C]: in function 'error'
        error.lua:1: in main chunk
        [C]: ?</pre></li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="table_traversal_functions"></a>Table Traversal Functions</h2></div></div></div><p>These functions let you visit each key-value pair in a table:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">ipairs(</code><span class="emphasis"><em>array</em></span>): Can be used in a generic <code class="literal">for</code> loop to visit all array fields in the specified table. These are values whose keys are contiguous integers beginning with 1.</p></li><li class="listitem"><p><code class="literal">next(</code><span class="emphasis"><em>table, optional seed key</em></span><code class="literal">)</code>: Returns the next key-value pair from the table's internally ordered sequence. The first key and value from this sequence are returned when the key argument is omitted. The value <code class="literal">nil</code> is returned when the last key in the sequence is specified.</p></li><li class="listitem"><p><code class="literal">pairs(</code><span class="emphasis"><em>table</em></span><code class="literal">)</code>: Can be used in a generic <code class="literal">for</code> loop to iterate over all key-value pairs in the table.</p></li></ul></div><p>This example initializes a table with indexed and associative elements and iterates through the table using the table traversal functions:</p><pre class="programlisting">Tbl = {[0] = "zero", "one", "two", Id = 100, Name = "Alexander Botts",
  "three", [10] = "ten"}

io.write("--- ipairs ---\n")
for J, Val in ipairs(Tbl) do
  io.write(J, ": ", tostring(Val), "\n")
end

io.write("--- pairs ---\n")
for Key, Val in pairs(Tbl) do
  io.write(tostring(Key), ": ", tostring(Val), "\n")</pre><pre class="programlisting">end

io.write("--- next ---\n")
local Key, Val = next(Tbl)
while Key do
  io.write(tostring(Key), ": ", tostring(Val), "\n")
  Key, Val = next(Tbl, Key)
end</pre><p>The example's output show how <code class="literal">pairs</code> and <code class="literal">next</code> can be used to visit all key-value pairs in a table, but <code class="literal">ipairs</code> traverses only array elements:<a id="IDX-CHP-11-0064" class="indexterm"></a><a id="IDX-CHP-11-0065" class="indexterm"></a><a id="IDX-CHP-11-0066" class="indexterm"></a><a id="IDX-CHP-11-0067" class="indexterm"></a><a id="IDX-CHP-11-0068" class="indexterm"></a></p><pre class="programlisting"><em class="replaceable"><code>--- ipairs ---</code></em>
1: one
2: two
3: three
<em class="replaceable"><code>--- pairs ---</code></em>
1: one
2: two
3: three
0: zero
10: ten
Name: Alexander Botts
Id: 100
<em class="replaceable"><code>--- next ---</code></em>
1: one
2: two
3: three
0: zero
10: ten
Name: Alexander Botts
Id: 100</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="vararg-related_functions"></a>Vararg-Related Functions</h2></div></div></div><p>The following two functions are useful for working with vararg expressions (<code class="literal">...</code>), vararg functions, functions that return multiple values, and multiple assignment:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">select(</code><span class="emphasis"><em>position or "</em></span><code class="literal">#"</code><span class="emphasis"><em>, zero or more extra arguments</em></span><code class="literal">)</code>: When the first argument is "<code class="literal">#"</code>, this function returns the number of extra arguments. When the first argument is an integer, it returns the extra argument specified by that integer, and all of the following extra arguments.</p></li><li class="listitem"><p><code class="literal">unpack(</code><span class="emphasis"><em>array, optional start position, optional end position</em></span><code class="literal">):</code> Returns the values (in order) in the given array. The start and end positions default (respectively) to <code class="literal">1</code> and the length of the array.</p></li></ul></div><p>The following example demonstrates the use of <code class="literal">select</code> and <code class="literal">unpack</code>:</p><pre class="programlisting">function Test(...)
  io.write("*** Entering Test ***\n")
  for J = 1, select("#", ...) do
    io.write(select(J, ...))
    io.write("\n")</pre><pre class="programlisting">end
end

List = {"One", "Two", "Three"}
Test(unpack(List))
Test(unpack(List, 1, 2))
Test(unpack(List, 2))</pre><p>The example's output shows how <code class="literal">unpack</code> can be used to return a contiguous range of arrayed values, and how <code class="literal">select</code> can be used to obtain the elements in a vararg expression and their number:<a id="IDX-CHP-11-0069" class="indexterm"></a><a id="IDX-CHP-11-0070" class="indexterm"></a><a id="IDX-CHP-11-0071" class="indexterm"></a><a id="IDX-CHP-11-0072" class="indexterm"></a><a id="IDX-CHP-11-0073" class="indexterm"></a><a id="IDX-CHP-11-0074" class="indexterm"></a><a id="IDX-CHP-11-0075" class="indexterm"></a></p><pre class="programlisting">*** Entering Test ***
OneTwoThree
TwoThree
Three
*** Entering Test ***
OneTwo
Two
*** Entering Test ***
TwoThree
Three</pre></div></div><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="coroutine_library"></a>Coroutine Library</h1></div></div></div><p>The following coroutine functions are used to cooperatively manage multiple threads in a Lua program:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">coroutine.create(</code><span class="emphasis"><em>function</em></span><code class="literal">)</code>: Creates a coroutine from the specified function. The returned value is of type <code class="literal">thread</code>.</p></li><li class="listitem"><p><code class="literal">coroutine.resume(</code><span class="emphasis"><em>coroutine, optional values</em></span><code class="literal">)</code>: Activates a coroutine with any practical number and type of arguments. The values following the coroutine in the argument list are passed to the coroutine as follows. When the coroutine is initially activated, the arguments are conveyed in the coroutine body's argument list. When the coroutine is subsequently resumed, these arguments appear as return values from <code class="literal">coroutine.yield</code>. This function returns the values that are passed to <code class="literal">coroutine.yield</code> or are explicitly returned when the coroutine ends.</p></li><li class="listitem"><p><code class="literal">coroutine.running()</code>: Returns the currently running coroutine, or <code class="literal">nil</code> if the main thread is running.</p></li><li class="listitem"><p><code class="literal">coroutine.status(</code><span class="emphasis"><em>coroutine</em></span><code class="literal">)</code>: Returns a string with the value "<code class="literal">running"</code>, "<code class="literal">suspended"</code>, "<code class="literal">normal"</code> or "<code class="literal">dead"</code>.</p></li><li class="listitem"><p><code class="literal">coroutine.wrap(</code><span class="emphasis"><em>function</em></span><code class="literal">)</code>: Creates a coroutine from the specified function and returns a function wrapper to it. The coroutine is resumed by calling the returned function directly. This can make activating the coroutine simpler; however, runtime errors are not contained.</p></li><li class="listitem"><p><code class="literal">coroutine.yield(</code><span class="emphasis"><em>zero or more values</em></span><code class="literal">)</code>: Transfers control back to the caller of <code class="literal">coroutine.resume</code> that activated the current coroutine. The arguments are conveyed to the caller in the form of return values from <code class="literal">coroutine.resume</code>.</p></li></ul></div><p>The following example shows how coroutines can be used to retain the state needed to generate a running average of numbers. Both the wrapped and unwrapped varieties of coroutines are demonstrated:</p><pre class="programlisting">local function Average()
  local Co = coroutine.running()
  Val = coroutine.yield(tostring(Co) .. " is " .. coroutine.status(Co))
  local Count, Sum = 1, Val
  while true do
    Sum = Sum + coroutine.yield(Sum, Sum / Count)
    Count = Count + 1
  end
end

local CoAve = coroutine.create(Average)
local Code, Str = coroutine.resume(CoAve)
if Code then
  io.write(Str, "\n")
  local Ave = coroutine.wrap(Average)
  io.write(Ave(), "\n\n")
  io.write("Val A Sum A Ave A Val B Sum B Ave B\n")
  io.write("----- ----- ----- ----- ----- -----\n")
  math.random() -- On some systems that shall remain nameless, the
    -- first call to math.random is easy enough to predict that it
    -- destroys the illusion of randomness; throw it away.
  for J = 1, 6 do
    local Code, ValA, SumA, AveA, ValB, SumB, AveB
    ValA = math.random(0, 100)
    Code, SumA, AveA = coroutine.resume(CoAve, ValA)
    if Code then
      ValB = math.random(0, 100)
      SumB, AveB = Ave(ValB)
      io.write(string.format("%5d %5d %5.2f %5d %5d %5.2f\n",
        ValA, SumA, AveA, ValB, SumB, AveB))
    end
  end
end</pre><p>The example's output shows identical results calculated for identical input to the averaging coroutines:</p><pre class="programlisting">thread: 003DAD60 is running
thread: 003DB3B0 is running

Val A   Sum A   Ave A   Val B   Sum B   Ave B
-----   -----   -----   -----   -----   -----
   56      56   56.00      19      19   19.00
   81     137   68.50      59      78   39.00
   48     185   61.67      35     113   37.67
   90     275   68.75      83     196   49.00
   75     350   70.00      17     213   42.60
   86     436   72.67      71     284   47.33</pre></div><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="package_library"></a>Package Library</h1></div></div></div><p>The following functions, strings, and tables in this library are used with or by <code class="literal">module</code> and <code class="literal">require</code> to implement Lua's package system:<a id="IDX-CHP-11-0076" class="indexterm"></a><a id="IDX-CHP-11-0077" class="indexterm"></a><a id="IDX-CHP-11-0078" class="indexterm"></a><a id="IDX-CHP-11-0079" class="indexterm"></a><a id="IDX-CHP-11-0080" class="indexterm"></a><a id="IDX-CHP-11-0081" class="indexterm"></a><a id="IDX-CHP-11-0082" class="indexterm"></a></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">package.loadlib(</code><span class="emphasis"><em>library name, function name</em></span><code class="literal">)</code>: Loads the specified library and returns a function bound to the specified C function in the library. Because ANSI C doesn't provide for loading libraries dynamically, this function is implemented in a platform-specific manner and is available only on mainstream systems. The following example demonstrates the direct loading of a shared library:<a id="IDX-CHP-11-0083" class="indexterm"></a></p><div class="blockquote"><blockquote class="blockquote"><p>Usually a Lua program uses the <code class="literal">require</code> function instead of <code class="literal">loadlib</code> to take advantage of Lua's package searching and caching conventions.</p></blockquote></div><pre class="programlisting">Fnc, ErrStr = package.loadlib("./luabogo.so", "luaopen_bogo")
if Fnc then
  Fnc("bogo")
else
  io.write(ErrStr, "\n")
end</pre></li><li class="listitem"><p><code class="literal">package.seeall(</code><span class="emphasis"><em>namespace table</em></span><code class="literal">)</code>: Sets the metatable for a module namespace so that values in the global environment can be accessed. This is used as a preparation function with the <code class="literal">module</code> function. For example, the following creates a small module that specifies <code class="literal">package.seeall</code> as an argument to <code class="literal">module</code> so that it can access to the global environment. Note that <code class="literal">package.path</code> is modified so that the script looks for the module in the current directory:</p><pre class="programlisting">io.output("testmod.lua")
io.write [[module(..., package.seeall)
local ModStr = (...)

function Hello()
  io.write("Hello from ", ModStr, "\n")
end
]]

io.close()
io.output(io.stdout)
package.path = "?.lua"
require("testmod")
testmod.Hello()</pre><p>The example's output shows how the module is able to call <code class="literal">io.write</code> as a result of using <code class="literal">package.seeall</code>:</p><pre class="programlisting">Hello from testmod</pre></li><li class="listitem"><p><code class="literal">package.preload</code>: Each key in this table is the name of a module, and the corresponding value is a function that is called to load the module. Lua's package mechanism checks this table for a module loading function before it searches for a file-based module.</p></li><li class="listitem"><p><code class="literal">package.loaded</code>: Each key in this table is the name of a loaded module, and the corresponding value is the value that was returned by the module's loading function. Lua's package mechanism checks this table when <code class="literal">require</code> is called to see if the module has already been loaded. If it has, the corresponding value is returned rather than loading the module again.<a id="IDX-CHP-11-0084" class="indexterm"></a><a id="IDX-CHP-11-0085" class="indexterm"></a></p></li><li class="listitem"><p><code class="literal">package.path</code>: This string consists of semicolon-separated segments that are used to locate a Lua module file. It is initially assigned the value of the environment variable <code class="literal">LUA_PATH</code> (or a default value from <code class="literal">luaconf.h</code>, if <code class="literal">LUA_PATH</code> is not defined). When searching for a module file, Lua replaces each question mark with the name passed to <code class="literal">require</code>.</p></li><li class="listitem"><p><code class="literal">package.cpath</code>: This string consists of semicolon-separated segments that are used to locate a compiled library. It is initially assigned the value of the environment variable <code class="literal">LUA_CPATH</code> (or a default value from <code class="literal">luaconf.h</code>, if <code class="literal">LUA_CPATH</code> is not defined). When searching for a library, Lua replaces each question mark with the name passed to <code class="literal">require</code>.</p></li></ul></div><p>The following example demonstrates the use of the <code class="literal">package.loaded</code> and <code class="literal">package.preloaded</code> tables:</p><pre class="programlisting">io.output("a.lua")
io.write('return {Str = "Module a (file)."}')
io.close()
io.output("b.lua")
io.write('return {Str = "Module b (file)."}')
io.close()
io.output("c.lua")
io.write('return {Str = "Module c (file)."}')
io.close()
io.output(io.stdout)

package.cpath = ""
package.path = "./?.lua"

function package.preload.a()
  return {Str = "Module a."}
end

package.loaded.b = {Str = "Module b."}

local function Report(ModStr)
  io.write('package.loaded["', ModStr, '"] = ',
    tostring(package.loaded[ModStr]), '\n')
end

Report("a")
Report("b")
Report("c")
local A = require("a")
local B = require("b")
local C = require("c")
io.write("A: ", A.Str, "\nB: ", B.Str, "\nC: ", C.Str, "\n")
Report("a")
Report("b")
Report("c")</pre><p>Three file-based modules are created, and <code class="literal">package.cpath</code> and <code class="literal">package.path</code> are set so that Lua will look for Lua modules only in the current working directory, and will not look for compiled libraries at all. A loader function is associated with "<code class="literal">a"</code> in the <code class="literal">package.preload</code> table. When the "<code class="literal">a"</code> module is required, Lua will call this function and return the value that it returns. A table is associated with "<code class="literal">b"</code> in the <code class="literal">package.loaded</code> table. When the "<code class="literal">b"</code> module is required, Lua returns this value directly. Because the "<code class="literal">c"</code> module doesn't have an entry in either of these tables, Lua searches for a file module. It does this by stepping through each semicolon-separated segment in <code class="literal">package.path</code>, replacing each <code class="literal">?</code> with the name of the module. In this example, the one segment in <code class="literal">package.path</code> forms the name <code class="literal">./c.lua</code>, and Lua successfully opens this file as a Lua chunk. The example outputs the following lines:<a id="IDX-CHP-11-0086" class="indexterm"></a><a id="IDX-CHP-11-0087" class="indexterm"></a><a id="IDX-CHP-11-0088" class="indexterm"></a><a id="IDX-CHP-11-0089" class="indexterm"></a></p><pre class="programlisting">package.loaded["a"] = nil
package.loaded["b"] = table: 003DA7E8
package.loaded["c"] = nil
A: Module a.
B: Module b.
C: Module c (file).
package.loaded["a"] = table: 003DAEC8
package.loaded["b"] = table: 003DA7E8
package.loaded["c"] = table: 003DAFF0</pre></div><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="string_library"></a>String Library</h1></div></div></div><p>The string library provides a versatile set of functions for manipulating text in Lua programs. Character positions may be positive or negative integers. A positive value indicates a position counted from the beginning of the string with the first character at position 1. A negative value indicates a position counted backwards from the end of the string, with the last character at position −1.<a id="IDX-CHP-11-0090" class="indexterm"></a><a id="IDX-CHP-11-0091" class="indexterm"></a></p><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="pattern-based_string_functions"></a>Pattern-Based String Functions</h2></div></div></div><p>The following string functions use Lua's pattern matching facility to locate and extract character sequences in a string (see "<a class="link" href="ch05.html#pattern-matching" title="Pattern-Matching">Pattern Matching</a>" in <a class="link" href="ch05.html" title="Chapter 5. Using Strings">Chapter 5</a> for details about matching text):</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">string.find(</code><span class="emphasis"><em>subject string, pattern string, optional start position, optional plain flag</em></span><code class="literal">)</code>: Looks for a pattern in the specified subject string. The search is done with Lua's pattern-matching rules unless the optional plain flag is true, in which case a character-for-character search is done, with none of the characters in the pattern string having their magic meaning. The search begins at the beginning of the subject unless a start position is specified. If a match is found, the start and end positions are returned followed by any captures that are specified in the pattern string. For example, the following demonstrates the use of <code class="literal">string.find</code> with an incremented starting position to extract all alphanumeric sequences from a string:</p><pre class="programlisting">local Str = "/var/local/www"
local PosStart, PosEnd, MatchStr = 1
while PosStart do
  PosStart, PosEnd, MatchStr = string.find(Str, "(%w+)", PosStart)
  if PosStart then
    io.write(MatchStr, "\n")
    PosStart = PosEnd + 1
  end
end</pre><p>The example prints the following lines.<a id="IDX-CHP-11-0092" class="indexterm"></a><a id="IDX-CHP-11-0093" class="indexterm"></a><a id="IDX-CHP-11-0094" class="indexterm"></a><a id="IDX-CHP-11-0095" class="indexterm"></a></p><pre class="programlisting">var
local
www</pre></li><li class="listitem"><p><code class="literal">string.gmatch(</code><span class="emphasis"><em>subject string, pattern string</em></span><code class="literal">)</code>: Iterator factory for looping through pattern matches in the subject string using a generic <code class="literal">for</code> loop. For example, the following is a more convenient method than the one in the previous example that you can use to extract matching character sequences from a string:</p><pre class="programlisting">for Str in string.gmatch("CamelbackName", "%u%l+") do
  io.write(Str, "\n")
end
The example prints the following string captures.Camelback
Name</pre></li><li class="listitem"><p><code class="literal">string.gsub(</code><span class="emphasis"><em>subject string, pattern string, replacement string or function or table, optional limit count</em></span><code class="literal">)</code>: Substitutes each pattern match found in the subject string with a replacement. The replacement argument can be a string (which can contain captures such as "<code class="literal">%1"</code>), or a function that is called for each match (with captures passed as arguments), or a table in which the value given by a matching key is used for the replacement. The number of replacements can be limited by specifying a numeric fourth argument. The following example shows how <code class="literal">string.gsub</code> can be used to modify the contents of a string:</p><pre class="programlisting">-- Generate list of month names in current locale
local Dt = os.date("*t")
Dt.day = 1
local MonthList = {}
for Month = 1, 12 do
  Dt.month = Month
  MonthList[Month] = os.date("%B", os.time(Dt))
end

function ExpandDate(Month, Day, Sep)
  return (MonthList[tonumber(Month)] or "---") .. " " ..
    tonumber(Day) .. (Sep == "," and ", " or "")
end

local Str = "0117,0211,0818"
io.write("Before: ", Str, "\n")
Str = string.gsub(Str, "(%d%d)(%d%d)(%,?)", ExpandDate)
io.write("After: ", Str, "\n")</pre><p>The example prints the following lines.</p><pre class="programlisting">Before: 0117,0211,0818
After: January 17, February 11, August 18</pre></li><li class="listitem"><p><code class="literal">string.match(</code><span class="emphasis"><em>subject string, pattern string, optional start position</em></span><code class="literal">)</code>: Returns the captures of the first match found in the subject. If no match is found, <code class="literal">nil</code> is returned. If a match is found but no captures are specified, the entire match is returned. For example, the following extracts the red, green and blue hexadecimal components of a color identifier:</p><pre class="programlisting">local ClrStr = "#C6EFF7"
local Red, Green, Blue = string.match(ClrStr, "%#(%x%x)(%x%x)(%x%x)")
if Red then
  io.write("Red: ", tonumber(Red, 16), ", Green: ", tonumber(Green, 16),
    ", Blue: ", tonumber(Blue, 16), "\n")
end</pre><p>The following line is printed by the example:<a id="IDX-CHP-11-0096" class="indexterm"></a><a id="IDX-CHP-11-0097" class="indexterm"></a><a id="IDX-CHP-11-0098" class="indexterm"></a><a id="IDX-CHP-11-0099" class="indexterm"></a><a id="IDX-CHP-11-0100" class="indexterm"></a><a id="IDX-CHP-11-0101" class="indexterm"></a></p><pre class="programlisting">Red: 198, Green: 239, Blue: 247</pre></li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="string-conversion_functions"></a>String-Conversion Functions</h2></div></div></div><p>Lua's string-conversion functions return one or more values pertaining to the specified string or substring, as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">string.byte(</code><span class="emphasis"><em>string, optional start position, optional end position</em></span><code class="literal">)</code>: Returns the platform-dependent byte values associated with a range of text characters. If the start position is missing, 1 is used. If the end position is missing, the start position is used. For example, the following returns the byte values of the letters L, u and a:</p><pre class="programlisting">print(string.byte("Lua", 1, 3))</pre><p>The following values are printed by the example:</p><pre class="programlisting">76  117  97</pre></li><li class="listitem"><p><code class="literal">string.char(</code><span class="emphasis"><em>zero or more integers</em></span><code class="literal">)</code>: Constructs and returns a string comprising the characters associated with the platform-dependent argument values. For example, the following converts the specified numeric values to a string:</p><pre class="programlisting">print(string.char(76, 117, 97))</pre><p>The example prints the following string:</p><pre class="programlisting">Lua</pre></li><li class="listitem"><p><code class="literal">string.dump(</code><span class="emphasis"><em>function</em></span><code class="literal">)</code>: Returns a copy of the function converted to binary string form for storage or transmission. It can be restored with one of the <code class="literal">load</code> functions. (Officially, the function cannot have upvalues, but <a class="link" href="ch10.html" title="Chapter 10. Looking Under the Hood">Chapter 10</a> describes what happens if it does.) The following example converts a simple Lua function to string form, and then creates a new function from the string and executes it with a number of arguments:</p><pre class="programlisting">Str = string.dump(function(...) print(...) end)
print(string.gsub(Str, "%A+", "..."))
loadstring(Str)(1, 2, 3)</pre><p>The example prints the following lines (the actual values shown in the first line may vary between platforms):</p><pre class="programlisting">...LuaQ...sb...lua...E...print...arg... 7
  1      2      3</pre></li><li class="listitem"><p><code class="literal">string.format(</code><span class="emphasis"><em>format string, zero or more values</em></span><code class="literal">)</code>: Returns a single formatted string. The format string specifies how the arguments that follow it are to be formatted, following conventions close to those used by the <code class="literal">printf</code> function in the standard C library. For example, you could use <code class="literal">string.format</code> to generate a hexadecimal color identifier like this:<a id="IDX-CHP-11-0102" class="indexterm"></a><a id="IDX-CHP-11-0103" class="indexterm"></a><a id="IDX-CHP-11-0104" class="indexterm"></a><a id="IDX-CHP-11-0105" class="indexterm"></a><a id="IDX-CHP-11-0106" class="indexterm"></a><a id="IDX-CHP-11-0107" class="indexterm"></a></p><pre class="programlisting">io.write(string.format("Color: #%02X%02X%02X\n", 198, 239, 247))</pre><p>The following line is printed by the example:</p><pre class="programlisting">Color: #C6EFF7</pre></li><li class="listitem"><p><code class="literal">string.len(</code><span class="emphasis"><em>string</em></span><code class="literal">)</code>: Returns the number of bytes in the specified string, including non-text characters such as "<code class="literal">\0"</code>.</p></li><li class="listitem"><p><code class="literal">string.lower(</code><span class="emphasis"><em>string</em></span><code class="literal">)</code>: Returns a copy of the specified string in which all uppercase letters are transformed to their lowercase values.</p></li><li class="listitem"><p><code class="literal">string.rep(</code><span class="emphasis"><em>string, repeat count</em></span><code class="literal">)</code>: Returns a string made up of the specified string repeated the specified number of times.</p></li><li class="listitem"><p><code class="literal">string.reverse(</code><span class="emphasis"><em>string</em></span><code class="literal">)</code>: Returns a copy of the specified string in which the sequence of the characters is reversed.</p></li><li class="listitem"><p><code class="literal">string.sub(</code><span class="emphasis"><em>string, start position, optional end position</em></span><code class="literal">)</code>: Returns the portion of the specified string indicated by the start and end positions.</p></li><li class="listitem"><p><code class="literal">string.upper(</code><span class="emphasis"><em>string</em></span><code class="literal">)</code>: Returns a copy of the specified string in which all lower case letters are transformed to their upper case values.</p></li></ul></div><p>This example demonstrates a number of conversions in which the returned string is a modification of the passed-in string:</p><pre class="programlisting">local Str = "Lua"
io.write(string.format("Normal: '%s', reversed: '%s', " ..
  "lower: '%s', upper: '%s'\n\n",
  Str, string.reverse(Str), string.lower(Str), string.upper(Str)))
for J, TblStr in ipairs{"coroutine", "debug", "io", "math",
  "os", "package", "string", "table"} do
  local Count = 0
  for FldStr in pairs(_G[TblStr]) do
    Count = Count + 1
  end
  io.write(string.format("%s%s%d\n", TblStr, string.rep(".",
    14 - string.len(TblStr) - string.len(Count)), Count))
end</pre><p>The example prints the following lines:</p><pre class="programlisting">Normal: 'Lua', reversed: 'auL', lower: 'lua', upper: 'LUA'

coroutine....6
debug.......14
io..........14
math........31
os..........11
package......8
string......15
table........9</pre></div></div><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="table_library"></a>Table Library</h1></div></div></div><p>The table functions provide a means to work with tables as arrays (that is, tables with contiguous integer indexes beginning with <code class="literal">1</code>). The table library contains the following functions:<a id="IDX-CHP-11-0108" class="indexterm"></a><a id="IDX-CHP-11-0109" class="indexterm"></a><a id="IDX-CHP-11-0110" class="indexterm"></a><a id="IDX-CHP-11-0111" class="indexterm"></a><a id="IDX-CHP-11-0112" class="indexterm"></a><a id="IDX-CHP-11-0113" class="indexterm"></a></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">table.concat(</code><span class="emphasis"><em>array, optional separator string, optional start position, optional end position</em></span><code class="literal">)</code>: Returns a single string made up of the elements in the specified table, which must be strings or numbers. If a separator is specified, it will be used to delimit the elements. A range of elements can be specified using the start and end positions.</p></li><li class="listitem"><p><code class="literal">table.insert(</code><span class="emphasis"><em>array, optional position, value</em></span><code class="literal">)</code>: Inserts a value into the specified table. If the position is missing, the value is added to the end of the array, otherwise it's added to the indicated position. In either case, the number of values in the array is increased by one. If the insertion is into before the last position, elements are moved up to make room.</p></li><li class="listitem"><p><code class="literal">table.maxn(</code><span class="emphasis"><em>array</em></span><code class="literal">)</code>: Effectively performs a <code class="literal">pairs</code> loop to determine the largest positive numeric key in the specified table. The returned number may be larger than the value an <code class="literal">ipairs</code> loop would reach, and the number may be a noninteger. If there are no positive keys, <code class="literal">0</code> is returned.</p></li><li class="listitem"><p><code class="literal">table.remove(</code><span class="emphasis"><em>array, optional position</em></span><code class="literal">)</code>: Removes the table element associated with the specified position and returns its value. If the position is missing, the last element in the array is removed. Elements are moved down to fill the vacated position.</p></li><li class="listitem"><p><code class="literal">table.sort(</code><span class="emphasis"><em>array, optional comparison function</em></span><code class="literal">)</code>: Sorts the elements in the specified array. If a comparison function is specified, it will be called as needed with two table elements as arguments. It should return <code class="literal">true</code> if the first element is less than the second and <code class="literal">false</code> otherwise. If this function is not specified, <code class="literal">&lt;</code> will be used to compare elements.</p></li></ul></div><p>This example demonstrates the manipulation of a table:</p><pre class="programlisting">Tbl = {"This is line 4", "This line is out of place", "This is line 2"}
table.insert(Tbl, "This is line 1")
table.remove(Tbl, 2)
table.insert(Tbl, "This is line 3")
table.insert(Tbl, "This is line " .. table.maxn(Tbl) + 1)
table.sort(Tbl)
io.write(table.concat(Tbl, "\n"), "\n")</pre><p>The example prints the following lines:</p><pre class="programlisting">This is line 1
This is line 2
This is line 3
This is line 4
This is line 5</pre></div><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="math_library"></a>Math Library</h1></div></div></div><p>The functions in the math library are closely bound to functions of the same name in the standard C library. Plots of some of the functions are shown here—these were generated with Lua using the GD library (which you'll get a chance to experiment with in the "Producing a Function Plot" Try It Out in <a class="link" href="ch12.html" title="Chapter 12. Using Community Libraries">Chapter 12</a>).<a id="IDX-CHP-11-0114" class="indexterm"></a><a id="IDX-CHP-11-0115" class="indexterm"></a><a id="IDX-CHP-11-0116" class="indexterm"></a><a id="IDX-CHP-11-0117" class="indexterm"></a><a id="IDX-CHP-11-0118" class="indexterm"></a><a id="IDX-CHP-11-0119" class="indexterm"></a></p><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="trigonometric_functions"></a>Trigonometric Functions</h2></div></div></div><p>These functions return a numeric value corresponding to right triangle side ratios. A circle of radius 1 is defined by the points (cos(<span class="emphasis"><em>angle</em></span>), sin(<span class="emphasis"><em>angle</em></span>)) for angles ranging from 0 to 2 * pi radians.</p><p>The trigonometric functions are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">math.sin(</code><span class="emphasis"><em>angle in radians</em></span><code class="literal">)</code>: Returns the sine of the specified angle. See <a class="link" href="ch11.html#figure_11-1" title="Figure 11.1. Figure 11-1">Figure 11-1</a> for a plot of this function.</p><div class="figure"><a id="figure_11-1"></a><div class="figure-contents"><div><img src="https://learning.oreilly.com/library/view/beginning-lua-programming/9780470069172/figs/1101.png" height="339" alt="Figure 11-1" width="549"></div></div><p class="title"><strong>Figure 11.1. Figure 11-1</strong></p></div></li><li class="listitem"><p><code class="literal">math.cos(</code><span class="emphasis"><em>angle in radians</em></span><code class="literal">)</code>: Returns the cosine of the specified angle. See <a class="link" href="ch11.html#figure_11-2" title="Figure 11.2. Figure 11-2">Figure 11-2</a> for a plot of this function.<a id="IDX-CHP-11-0120" class="indexterm"></a><a id="IDX-CHP-11-0121" class="indexterm"></a></p><div class="figure"><a id="figure_11-2"></a><div class="figure-contents"><div><img src="https://learning.oreilly.com/library/view/beginning-lua-programming/9780470069172/figs/1102.png" height="339" alt="Figure 11-2" width="549"></div></div><p class="title"><strong>Figure 11.2. Figure 11-2</strong></p></div></li><li class="listitem"><p><code class="literal">math.tan(</code><span class="emphasis"><em>angle in radians</em></span><code class="literal">)</code>: Returns the tangent of the specified angle. See <a class="link" href="ch11.html#figure_11-3" title="Figure 11.3. Figure 11-3">Figure 11-3</a> for a plot of this function.<a id="IDX-CHP-11-0122" class="indexterm"></a><a id="IDX-CHP-11-0123" class="indexterm"></a></p><div class="figure"><a id="figure_11-3"></a><div class="figure-contents"><div><img src="https://learning.oreilly.com/library/view/beginning-lua-programming/9780470069172/figs/1103.png" height="339" alt="Figure 11-3" width="549"></div></div><p class="title"><strong>Figure 11.3. Figure 11-3</strong></p></div></li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="inverse_trigonometric_functions"></a>Inverse Trigonometric Functions</h2></div></div></div><p>These functions return a numeric angle in radians that corresponds to a sine, cosine or tangent value. Because cosine and sine values range between −1 and 1, the arcsine and arccosine functions are defined only for arguments in this range.<a id="IDX-CHP-11-0124" class="indexterm"></a><a id="IDX-CHP-11-0125" class="indexterm"></a><a id="IDX-CHP-11-0126" class="indexterm"></a></p><p>The inverse trigonometric functions are as follows:<a id="IDX-CHP-11-0127" class="indexterm"></a></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">math.asin(</code><span class="emphasis"><em>value from −1 to 1</em></span><code class="literal">)</code>: Returns the angle in radians whose sine is specified. See <a class="link" href="ch11.html#figure_11-4" title="Figure 11.4. Figure 11-4">Figure 11-4</a> for a plot of this function.</p><div class="figure"><a id="figure_11-4"></a><div class="figure-contents"><div><img src="https://learning.oreilly.com/library/view/beginning-lua-programming/9780470069172/figs/1104.png" height="339" alt="Figure 11-4" width="549"></div></div><p class="title"><strong>Figure 11.4. Figure 11-4</strong></p></div></li><li class="listitem"><p><code class="literal">math.acos(</code><span class="emphasis"><em>value from −1 to 1</em></span><code class="literal">)</code>: Returns the angle in radians whose cosine is specified. See <a class="link" href="ch11.html#figure_11-5" title="Figure 11.5. Figure 11-5">Figure 11-5</a> for a plot of this function.<a id="IDX-CHP-11-0128" class="indexterm"></a><a id="IDX-CHP-11-0129" class="indexterm"></a></p><div class="figure"><a id="figure_11-5"></a><div class="figure-contents"><div><img src="https://learning.oreilly.com/library/view/beginning-lua-programming/9780470069172/figs/1105.png" height="346" alt="Figure 11-5" width="549"></div></div><p class="title"><strong>Figure 11.5. Figure 11-5</strong></p></div></li><li class="listitem"><p><code class="literal">math.atan(</code><span class="emphasis"><em>value</em></span><code class="literal">)</code>: Returns the angle in radians whose tangent is specified. See <a class="link" href="ch11.html#figure_11-6" title="Figure 11.6. Figure 11-6">Figure 11-6</a> for a plot of this function.<a id="IDX-CHP-11-0130" class="indexterm"></a><a id="IDX-CHP-11-0131" class="indexterm"></a><a id="IDX-CHP-11-0132" class="indexterm"></a></p><div class="figure"><a id="figure_11-6"></a><div class="figure-contents"><div><img src="https://learning.oreilly.com/library/view/beginning-lua-programming/9780470069172/figs/1106.png" height="339" alt="Figure 11-6" width="549"></div></div><p class="title"><strong>Figure 11.6. Figure 11-6</strong></p></div></li><li class="listitem"><p><code class="literal">math.atan2(</code><span class="emphasis"><em>numerator, denominator</em></span><code class="literal">)</code>: Returns the angle of a bidimensional vector (numerator, denominator). The denominator may be zero.</p><p>This example runs through a range of numerators and denominators for the arctangent function:</p><pre class="programlisting">for Y = −3, 3 do
 for X = −3, 3 do
   io.write(string.format("%5.2f ", math.atan2(Y, X) / math.pi))
 end
  io.write("\n")
end</pre><p>The example prints the following lines:</p><pre class="programlisting">−0.75 −0.69 −0.60 −0.50 −0.40 −0.31 −0.25
-0.81 −0.75 −0.65 −0.50 −0.35 −0.25 −0.19
-0.90 −0.85 −0.75 −0.50 −0.25 −0.15 −0.10
 1.00  1.00  1.00  0.00  0.00  0.00  0.00
 0.90  0.85  0.75  0.50  0.25  0.15  0.10
 0.81  0.75  0.65  0.50  0.35  0.25  0.19
 0.75  0.69  0.60  0.50  0.40  0.31  0.25</pre></li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="hyperbolic_functions"></a>Hyperbolic Functions</h2></div></div></div><p>These functions are to the hyperbola what the trigonometric functions are to the circle. The right half of the equilateral hyperbola is defined by the points (cosh(<span class="emphasis"><em>hyperbolic angle</em></span>), sinh(<span class="emphasis"><em>hyperbolic angle</em></span>)).<a id="IDX-CHP-11-0133" class="indexterm"></a><a id="IDX-CHP-11-0134" class="indexterm"></a><a id="IDX-CHP-11-0135" class="indexterm"></a><a id="IDX-CHP-11-0136" class="indexterm"></a></p><p>The hyperbolic functions are as follows:<a id="IDX-CHP-11-0137" class="indexterm"></a></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">math.sinh(</code><span class="emphasis"><em>hyperbolic angle</em></span><code class="literal">)</code>: Returns the hyperbolic sine of the specified value. See <a class="link" href="ch11.html#figure_11-7" title="Figure 11.7. Figure 11-7">Figure 11-7</a> for a plot of this function.</p><div class="figure"><a id="figure_11-7"></a><div class="figure-contents"><div><img src="https://learning.oreilly.com/library/view/beginning-lua-programming/9780470069172/figs/1107.png" height="339" alt="Figure 11-7" width="549"></div></div><p class="title"><strong>Figure 11.7. Figure 11-7</strong></p></div></li><li class="listitem"><p><code class="literal">math.cosh(</code><span class="emphasis"><em>hyperbolic angle</em></span><code class="literal">)</code>: Returns the hyperbolic cosine of the specified value. See <a class="link" href="ch11.html#figure_11-8" title="Figure 11.8. Figure 11-8">Figure 11-8</a> for a plot of this function.<a id="IDX-CHP-11-0138" class="indexterm"></a><a id="IDX-CHP-11-0139" class="indexterm"></a></p><div class="figure"><a id="figure_11-8"></a><div class="figure-contents"><div><img src="https://learning.oreilly.com/library/view/beginning-lua-programming/9780470069172/figs/1108.png" height="339" alt="Figure 11-8" width="549"></div></div><p class="title"><strong>Figure 11.8. Figure 11-8</strong></p></div></li><li class="listitem"><p><code class="literal">math.tanh</code><span class="emphasis"><em>(hyperbolic angle)</em></span>: Returns the hyperbolic tangent of the specified value. See <a class="link" href="ch11.html#figure_11-9" title="Figure 11.9. Figure 11-9">Figure 11-9</a> for a plot of this function.<a id="IDX-CHP-11-0140" class="indexterm"></a><a id="IDX-CHP-11-0141" class="indexterm"></a></p><div class="figure"><a id="figure_11-9"></a><div class="figure-contents"><div><img src="https://learning.oreilly.com/library/view/beginning-lua-programming/9780470069172/figs/1109.png" height="339" alt="Figure 11-9" width="549"></div></div><p class="title"><strong>Figure 11.9. Figure 11-9</strong></p></div></li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exponent_functions"></a>Exponent Functions</h2></div></div></div><p>These functions return the value of a number raised to another:<a id="IDX-CHP-11-0142" class="indexterm"></a><a id="IDX-CHP-11-0143" class="indexterm"></a><a id="IDX-CHP-11-0144" class="indexterm"></a><a id="IDX-CHP-11-0145" class="indexterm"></a></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">math.exp(</code><span class="emphasis"><em>natural exponent</em></span><code class="literal">)</code>: Returns the value of <span class="emphasis"><em>e</em></span> raised to the specified exponent. See <a class="link" href="ch11.html#figure_11-10" title="Figure 11.10. Figure 11-10">Figure 11-10</a> for a plot of this function.</p><div class="figure"><a id="figure_11-10"></a><div class="figure-contents"><div><img src="https://learning.oreilly.com/library/view/beginning-lua-programming/9780470069172/figs/1110.png" height="340" alt="Figure 11-10" width="549"></div></div><p class="title"><strong>Figure 11.10. Figure 11-10</strong></p></div></li><li class="listitem"><p><code class="literal">math.pow(</code><span class="emphasis"><em>base, exponent</em></span><code class="literal">)</code>: Returns the specified base raised to the specified exponent. The following example demonstrates this function:<a id="IDX-CHP-11-0146" class="indexterm"></a><a id="IDX-CHP-11-0147" class="indexterm"></a><a id="IDX-CHP-11-0148" class="indexterm"></a></p><pre class="programlisting">local Base, Exp = 0, 10
local Pow = math.pow(Base, Exp)
io.write(Base, " ^ ", Exp, " = ", Pow == 0 and "nothing at all" or Pow, "\n")
-- With a friendly tip of the hat to Ian Anderson</pre><p>The following line is printed by the example:</p><pre class="programlisting">0 ^ 10 = nothing at all</pre></li><li class="listitem"><p><code class="literal">math.sqrt(</code><span class="emphasis"><em>number</em></span><code class="literal">)</code>: Returns the square root of the specified number. See <a class="link" href="ch11.html#figure_11-11" title="Figure 11.11. Figure 11-11">Figure 11-11</a> for a plot of this function.</p><div class="figure"><a id="figure_11-11"></a><div class="figure-contents"><div><img src="https://learning.oreilly.com/library/view/beginning-lua-programming/9780470069172/figs/1111.png" height="339" alt="Figure 11-11" width="549"></div></div><p class="title"><strong>Figure 11.11. Figure 11-11</strong></p></div></li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="logarithm_functions"></a>Logarithm Functions</h2></div></div></div><p>These functions are the inverse of the exponent functions:<a id="IDX-CHP-11-0149" class="indexterm"></a><a id="IDX-CHP-11-0150" class="indexterm"></a><a id="IDX-CHP-11-0151" class="indexterm"></a></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">math.log(</code><span class="emphasis"><em>positive number</em></span><code class="literal">)</code>: Returns the natural (base-<span class="emphasis"><em>e</em></span>) logarithm of the specified number. The number <span class="emphasis"><em>e</em></span> raised to the return value equals the specified argument. See <a class="link" href="ch11.html#figure_11-12" title="Figure 11.12. Figure 11-12">Figure 11-12</a> for a plot of this function.</p><div class="figure"><a id="figure_11-12"></a><div class="figure-contents"><div><img src="https://learning.oreilly.com/library/view/beginning-lua-programming/9780470069172/figs/1112.png" height="340" alt="Figure 11-12" width="549"></div></div><p class="title"><strong>Figure 11.12. Figure 11-12</strong></p></div></li><li class="listitem"><p><code class="literal">math.log10(</code><span class="emphasis"><em>number</em></span><code class="literal">)</code>: Returns the base-10 logarithm of the specified number. The number 10 raised to the return value equals the specified argument. See <a class="link" href="ch11.html#figure_11-13" title="Figure 11.13. Figure 11-13">Figure 11-13</a> for a plot of this function.<a id="IDX-CHP-11-0152" class="indexterm"></a></p><div class="figure"><a id="figure_11-13"></a><div class="figure-contents"><div><img src="https://learning.oreilly.com/library/view/beginning-lua-programming/9780470069172/figs/1113.png" height="339" alt="Figure 11-13" width="549"></div></div><p class="title"><strong>Figure 11.13. Figure 11-13</strong></p></div></li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="adjustment_functions"></a>Adjustment Functions</h2></div></div></div><p>These functions adjust the specified value by sign or value:<a id="IDX-CHP-11-0153" class="indexterm"></a><a id="IDX-CHP-11-0154" class="indexterm"></a><a id="IDX-CHP-11-0155" class="indexterm"></a><a id="IDX-CHP-11-0156" class="indexterm"></a><a id="IDX-CHP-11-0157" class="indexterm"></a><a id="IDX-CHP-11-0158" class="indexterm"></a><a id="IDX-CHP-11-0159" class="indexterm"></a></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">math.abs(</code><span class="emphasis"><em>number</em></span><code class="literal">)</code>: Returns the absolute value of the specified number; a non-numeric argument causes an error. See <a class="link" href="ch11.html#figure_11-14" title="Figure 11.14. Figure 11-14">Figure 11-14</a> for a plot of this function.</p><div class="figure"><a id="figure_11-14"></a><div class="figure-contents"><div><img src="https://learning.oreilly.com/library/view/beginning-lua-programming/9780470069172/figs/1114.png" height="340" alt="Figure 11-14" width="549"></div></div><p class="title"><strong>Figure 11.14. Figure 11-14</strong></p></div></li><li class="listitem"><p><code class="literal">math.ceil(</code><span class="emphasis"><em>number</em></span><code class="literal">)</code>: Returns the smallest integer greater than or equal to the specified numeric argument. See <a class="link" href="ch11.html#figure_11-15" title="Figure 11.15. Figure 11-15">Figure 11-15</a> for a plot of this function.<a id="IDX-CHP-11-0160" class="indexterm"></a></p><div class="figure"><a id="figure_11-15"></a><div class="figure-contents"><div><img src="https://learning.oreilly.com/library/view/beginning-lua-programming/9780470069172/figs/1115.png" height="339" alt="Figure 11-15" width="549"></div></div><p class="title"><strong>Figure 11.15. Figure 11-15</strong></p></div></li><li class="listitem"><p><code class="literal">math.floor(</code><span class="emphasis"><em>number</em></span><code class="literal">)</code>: Returns the greatest integer less than or equal to the specified numeric argument. See <a class="link" href="ch11.html#figure_11-16" title="Figure 11.16. Figure 11-16">Figure 11-16</a> for a plot of this function.<a id="IDX-CHP-11-0161" class="indexterm"></a><a id="IDX-CHP-11-0162" class="indexterm"></a><a id="IDX-CHP-11-0163" class="indexterm"></a><a id="IDX-CHP-11-0164" class="indexterm"></a><a id="IDX-CHP-11-0165" class="indexterm"></a><a id="IDX-CHP-11-0166" class="indexterm"></a><a id="IDX-CHP-11-0167" class="indexterm"></a></p><div class="figure"><a id="figure_11-16"></a><div class="figure-contents"><div><img src="https://learning.oreilly.com/library/view/beginning-lua-programming/9780470069172/figs/1116.png" height="339" alt="Figure 11-16" width="549"></div></div><p class="title"><strong>Figure 11.16. Figure 11-16</strong></p></div></li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="floating_point_representation"></a>Floating Point Representation</h2></div></div></div><p>These functions are used in the representation of floating point numbers as the product of a mantissa and two raised to an integer exponent:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">math.frexp(</code><span class="emphasis"><em>number</em></span><code class="literal">)</code>: Returns the mantissa and integer exponent of the specified number. The returned values are adjusted so that the absolute value of the mantissa is greater than or equal to 0.5 and less than 1.0, except where the specified number is 0, in which case both return values are 0.</p></li><li class="listitem"><p><code class="literal">math.ldexp(</code><span class="emphasis"><em>mantissa, integer exponent</em></span><code class="literal">)</code>: Returns the product of the specified mantissa and two raised to the specified exponent.</p></li></ul></div><p>This example breaks the value pi into a mantissa and exponent and then recombines them:</p><pre class="programlisting">local Mantissa, Exp = math.frexp(math.pi)
io.write("Pi: ", Mantissa, " * 2 ^ ", Exp, " = ",
 math.ldexp(Mantissa, Exp), "\n")</pre><p>The following line is printed by the example:</p><pre class="programlisting">Pi: 0.78539816339745 * 2 ^ 2 = 3.1415926535898</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="angle_conversion_functions"></a>Angle Conversion Functions</h2></div></div></div><p>These helper functions convert angle values between degrees and radians:<a id="IDX-CHP-11-0168" class="indexterm"></a><a id="IDX-CHP-11-0169" class="indexterm"></a><a id="IDX-CHP-11-0170" class="indexterm"></a><a id="IDX-CHP-11-0171" class="indexterm"></a><a id="IDX-CHP-11-0172" class="indexterm"></a><a id="IDX-CHP-11-0173" class="indexterm"></a></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">math.deg(</code><span class="emphasis"><em>angle in radians</em></span><code class="literal">)</code>: Returns the number of degrees in the specified number of radians. For example, this converts some radian values to degrees:</p><pre class="programlisting">io.write("Radians Degrees\n")
io.write("------- -------\n")
for Step = 0, 2, 0.25 do
  local Degree = math.deg(math.pi * Step)
  io.write(string.format("%4.2f pi %7.1f\n", Step, Degree))
end</pre><p>The example prints the following table:</p><pre class="programlisting">Radians  Degrees
-------  -------
0.00 pi      0.0
0.25 pi     45.0
0.50 pi     90.0
0.75 pi    135.0
1.00 pi    180.0
1.25 pi    225.0
1.50 pi    270.0
1.75 pi    315.0
2.00 pi    360.0</pre></li><li class="listitem"><p><code class="literal">math.rad(</code><span class="emphasis"><em>angle in degrees</em></span><code class="literal">)</code>: Returns the number of radians in the specified number of degrees. For example, this redefines <code class="literal">math.sin</code> to accept its angle argument in degrees rather than radians:</p><pre class="programlisting">math._sin = math.sin

<em class="replaceable"><code>-- Redefine math.sin to accept angle in degrees</code></em>

math.sin = function(degrees)
  return math._sin(math.rad(degrees))
end

io.write(" x sin(x)\n")
io.write("--- ------\n")
for Deg = 0, 360, 90 do
  io.write(string.format("%3d %6.2f\n", Deg, math.sin(Deg)))
end</pre><p>The example prints the following table:</p><pre class="programlisting">x  sin(x)
---  ------
  0    0.00
 90    1.00
180    0.00
270   −1.00
360   −0.00</pre></li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="pseudo-random_number_functions"></a>Pseudo-Random Number Functions</h2></div></div></div><p>These functions are used to generate pseudo-random numbers:<a id="IDX-CHP-11-0174" class="indexterm"></a><a id="IDX-CHP-11-0175" class="indexterm"></a><a id="IDX-CHP-11-0176" class="indexterm"></a><a id="IDX-CHP-11-0177" class="indexterm"></a><a id="IDX-CHP-11-0178" class="indexterm"></a><a id="IDX-CHP-11-0179" class="indexterm"></a><a id="IDX-CHP-11-0180" class="indexterm"></a><a id="IDX-CHP-11-0181" class="indexterm"></a><a id="IDX-CHP-11-0182" class="indexterm"></a><a id="IDX-CHP-11-0183" class="indexterm"></a></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">math.randomseed(</code><span class="emphasis"><em>number</em></span><code class="literal">)</code>: Seeds the pseudo-random number generator. You can obtain identical sequences of pseudo-random numbers by calling this function with the same value.</p></li><li class="listitem"><p><code class="literal">math.random(</code><span class="emphasis"><em>optional bound, optional bound</em></span><code class="literal">)</code>: Returns a pseudo-random number in one of three ways. If no argument is specified, the return value is greater than or equal to 0 and less than 1. If one number is specified, the return value is an integer greater than or equal to 1 and less than or equal to the specified argument. If two numbers are specified, the return value is an integer greater than or equal to the first argument and less than or equal to the second.</p></li></ul></div><p>This example shows how you can obtain identical sequences of pseudo-random numbers by seeding the generator with the same value:</p><pre class="programlisting">local Seed = os.clock()
for J = 1, 2 do
  math.randomseed(Seed)
  math.random() -- On some systems that shall remain nameless, the
    -- first call to math.random is easy enough to predict that it
    -- destroys the illusion of randomness; throw it away.
  for J = 1, 10 do
    io.write(math.random(100, 200), " ")
  end
  io.write("\n")
end</pre><p>The example prints identical sequences of numbers (the particular values depend on the seed value returned from <code class="literal">os.clock</code>):</p><pre class="programlisting">123 165 107 127 136 125 199 132 194 118
123 165 107 127 136 125 199 132 194 118</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="modulus_functions"></a>Modulus Functions</h2></div></div></div><p>These functions return the remainder of a division or the fractional part of an expression:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">math.modf(</code><span class="emphasis"><em>number</em></span><code class="literal">)</code>: Returns the integer and fractional portions of the specified number. Both of the return values carry the same sign as the argument.</p></li><li class="listitem"><p><code class="literal">math.fmod(</code><span class="emphasis"><em>numerator, denominator</em></span><code class="literal">)</code>: Returns the remainder of the numerator divided by the denominator. The return value is undefined for a denominator equal to 0.</p></li></ul></div><p>This example shows various manipulations of rational numbers:</p><pre class="programlisting">local function Rational(Num, Den)
  local Whole, Frac = math.modf(Num / Den)
  io.write(Num, " / ", Den, " = ", Whole, " + ", Frac, "\n")
  io.write(Num, " / ", Den, " = ", Whole, " + ",
    math.fmod(Num, Den), " / ", Den, "\n")
end</pre><pre class="programlisting">Rational(5, 3)
Rational(-5, 3)
Rational(5.2, math.pi)</pre><p>The example prints the following lines:<a id="IDX-CHP-11-0184" class="indexterm"></a><a id="IDX-CHP-11-0185" class="indexterm"></a><a id="IDX-CHP-11-0186" class="indexterm"></a><a id="IDX-CHP-11-0187" class="indexterm"></a><a id="IDX-CHP-11-0188" class="indexterm"></a><a id="IDX-CHP-11-0189" class="indexterm"></a><a id="IDX-CHP-11-0190" class="indexterm"></a><a id="IDX-CHP-11-0191" class="indexterm"></a><a id="IDX-CHP-11-0192" class="indexterm"></a></p><pre class="programlisting">5 / 3 = 1 + 0.66666666666667
5 / 3 = 1 + 2 / 3
-5 / 3 = −1 + −0.66666666666667
-5 / 3 = −1 + −2 / 3
5.2 / 3.1415926535898 = 1 + 0.65521140815571
5.2 / 3.1415926535898 = 1 + 2.0584073464102 / 3.1415926535898</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="minimum_and_maximum_functions"></a>Minimum and Maximum Functions</h2></div></div></div><p>These functions return the minimum or maximum value in a list of values:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">math.max(</code><span class="emphasis"><em>one or more numbers</em></span><code class="literal">)</code>: Returns the greatest value in the specified list.</p></li><li class="listitem"><p><code class="literal">math.min(</code><span class="emphasis"><em>one or more numbers</em></span><code class="literal">)</code>: Returns the smallest value in the specified list.</p></li></ul></div><p>This example returns the minimum and maximum values from an array:</p><pre class="programlisting">local function Range(...)
  io.write("Count: ", select("#", ...), ", Min: ", math.min(...),
    ", Max: ", math.max(...), "\n")
end

Range(3, 1, 72, 5.4, math.pi)</pre><p>The following line is printed by the example:</p><pre class="programlisting">Count: 5, Min: 1, Max: 72</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="constants"></a>Constants</h2></div></div></div><p>These are not functions, but numbers that may be useful in certain calculations:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">math.huge</code>: A number greater than or equal to any other number. This is positive infinity on systems that have a representation for infinity. The following example multiplies each number from <code class="literal">NumListA</code> with its counterpart in <code class="literal">NumListB</code> and prints the highest product obtained. <code class="literal">Max</code> is initialized to <code class="literal">-math.huge</code> (note the unary minus), which is guaranteed not to be greater than any of the actual maximum products.</p><pre class="programlisting">NumListA = {2, 5, 3}
NumListB = {5, 3, 2}
local Max = -math.huge
for I, NumA in ipairs(NumListA) do
  local NumB = NumListB[I]
  Max = math.max(Max, NumA * NumB)
end
io.write("The maximum product was ", Max, ".\n")</pre><p>The example prints the following:<a id="IDX-CHP-11-0193" class="indexterm"></a><a id="IDX-CHP-11-0194" class="indexterm"></a><a id="IDX-CHP-11-0195" class="indexterm"></a><a id="IDX-CHP-11-0196" class="indexterm"></a><a id="IDX-CHP-11-0197" class="indexterm"></a><a id="IDX-CHP-11-0198" class="indexterm"></a><a id="IDX-CHP-11-0199" class="indexterm"></a><a id="IDX-CHP-11-0200" class="indexterm"></a><a id="IDX-CHP-11-0201" class="indexterm"></a><a id="IDX-CHP-11-0202" class="indexterm"></a></p><pre class="programlisting">The maximum product was 15.</pre></li><li class="listitem"><p><code class="literal">math.pi</code>: The ratio of a circle's circumference to its diameter. For example, this computes a circle's area from its radius:</p><pre class="programlisting">function CircleArea(Radius)
  return math.pi * Radius ^ 2
end

Radius = 5
io.write("radius: ", Radius, " feet; area: ",
  CircleArea(Radius), " square feet\n")</pre><p>The example prints the following:</p><pre class="programlisting">radius: 5 feet; area: 78.539816339745 square feet</pre></li></ul></div></div></div><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="input_solidus_output_library"></a>Input/Output Library</h1></div></div></div><p>The functions in the input/output (I/O) library enable your program to read from and write to files and the standard input/output streams.<a id="IDX-CHP-11-0203" class="indexterm"></a><a id="IDX-CHP-11-0204" class="indexterm"></a></p><p>By default, the <code class="literal">io.read</code> and <code class="literal">io.write</code> functions read from and write to standard input and standard output respectively. You can change this behavior with the <code class="literal">io.input</code> and <code class="literal">io.output</code> functions.</p><p>When working with multiple files, it is usually more convenient to obtain file handles and use their associated methods for reading, writing and performing other file operations.</p><p>Here are all the functions in the I/O library:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">io.close(</code><span class="emphasis"><em>optional file</em></span><code class="literal">)</code>: Closes the default output file if no argument is specified; otherwise it closes the specified file. (See also the file handle <code class="literal">close</code> method.)</p></li><li class="listitem"><p><code class="literal">io.flush()</code>: Commits the default output buffer.</p></li><li class="listitem"><p><code class="literal">io.input(</code><span class="emphasis"><em>optional file or name of file</em></span><code class="literal">)</code>: Returns the default input file handle if called without an argument. If it is called with a handle to an open file, the file becomes the new default input file so that calls to <code class="literal">io.read</code> read from it. If the function is called with the name of a file, the file is opened in text mode and becomes the new default input file.</p></li><li class="listitem"><p><code class="literal">io.lines(</code><span class="emphasis"><em>optional name of file</em></span><code class="literal">)</code>: Returns an iterator for use in a generic <code class="literal">for</code> loop. If a filename is specified, the file is opened in text mode. When all lines have been read, the file is closed. If no argument is specified, the <code class="literal">for</code> loop reads lines from the default input file. In this case, the file is not closed after all lines have been read.</p></li><li class="listitem"><p><code class="literal">io.open(</code><span class="emphasis"><em>name of file, optional open mode</em></span><code class="literal">)</code>: Opens the specified file and returns a handle to it. (The returned file handle's methods are discussed later in this section.) If an error occurs, it returns <code class="literal">nil</code> followed by an error message. If the open mode is missing, the file is opened in text mode for reading. The following table lists the supported modes.</p><div class="blockquote"><blockquote class="blockquote"><p>On platforms such as Windows, you can disable the control code processing done for text files by appending "<code class="literal">b"</code> to the open mode, which opens the file in binary mode.<a id="IDX-CHP-11-0205" class="indexterm"></a><a id="IDX-CHP-11-0206" class="indexterm"></a><a id="IDX-CHP-11-0207" class="indexterm"></a><a id="IDX-CHP-11-0208" class="indexterm"></a><a id="IDX-CHP-11-0209" class="indexterm"></a><a id="IDX-CHP-11-0210" class="indexterm"></a></p></blockquote></div><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col1"><col class="col2"></colgroup><thead><tr><th style="text-align: left" valign="bottom"><p>Mode</p></th><th style="text-align: left" valign="bottom"><p>Description</p></th></tr></thead><tbody><tr><td style="text-align: left" valign="top"><p><code class="literal">"r"</code></p></td><td style="text-align: left" valign="top"><p>Opens an existing file for reading</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">"w"</code></p></td><td style="text-align: left" valign="top"><p>Overwrites an existing file, or creates a new file, for writing</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">"a"</code></p></td><td style="text-align: left" valign="top"><p>Opens an existing file, or creates a new file, for appending</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">"r+"</code></p></td><td style="text-align: left" valign="top"><p>Opens an existing file for reading and writing</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">"w+"</code></p></td><td style="text-align: left" valign="top"><p>Overwrites an existing file, or creates a new file, for reading and writing</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">"a+"</code></p></td><td style="text-align: left" valign="top"><p>Opens an existing file, or creates a new file, for reading and appending</p></td></tr></tbody></table></div></li><li class="listitem"><p><code class="literal">io.output(</code><span class="emphasis"><em>optional file or name of file</em></span><code class="literal">)</code>: Returns the default output file handle if called without an argument. If it is called with a handle to an open file, the file becomes the new default output file so that calls to <code class="literal">io.write</code> write to it. If the function is called with the name of a file, the file is opened in "<code class="literal">w"</code> mode (that is, it is overwritten if it exists, or created if it doesn't) and becomes the new default output file.</p></li><li class="listitem"><p><code class="literal">io.read(</code><span class="emphasis"><em>zero or more of "</em></span><code class="literal">*a"</code> <span class="emphasis"><em>or "</em></span><code class="literal">*n"</code> <span class="emphasis"><em>or "</em></span><code class="literal">*l"</code> <span class="emphasis"><em>or number</em></span><code class="literal">)</code>: Returns the next line from the default input file if no argument is specified. The argument specifies what kind and how much data is to be read. Its meaning is summarized in the following table.</p><div class="blockquote"><blockquote class="blockquote"><p>If data corresponding to the specified format cannot be read, <code class="literal">nil</code> is returned (but is not followed with an error message).</p></blockquote></div><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col1"><col class="col2"></colgroup><thead><tr><th style="text-align: left" valign="bottom"><p>Format</p></th><th style="text-align: left" valign="bottom"><p>Description</p></th></tr></thead><tbody><tr><td style="text-align: left" valign="top"><p><code class="literal">"*n"</code></p></td><td style="text-align: left" valign="top"><p>Reads and returns a number</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">"*a"</code></p></td><td style="text-align: left" valign="top"><p>Reads the complete remainder of file</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">"*l"</code></p></td><td style="text-align: left" valign="top"><p>Reads the next line, and removes the end-of-line marker</p></td></tr><tr><td style="text-align: left" valign="top"><p>number</p></td><td style="text-align: left" valign="top"><p>Reads the specified number of bytes</p></td></tr></tbody></table></div></li><li class="listitem"><p><code class="literal">io.tmpfile()</code>: Opens a temporary file for reading and writing and returns a handle to it. When the program ends normally, this file will be deleted.</p></li><li class="listitem"><p><code class="literal">io.type(</code><span class="emphasis"><em>file</em></span><code class="literal">)</code>: Returns "<code class="literal">file"</code>, "<code class="literal">closed file"</code>, or <code class="literal">nil</code> depending on the argument.</p></li><li class="listitem"><p><code class="literal">io.write(</code><span class="emphasis"><em>zero or more strings or numbers</em></span><code class="literal">)</code>: Writes each of its arguments to the default output file, and returns <code class="literal">true</code> if the write is successful. An error is issued if the default output file is closed or a value other than a string or number is written. In certain cases (for example, if the full disk is full), <code class="literal">nil</code> followed by an error message is returned.</p></li><li class="listitem"><p><code class="literal">io.popen(</code><span class="emphasis"><em>shell command, optional mode</em></span><code class="literal">)</code>: Launches the specified command and returns a handle. If the mode is "<code class="literal">r"</code> or not given, this handle can be used as a file handle to read the standard output of the command. If it is "<code class="literal">w"</code>, the handle can be used to write to the command's standard input. This function is not available on all platforms.<a id="IDX-CHP-11-0211" class="indexterm"></a><a id="IDX-CHP-11-0212" class="indexterm"></a><a id="IDX-CHP-11-0213" class="indexterm"></a><a id="IDX-CHP-11-0214" class="indexterm"></a><a id="IDX-CHP-11-0215" class="indexterm"></a><a id="IDX-CHP-11-0216" class="indexterm"></a><a id="IDX-CHP-11-0217" class="indexterm"></a></p></li></ul></div><p>This example demonstrates the execution of a command and the capturing of its output:</p><pre class="programlisting">Hnd, ErrStr = io.popen("lua -h")
 if Hnd then
  for Str in Hnd:lines() do
    io.write(Str, "\n")
  end
  Hnd:close()
else
  io.write(ErrStr, "\n")
end</pre><p>The example produces the following output:</p><pre class="programlisting">usage: lua [options] [script [args]].
Available options are:
  -e stat  execute string 'stat'
  -l name  require library 'name'
  -i       enter interactive mode after executing 'script'
  -v       show version information
  --       stop handling options
  -        execute stdin and stop handling options</pre><p>The following functions are all the methods of file handles:<a id="IDX-CHP-11-0218" class="indexterm"></a></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="emphasis"><em>file handle</em></span><code class="literal">:close()</code>: Closes the file.</p></li><li class="listitem"><p><span class="emphasis"><em>file handle</em></span><code class="literal">:flush()</code>: Commits the file's output buffer.</p></li><li class="listitem"><p><span class="emphasis"><em>file handle</em></span><code class="literal">:lines()</code>: Like <code class="literal">io.lines</code>, this returns an iterator for use in a generic <code class="literal">for</code> loop using the specified file for input. Unlike <code class="literal">io.lines</code>, it does not close file associated file after the traversal.</p></li><li class="listitem"><p><span class="emphasis"><em>file handle</em></span><code class="literal">:read(</code><span class="emphasis"><em>zero or more of "</em></span><code class="literal">*a"</code> <span class="emphasis"><em>or "</em></span><code class="literal">*n"</code> <span class="emphasis"><em>or "</em></span><code class="literal">*l"</code> <span class="emphasis"><em>or number</em></span><code class="literal">)</code>: Like <code class="literal">io.read</code>, this reads data from the specified file.</p></li><li class="listitem"><p><span class="emphasis"><em>file handle</em></span><code class="literal">:seek(</code><span class="emphasis"><em>optional "</em></span><code class="literal">set"</code> <span class="emphasis"><em>or "</em></span><code class="literal">cur"</code> <span class="emphasis"><em>or "</em></span><code class="literal">end"</code><span class="emphasis"><em>, optional offset</em></span><code class="literal">)</code>: Sets the file pointer in the specified file and returns the new position measured from the beginning of the file. Unlike most Lua index values, the offsets to this function are zero-based. The offset is measured from the beginning of the file if the first argument is <code class="literal">"set"</code>; from the current position in the file if it's <code class="literal">"cur"</code>; or from the end of the file if it's <code class="literal">"end"</code>. The default argument values are "<code class="literal">cur"</code> and <code class="literal">0</code>, so the current file position can be obtained by calling this function without arguments.</p></li><li class="listitem"><p><code class="literal">file handle:setvbuf("no"</code> <span class="emphasis"><em>or "</em></span><code class="literal">full"</code> <span class="emphasis"><em>or "</em></span><code class="literal">line"</code><span class="emphasis"><em>, optional size</em></span><code class="literal">)</code>: Configures the buffering used by the specified file. The size argument specifies the size of the buffer in bytes. This function returns <code class="literal">true</code> on success, or <code class="literal">nil</code> followed by an error message on failure. The following table describes the buffering modes. (For more detail on this function, consult the documentation for the C function <code class="literal">setvbuf</code>.)</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col1"><col class="col2"></colgroup><thead><tr><th style="text-align: left" valign="bottom"><p>Mode<a id="IDX-CHP-11-0219" class="indexterm"></a><a id="IDX-CHP-11-0220" class="indexterm"></a><a id="IDX-CHP-11-0221" class="indexterm"></a><a id="IDX-CHP-11-0222" class="indexterm"></a></p></th><th style="text-align: left" valign="bottom"><p>Description</p></th></tr></thead><tbody><tr><td style="text-align: left" valign="top"><p><code class="literal">"no"</code></p></td><td style="text-align: left" valign="top"><p>Writes are committed without buffering.</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">"full"</code></p></td><td style="text-align: left" valign="top"><p>Writes are committed only when buffer is full or explicitly flushed.</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">"line"</code></p></td><td style="text-align: left" valign="top"><p>Writes are committed when a newline is encountered, when the buffer is explicitly flushed, or when input from a special device is detected.</p></td></tr></tbody></table></div></li><li class="listitem"><p><span class="emphasis"><em>file handle</em></span><code class="literal">:write(</code><span class="emphasis"><em>zero or more strings or numbers</em></span><code class="literal">)</code>: Writes each of its arguments to the file. An error is issued if the file is closed or a value other than a string or number is written. In certain cases (for example, if the disk is full), this function returns <code class="literal">nil</code> followed by an error message.</p></li></ul></div><p>This example demonstrates full buffering with a file so that only a full buffer or explicit flush commits the written data to the file, as well as file pointer positioning:</p><pre class="programlisting">FileStr = "test.txt"
Hnd, ErrStr = io.open(FileStr, "w")
if Hnd then
  Hnd:setvbuf("full", 1024)
  for K = 1, 4 do
    if K == 3 then
      Pos = Hnd:seek("cur", 0)
      Hnd:write("Special line\n")
    end
    Hnd:write(string.format("Line %02d\n", K))
  end
  Hnd:flush()
  Hnd:close()
  Hnd, ErrStr = io.open(FileStr, "r")
  if Hnd then
    for Str in Hnd:lines() do
      io.write(Str, "\n")
    end
    Hnd:seek("set", Pos)
    Str = Hnd:read("*l")
    io.write(Str, "\n")
    Hnd:close()
  else
    io.write(ErrStr)
  end
else
  io.write(ErrStr)
end</pre><p>The example prints the following lines:</p><pre class="programlisting">Line 01
Line 02
Special line
Line 03
Line 04
Special line</pre></div><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="operating_system_library"></a>Operating System Library</h1></div></div></div><p>These functions provide access to the operating system's time, date, shell, and file management services.<a id="IDX-CHP-11-0223" class="indexterm"></a><a id="IDX-CHP-11-0224" class="indexterm"></a><a id="IDX-CHP-11-0225" class="indexterm"></a><a id="IDX-CHP-11-0226" class="indexterm"></a><a id="IDX-CHP-11-0227" class="indexterm"></a><a id="IDX-CHP-11-0228" class="indexterm"></a><a id="IDX-CHP-11-0229" class="indexterm"></a><a id="IDX-CHP-11-0230" class="indexterm"></a><a id="IDX-CHP-11-0231" class="indexterm"></a><a id="IDX-CHP-11-0232" class="indexterm"></a></p><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="cpu_timing"></a>CPU Timing</h2></div></div></div><p>Identifying bottlenecks is sometimes as simple as monitoring the amount of time the central processing unit spends on various parts of a Lua program. In general, you should repeat the code you want to examine a sufficient number of times with a loop so that you have figures well above the noise level.</p><p>The operating system library includes the <code class="literal">os.clock()</code> timing function, which returns the approximate number of CPU time measured in seconds used by the current program. For example, this gives a benchmark for adding elements to an array:<a id="IDX-CHP-11-0233" class="indexterm"></a><a id="IDX-CHP-11-0234" class="indexterm"></a></p><pre class="programlisting">local Count = 1e7
local Tbl = {}
local Tm = os.clock()
for J = 1, Count do
 table.insert(Tbl, J)
end
io.write("table.insert: ", os.clock() - Tm, " sec\n")
Tbl = {}
Tm = os.clock()
for J = 1, Count do
 Tbl[#Tbl + 1] = J
end
io.write("Indexed insert: ", os.clock() - Tm, " sec\n")</pre><p>The example prints the following lines:</p><pre class="programlisting">table.insert: 5.328 sec
Indexed insert: 3.906 sec</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="time_and_date_functions"></a>Time and Date Functions</h2></div></div></div><p>The functions in the time and date category are flexible enough to handle a wide spectrum of applications:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">os.date(</code><span class="emphasis"><em>optional format string, optional time value</em></span><code class="literal">)</code>: Returns the current time or the specified time either as a string or as an associative table. A table is returned if the format string is "<code class="literal">*t"</code>; otherwise it uses the same format specification as <code class="literal">strftime</code> in the standard C library. To return the time in Universal Coordinated Time format, prepend the format specifier with "<code class="literal">!"</code>. If you don't specify a time value, the current time is used. If you do specify it, use the format returned by <code class="literal">os.time</code>.</p></li><li class="listitem"><p><code class="literal">os.difftime(</code><span class="emphasis"><em>high time, low time</em></span><code class="literal">)</code>: The difference is seconds between the two time arguments is returned. Use the format returned by <code class="literal">os.time</code> for the arguments.</p></li><li class="listitem"><p><code class="literal">os.time(</code><span class="emphasis"><em>optional time table</em></span><code class="literal">)</code>: Returns the specified time as a scalar value, often the number of seconds that have passed in a standard epoch. If you do not specify the time argument, the current time is used. If you do specify it, do so with a table that contains the <code class="literal">year, month</code> and <code class="literal">day</code> fields. You can include <code class="literal">hour, min, sec</code> and <code class="literal">isdst</code> in the table as well.</p></li></ul></div><p>The following example calculates the number of seconds from a given moment:<a id="IDX-CHP-11-0235" class="indexterm"></a><a id="IDX-CHP-11-0236" class="indexterm"></a><a id="IDX-CHP-11-0237" class="indexterm"></a><a id="IDX-CHP-11-0238" class="indexterm"></a></p><pre class="programlisting">TmStart = os.time{year = 2001, month = 1, day = 1, hour = 0}
TmNow = os.time()
io.write(os.difftime(TmNow, TmStart), " seconds have passed since ",
 os.date("%d %B %Y", TmStart), "\n")</pre><p>The following line is printed by the example:</p><pre class="programlisting">180787215 seconds have passed since 01 January 2001</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="filesystem_functions"></a>Filesystem Functions</h2></div></div></div><p>In addition to the I/O functions, the standard C library provides paltry support for managing files. (A number of modules for Lua remedy this deficiency.)</p><p>The filesystem functions are as follows:<a id="IDX-CHP-11-0239" class="indexterm"></a></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">os.remove(</code><span class="emphasis"><em>name of file</em></span><code class="literal">)</code>: Removes the specified file. If successful, this returns <code class="literal">true</code>; otherwise it returns <code class="literal">nil</code> followed by an error message. On Unix-type systems, you can use this function to remove an empty directory.</p></li><li class="listitem"><p><code class="literal">os.rename(</code><span class="emphasis"><em>old name of file, new name of file</em></span><code class="literal">)</code>: Renames a file or directory.</p></li><li class="listitem"><p><code class="literal">os.tmpname()</code>: Returns a name that can you can use to create a temporary file or directory.</p></li></ul></div><p>This example demonstrates how a temporary file is created, written to, closed, and then read from:</p><pre class="programlisting">FileStr = os.tmpname()
Hnd = io.open(FileStr, "w")
if Hnd then
  io.write("Opened temporary file ", FileStr, " for writing\n")
  Hnd:write("Line 1\nLine 2\nLine 3\n")
  Hnd:close()
  for Str in io.lines(FileStr) do
    io.write(Str, "\n")
  end
  os.remove(FileStr)
else
  io.write("Error opening ", FileStr, " for writing\n")
end</pre><p>The following lines are printed by the example:</p><pre class="programlisting">Opened temporary file /tmp/lua_a05eSj for writing
Line 1
Line 2
Line 3</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="other_operating_system_functions"></a>Other Operating System Functions</h2></div></div></div><p>The remaining functions in the <code class="literal">os</code> table let your Lua script interact with the operating shell and its environment variables, and use locale settings to control language- and country-specific behavior:<a id="IDX-CHP-11-0240" class="indexterm"></a><a id="IDX-CHP-11-0241" class="indexterm"></a><a id="IDX-CHP-11-0242" class="indexterm"></a><a id="IDX-CHP-11-0243" class="indexterm"></a><a id="IDX-CHP-11-0244" class="indexterm"></a><a id="IDX-CHP-11-0245" class="indexterm"></a><a id="IDX-CHP-11-0246" class="indexterm"></a></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">os.execute(</code><span class="emphasis"><em>optional shell command string</em></span><code class="literal">)</code>: The specified command is passed to the shell for execution. The code returned from the shell is in turn returned by this function. If the command is missing, this function checks for the existence of the shell, returning a non-zero value if it is available and zero if it is not.</p></li><li class="listitem"><p><code class="literal">os.exit(</code><span class="emphasis"><em>optional integer code</em></span><code class="literal">)</code>: Terminates the host program. If the exit code is missing, the library will provide the code that indicates success for the platform on which the host is running; this is usually zero.</p></li><li class="listitem"><p><code class="literal">os.getenv(</code><span class="emphasis"><em>variable name string</em></span><code class="literal">)</code>: Retrieves the value associated with the argument in the environment of the current process. If the name doesn't exist in the environment, <code class="literal">nil</code> is returned.</p></li><li class="listitem"><p><code class="literal">os.setlocale(</code><span class="emphasis"><em>locale string, optional "</em></span><code class="literal">all"</code> <span class="emphasis"><em>or "</em></span><code class="literal">collate"</code> <span class="emphasis"><em>or "</em></span><code class="literal">ctype"</code> <span class="emphasis"><em>or "</em></span><code class="literal">monetary"</code> <span class="emphasis"><em>or "</em></span><code class="literal">numeric"</code> <span class="emphasis"><em>or "</em></span><code class="literal">time")</code>: Queries or sets locale information for the current program. To perform a query, specify <code class="literal">nil</code> as the first argument. To set the locale information, specify a locale string such as "<code class="literal">pt_BR"</code> or "<code class="literal">en_US"</code>. The supported categories are "<code class="literal">all"</code>, "<code class="literal">collate"</code>, "<code class="literal">ctype"</code>, "<code class="literal">monetary"</code>, "<code class="literal">numeric"</code>, and "<code class="literal">time"</code>. If the category is missing, "<code class="literal">all"</code> is assumed.</p></li></ul></div><p>Here is an example of <code class="literal">os.execute, os.getenv, os.setlocale</code>, and <code class="literal">os.exit</code> in action:</p><pre class="programlisting">print("os.execute returned:", os.execute("ls -sh")) -- "ls" is a
 -- directory listing program available on Unix-like systems.
print("HOME environment variable:", os.getenv("HOME"))
assert(os.setlocale("pt_BR", "numeric"))
print(math.pi) -- Prints with a comma!
os.exit()
print("This will never get printed!")</pre><p>The example's output is as follows:</p><pre class="programlisting">total 8.0K
4.0K calltrace.lua
4.0K test.lua
os.execute returned: 0
HOME environment variable:  /home/wthrall
3,1415926535898</pre></div></div><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="debugging_library"></a>Debugging Library</h1></div></div></div><p>The functions in the <code class="literal">debug</code> namespace table are not for normal use, but for writing error handlers, debuggers, profilers, and other things that need to do introspection (the inspection of running code). For a more detailed discussion of these functions, see <a class="link" href="ch10.html" title="Chapter 10. Looking Under the Hood">Chapter 10</a>.</p><p>Some of these functions take an optional thread argument. Those functions work on the given thread, or (by default) on the currently running thread. Even if the thread argument is omitted, you can specify other arguments by shifting their positions to the left. For example, you can use the <code class="literal">debug.getinfo</code> function or stack level argument as either its first or second argument, depending on whether the optional thread argument was given. Arguments that are stack levels, local indexes, or upvalue indexes are positive integers, with <code class="literal">1</code> representing the top of the stack, the first local variable, or the first upvalue.<a id="IDX-CHP-11-0247" class="indexterm"></a><a id="IDX-CHP-11-0248" class="indexterm"></a><a id="IDX-CHP-11-0249" class="indexterm"></a><a id="IDX-CHP-11-0250" class="indexterm"></a><a id="IDX-CHP-11-0251" class="indexterm"></a><a id="IDX-CHP-11-0252" class="indexterm"></a><a id="IDX-CHP-11-0253" class="indexterm"></a><a id="IDX-CHP-11-0254" class="indexterm"></a><a id="IDX-CHP-11-0255" class="indexterm"></a><a id="IDX-CHP-11-0256" class="indexterm"></a><a id="IDX-CHP-11-0257" class="indexterm"></a><a id="IDX-CHP-11-0258" class="indexterm"></a></p><p>The following functions are in the debugging library:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">debug.debug()</code>: Reads and interprets lines from standard input, and returns when it reads a line consisting of the word "<code class="literal">cont</code>". Local variables visible in the scope where <code class="literal">debug.debug</code> is called are only accessible using <code class="literal">debug.getlocal, debug.setlocal, debug.getupvalue</code>, and <code class="literal">debug.setupvalue</code>.</p></li><li class="listitem"><p><code class="literal">debug.getfenv(</code><span class="emphasis"><em>function or thread or userdata</em></span><code class="literal">)</code>: Returns its argument's environment table.</p></li><li class="listitem"><p><code class="literal">debug.gethook(</code><span class="emphasis"><em>optional thread</em></span><code class="literal">)</code>: Returns the current hook function, the current hook mask (a string containing zero or more of "<code class="literal">c"</code>, "<code class="literal">l"</code>, and "<code class="literal">r"</code>), and the current hook count.</p></li><li class="listitem"><p><code class="literal">debug.getinfo(</code><span class="emphasis"><em>optional thread, function or stack level, optional flag string</em></span><code class="literal">)</code>: If a function is given, this returns an associative table of information about that function; if a stack level is given, it returns an associative table of information about the function running at that stack level, or <code class="literal">nil</code> if the stack level is invalid. By default, the returned table includes the fields <code class="literal">currentline, func, lastlinedefined, linedefined, name, namewhat, nups, short_src, source</code>, and <code class="literal">what</code>. The letters in the flag string control which fields the table contains. For example, if the flag string contains an "<code class="literal">L"</code>, then the table will include an <code class="literal">activelines</code> field. (For more details, see the table in <a class="link" href="ch10.html" title="Chapter 10. Looking Under the Hood">Chapter 10</a>.)</p></li><li class="listitem"><p><code class="literal">debug.getlocal(</code><span class="emphasis"><em>optional thread, stack level, local index</em></span><code class="literal">)</code>: Returns the name and value of the numerically specified local variable at the specified stack level. If the local index is higher than the amount of local variables at the specified stack level, <code class="literal">nil</code> is returned. If the stack level is higher than the amount of active stack levels, an error occurs.</p></li><li class="listitem"><p><code class="literal">debug.getmetatable(</code><span class="emphasis"><em>value</em></span><code class="literal">)</code>: Returns its argument's metatable if one is present; otherwise it returns <code class="literal">nil</code>. This function bypasses its argument's <code class="literal">__metatable</code> metamethod if one is present.</p></li><li class="listitem"><p><code class="literal">debug.getregistry()</code>: Returns the <span class="emphasis"><em>registry table</em></span>, a table that C code can use as a storage area.</p></li><li class="listitem"><p><code class="literal">debug.getupvalue(</code><span class="emphasis"><em>function, upvalue index</em></span><code class="literal">)</code>: Returns the name and value of the numerically specified upvalue of the given function. If the upvalue index is higher than the function's amount of upvalues, <code class="literal">nil</code> is returned.</p></li><li class="listitem"><p><code class="literal">debug.setfenv(</code><span class="emphasis"><em>function or thread or userdata, environment table</em></span><code class="literal">)</code>: Gives an environment table to a function, thread, or userdata.</p></li><li class="listitem"><p><code class="literal">debug.sethook(</code><span class="emphasis"><em>optional thread, hook function, hook mask string with "</em></span><code class="literal">c"</code> <span class="emphasis"><em>and/or "</em></span><code class="literal">r"</code> <span class="emphasis"><em>and/or "</em></span><code class="literal">l"</code><span class="emphasis"><em>, optional instruction count</em></span><code class="literal">)</code>: Makes the given function the <span class="emphasis"><em>hook</em></span> (a function that is called by Lua when certain events happen). The hook mask (a string) and the instruction count determine which events trigger the hook. If the hook mask contains "<code class="literal">c"</code>, then on every function call (including tail calls), the hook will be called with the "<code class="literal">call"</code> argument. If the hook mask contains "<code class="literal">r"</code>, then on every return (including tail returns) the hook will be called with the "<code class="literal">return"</code> or "<code class="literal">tail return"</code> argument. If the hook mask contains "<code class="literal">l"</code>, then on every source code line (except for lines where nothing happens) the hook will be called with the "<code class="literal">line"</code> and the line number arguments. If there is a nonzero instruction count, then every time that many bytecode instructions have been executed, the hook will be called with the "<code class="literal">count"</code> argument. If <code class="literal">nil</code> is given instead of a function, then any function that is currently set as the hook is removed.</p></li><li class="listitem"><p><code class="literal">debug.setlocal(</code><span class="emphasis"><em>optional thread, stack level, local index, value</em></span><code class="literal">)</code>: Assigns the given value to the numerically specified local variable at the specified stack level, and returns the local variable's name. If the local index is higher than the amount of local variables at the specified stack level, <code class="literal">nil</code> is returned; if the stack level is higher than the amount of active stack levels, an error occurs.<a id="IDX-CHP-11-0259" class="indexterm"></a><a id="IDX-CHP-11-0260" class="indexterm"></a><a id="IDX-CHP-11-0261" class="indexterm"></a><a id="IDX-CHP-11-0262" class="indexterm"></a></p></li><li class="listitem"><p><code class="literal">debug.setmetatable(</code><span class="emphasis"><em>value, metatable</em></span><code class="literal">)</code>: Gives a metatable to the given value, even if that value has a <code class="literal">__metatable</code> metamethod.</p></li><li class="listitem"><p><code class="literal">debug.setupvalue(</code><span class="emphasis"><em>function, upvalue index, value</em></span><code class="literal">)</code>: Assigns the given value to the numerically specified upvalue of the given function, and returns the upvalue's name. If the upvalue index is higher than the function's amount of upvalues, <code class="literal">nil</code> is returned.</p></li><li class="listitem"><p><code class="literal">debug.traceback(</code><span class="emphasis"><em>optional thread, optional message string, optional level argument</em></span><code class="literal">)</code>: Returns a string containing the message string followed by a stack traceback. The level argument specifies which stack frame to start the traceback from, with <code class="literal">1</code> (the default) being the function that called <code class="literal">debug.traceback, 2</code> being the function that called that function, <code class="literal">3</code> being the function that called <span class="emphasis"><em>that</em></span> function, and so on.</p></li></ul></div><p>This example sets a hook that is called on every line and every function call and return, which then prints information about the current line, call, or return:</p><pre class="programlisting">function Hook(Event, LineNum)
 -- Info for the currently running function (not counting this hook):
 local Info = debug.getinfo(2)
 if Event == "call" then
   io.write("'", Info.name or "???", "' is being called; ")
   if Info.nups == 0 then
     io.write("it has no upvalues.\n")
   else
     io.write("its upvalues are:\n")
     for I = 1, Info.nups do
       local Name, Val = debug.getupvalue(Info.func, I)
       io.write(" ", Name, "\t", tostring(Val), "\n")
     end
   end
 elseif Event == "return" or Event == "tail return" then
   io.write("'", Info.name or "???", "' is being returned from.\n")
 elseif Event == "line" then
   local LclCount = 0

   -- An iterator that returns the names and values of the current
   -- function's local variables:
   local function Locals()
     LclCount = LclCount + 1
     return debug.getlocal(3, LclCount)
   end

   local Lcls = {}
   for LclName, LclVal in Locals do
     -- Ignore temporary locals used by the Lua virtual machine:
     if string.sub(LclName, 1, 1) ~= "(" then
       Lcls[#Lcls + 1] = LclName .. " (" .. tostring(LclVal) .. ")"
     end
   end
   io.write("line ", LineNum, "; ")</pre><pre class="programlisting">if #Lcls &gt; 0 then
     -- This doesn't include upvalues:
     io.write("in-scope local(s): ", table.concat(Lcls, ", "),
       "\n")
   else
     io.write("no in-scope locals.\n")
   end
 end
end

local Fruit1, Fruit2 = "banana", "kiwi"

function FncB()
 return Fruit1 .. "/" .. Fruit2 -- Line 48.
end

function FncA(Fruit)
 local Fruits = FncB() -- Line 52.
 return Fruit .. "/" .. Fruits -- Line 53.
end

debug.sethook(Hook, "crl")
print("### " .. FncA("apple")) -- Line 57.
debug.sethook(nil) -- Line 58.</pre><p>The example gives the following output:</p><pre class="programlisting">'sethook' is being returned from.
line 57; in-scope local(s): Fruit1 (banana), Fruit2 (kiwi)
'FncA' is being called; it has no upvalues.
line 52; in-scope local(s): Fruit (apple)
'FncB' is being called; its upvalues are:
  Fruit1  banana
  Fruit2  kiwi
line 48; no in-scope locals.
'FncB' is being returned from.
line 53; in-scope local(s): Fruit (apple), Fruits (banana/kiwi)
'FncA' is being returned from.
'print' is being called; it has no upvalues.
'???' is being called; it has no upvalues.
'???' is being returned from.
### apple/banana/kiwi
'print' is being returned from.
line 58; in-scope local(s): Fruit1 (banana), Fruit2 (kiwi)
'sethook' is being called; it has no upvalues.</pre></div><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="summary-034"></a>Summary</h1></div></div></div><p>In this chapter, you've reviewed some of the library functions from earlier in the book, and learned about others. Prior to this chapter, you learned about the Lua language. From this point on, you'll be exploring how Lua can serve as an integral component in real-world applications. The next chapter starts this off with a small survey of open-source libraries that work well with Lua.</p></div></div></div>



  <div class="t-sbo-prev sbo-prev sbo-nav-bottom">
  
    
      
        <a href="ch10.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">10. Looking Under the Hood</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-bottom">
  
    
      
        <a href="ch12.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">12. Using Community Libraries</div>
        </a>
    
  
  </div>


        
    </section>
  </div>
<section class="sbo-saved-archives"></section>



          
          
  




    
    
      <div id="js-subscribe-nag" class="subscribe-nag clearfix trial-panel t-subscribe-nag">
        
        

        
          <p>You have 6 days left in your trial, Michaelschiner. Subscribe today. <a href="https://learning.oreilly.com/subscribe/" class="ga-active-trial-subscribe-nag">See pricing options.</a></p>
        
        

      </div>

    
    



        
      </div>
      
        

<footer class="pagefoot t-pagefoot">
  <a href="ch11.html#" class="icon-up" onclick="window.Appcues.track('JumpTop_HeronBook')"><div class="visuallyhidden">Back to top</div></a>
  <ul class='js-footer-nav'>
  
    
    <li><a href="https://learning.oreilly.com/public/support/">Support</a></li>
    
    <li><a href="https://learning.oreilly.com/accounts/logout/">Sign Out</a></li>
    
  
  
  </ul>
  <span class="copyright">&#169; 2021 <a href="https://learning.oreilly.com/" target="_blank">O'Reilly Media, Inc</a>.</span>
  
    
    <a href="https://www.oreilly.com/terms/">Terms of Service</a> 
     / 
    
    <a href="https://learning.oreilly.com/privacy">Privacy Policy</a> 
    
    
  
</footer>

      
    
    <script src="https://learning.oreilly.com/jsi18n/web/" charset="utf-8"></script>
    <script src="https://learning.oreilly.com/library/jsi18n/appcache/" charset="utf-8"></script>
  </body>
</html>
