<!--[if IE]><![endif]--><!DOCTYPE html><!--[if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/beginning-lua-programming/9780470069172/apa.html"
data-csrf-cookie="csrfsafari"


  data-user-id="11366403"
  data-user-uuid="ce47de5b-ce80-49f0-b5cd-c60d3d33b198"
  data-username="michaelschiner"
  data-account-type="Trial"
  
  data-activated-trial-date="05/13/2021"


  data-archive="9780470069172"
  data-publishers="Wrox"



  data-htmlfile-name="apa.html"
  data-epub-title="Beginning Lua Programming" data-debug=0 data-testing=0><![endif]--><!--[if gt IE 8]><!--><html class="no-js" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/beginning-lua-programming/9780470069172/apa.html"
data-csrf-cookie="csrfsafari"


  data-user-id="11366403"
  data-user-uuid="ce47de5b-ce80-49f0-b5cd-c60d3d33b198"
  data-username="michaelschiner"
  data-account-type="Trial"
  
  data-activated-trial-date="05/13/2021"


  data-archive="9780470069172"
  data-publishers="Wrox"



  data-htmlfile-name="apa.html"
  data-epub-title="Beginning Lua Programming" data-debug=0 data-testing=0><!--<![endif]--><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="author" content="O'Reilly Media" /><meta name="format-detection" content="telephone=no"><meta http-equiv="cleartype" content="on"/><meta name="HandheldFriendly" content="True"/><meta name="MobileOptimized" content="320"/><meta name="apple-itunes-app" content="app-id=881697395, app-argument=safaridetail://9780470069172"/><link rel="shortcut icon" href="https://www.oreilly.com/favicon.ico" /><meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0"/><meta property="twitter:account_id" content="4503599627559754" /><link rel="shortcut icon" href="https://learning.oreilly.com/favicon.ico" type="image/x-icon"><link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900,200italic,300italic,400italic,600italic,700italic,900italic' rel='stylesheet' type='text/css'><title>A. Answers - Beginning Lua Programming</title><link rel="stylesheet" href="https://learning.oreilly.com/static/CACHE/css/output.5bdb4fcb2aad.css" type="text/css"><link rel="stylesheet" type="text/css" href="https://learning.oreilly.com/static/css/annotator.e3b0c44298fc.css"/><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css"><style type="text/css" title="ibis-book"></style><script> // <![CDATA[
    var g = {
      position_cache: {
        
          "chapter": "/api/v1/book/9780470069172/chapter/apa.html",
          "book_id": "9780470069172",
          "chapter_uri": "apa.html",
          "position": 0,
          "user_uuid": "ce47de5b-ce80-49f0-b5cd-c60d3d33b198",
          "next_chapter_uri": ""
        
      },
      title: "Beginning Lua Programming",
      author_list: "Aaron Brown, Kurt Jung",
      format: "book",
      source: "application/epub+zip",
      is_system_book: true,
      is_public: false,
      loaded_from_server: true,
      allow_scripts: false,
      has_mathml: false
    };
    // ]]></script><script src="https://learning.oreilly.com/static/js/src/modernizr.8e35451ddb64.js"></script><script>
    
      

      
        
          window.PUBLIC_ANNOTATIONS = true;
        
      

      window.MOBILE_PUBLIC_ANNOTATIONS = false;

    

    
      window.PRIVACY_CONTROL_OVERRIDE = false;
    

      window.PRIVACY_CONTROL_SWITCH = true;

      window.PUBLISHER_PAGES = true;

      window.SBO = {
        "constants": {
          "SITB_ENDPOINT": "/api/v2/sitb/",
          "SEARCH_SELECT_ENDPOINT": "https://learning.oreilly.com/api/v2/search/select/",
        }
      };
  </script><link rel="canonical" href="apa.html"/><meta name="description" content="Appendix A. Answers Chapter 2 Exercise 1 Solution Because the &quot;p&quot; in print needs to be lowercase. Exercise 2 Solution &quot;ABC123&quot; Exercise 3 Solution Because it reduces to the following, ... "><meta property="og:title" content="A. Answers" /><meta itemprop="isPartOf" content="/library/view/beginning-lua-programming/9780470069172/" /><meta itemprop="name" content="A. Answers" /><meta property="og:url" itemprop="url" content="https://learning.oreilly.com/library/view/beginning-lua-programming/9780470069172/apa.html" /><meta property="og:site_name" content="Safari" /><meta property="og:image" itemprop="thumbnailUrl" content="https://learning.oreilly.com/library/cover/9780470069172/" /><meta property="og:description" itemprop="description" content="Appendix A. Answers Chapter 2 Exercise 1 Solution Because the &quot;p&quot; in print needs to be lowercase. Exercise 2 Solution &quot;ABC123&quot; Exercise 3 Solution Because it reduces to the following, ... "><meta itemprop="inLanguage" content="en" /><meta itemprop="publisher" content="Wrox" /><meta property="og:type" content="book" /><meta property="og:book:isbn" itemprop="isbn" content="9780470069172" /><meta property="og:book:author" itemprop="author" content="Aaron Brown" /><meta property="og:book:author" itemprop="author" content="Kurt Jung" /><meta property="og:book:tag" itemprop="about" content="Core Programming" /><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@OReillyMedia"><style type="text/css" id="font-styles" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-size: <%= font_size %> !important; }"></style><style type="text/css" id="font-family" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-family: <%= font_family %> !important; }"></style><style type="text/css" id="column-width" data-template="#sbo-rt-content { max-width: <%= column_width %>% !important; margin: 0 auto !important; }"></style><noscript><meta http-equiv="refresh" content="0; URL=https://learning.oreilly.com/library/no-js/" /></noscript><script>
    var dataLayer = window.dataLayer || [];

    
      window.medalliaVsgUserIdentifier = 'ce47de5b-ce80-49f0-b5cd-c60d3d33b198';
      dataLayer.push({userIdentifier: 'ce47de5b-ce80-49f0-b5cd-c60d3d33b198'});
      dataLayer.push({loggedIn: 'yes'});

      
        window.medalliaVsgAccountIdentifier = '29964b7b-68d8-4532-9a9b-32e089689c1f';
        

        window.medalliaVsgIsIndividual = true;
        
          
          dataLayer.push({learningAccountType: 'free trial'});
          
        

        
      
    

    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-5P4V6Z');
    (function () {
      var VERSION = 'V1.1';
      var AUTHOR = 'Awwad';
      if (!window.GtmHelper)
        window.GtmHelper = function () {
          var instance = this;
          var loc = document.location;
          this.version = VERSION;
          this.author = AUTHOR;
          this.readCookie = function (name) {
            var nameEQ = name + "=";
            var ca = document.cookie.split(';');
            for (var i = 0; i < ca.length; i++) {
              var c = ca[i];
              while (c.charAt(0) == ' ') c = c.substring(1, c.length);
              if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
          };
          this.createCookie = function (name, value, days, cookieDomain) {
            var domain = "";
            var expires = "";

            if (days) {
              var date = new Date();
              date.setTime(date.getTime() + Math.ceil(days * 24 * 60 * 60 * 1000));
              var expires = " expires=" + date.toGMTString() + ";";
            }

            if (typeof (cookieDomain) != 'undefined')
              domain = " domain=" + cookieDomain + "; ";

            document.cookie = name + "=" + value + ";" + expires + domain + "path=/";
          };

          this.isDuplicated = function (currentTransactionId) {
            // the previous transaction id:
            var previousTransIdValue = this.readCookie("previousTransId");

            if (currentTransactionId === previousTransIdValue) {
              return true; // Duplication
            } else {
              return false;
            }
          };
        }
    })()
  </script><script defer src="https://learning.oreilly.com/static/js/build/vendor.0eac897f11ed.js"></script><script defer src="https://learning.oreilly.com/static/js/build/reader.c745ea9296ac.js"></script></head>


<body class="reading sidenav nav-collapsed  scalefonts">

    
  <noscript> 
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5P4V6Z"
            height="0" width="0"
            style="display:none;visibility:hidden">
    </iframe>
  </noscript>



    
      <div class="hide working" role="status">
        <div class="working-image"></div>
      </div>
      <div class="sbo-site-nav">
        

  


<a href="apa.html#container" class="skip">Skip to content</a><header class="topbar t-topbar"><nav role="navigation" class="js-site-nav"><ul class="topnav"><li><a href="https://learning.oreilly.com/home/" class="l0 nav-icn"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.738 14H9.254v-3.676a.617.617 0 0 0-.621-.613H7.39a.617.617 0 0 0-.62.613V14H4.284a.617.617 0 0 1-.622-.613V10.22c0-.327.132-.64.367-.87l3.547-3.493a.627.627 0 0 1 .875 0l3.54 3.499c.234.229.366.54.367.864v3.167a.617.617 0 0 1-.62.613zM7.57 2.181a.625.625 0 0 1 .882 0l5.77 5.692-.93.92-5.28-5.209-5.28 5.208-.932-.919 5.77-5.692z" /></svg><span>Home</span></a></li><li class="search"><a href="apa.html#" class="t-search-nav trigger nav-icn l0" data-dropdown-selector=".searchbox"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>search icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M31.3 0C20.9 0 12.5 8.4 12.5 18.8 12.5 22.5 13.6 25.9 15.4 28.8L1.2 42.9C-0.4 44.5-0.4 47.2 1.2 48.8 2 49.6 3.1 50 4.2 50 5.2 50 6.3 49.6 7.1 48.8L21.2 34.6C24.1 36.5 27.5 37.5 31.3 37.5 41.6 37.5 50 29.1 50 18.8 50 8.4 41.6 0 31.3 0ZM31.3 31.3C24.4 31.3 18.8 25.6 18.8 18.8 18.8 11.9 24.4 6.3 31.3 6.3 38.1 6.3 43.8 11.9 43.8 18.8 43.8 25.6 38.1 31.3 31.3 31.3Z"/></g></svg><span>Search</span></a></li><li class="usermenu dropdown"><a href="apa.html#" class="trigger l0 nav-icn nav-dropdown"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>navigation arrow</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M0.1 12.5L9.7 3.1C9.8 3 9.9 3 10 3 10.1 3 10.2 3 10.3 3.1L19.9 12.5C20 12.5 20 12.6 20 12.8 20 12.9 20 13 19.9 13L17 15.9C16.9 16 16.8 16 16.7 16 16.5 16 16.4 16 16.4 15.9L10 9.7 3.6 15.9C3.6 16 3.5 16 3.3 16 3.2 16 3.1 16 3 15.9L0.1 13C0 12.9 0 12.8 0 12.7 0 12.7 0 12.6 0.1 12.5Z"/></g></svg><span>Expand Nav</span></a><div class="drop-content"><ul><li class="flyout-parent"><a
                href="apa.html#"
                class="l1 nav-icn "
                
              ><?xml version="1.0" encoding="UTF-8"?><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M8,8 C6.34321755,8 5.00013,6.65691245 5.00013,5.00013 C5.00013,3.34334755 6.34321755,2.00026001 8,2.00026001 C9.65678245,2.00026001 10.99987,3.34334755 10.99987,5.00013 C10.99987,6.65691245 9.65678245,8 8,8 Z M2.33024571,11.3523547 L2.33774538,11.3523547 C3.7622187,9.70968996 5.82947484,8.76608166 8.00374984,8.76608166 C10.1780248,8.76608166 12.245281,9.70968996 13.6697543,11.3523547 C13.8892083,11.6177474 14.0062813,11.9530021 13.99974,12.2973138 L13.99974,13.99974 L2.00026001,13.99974 L2.00026001,12.2973138 C1.99371867,11.9530021 2.11079172,11.6177474 2.33024571,11.3523547 Z" id="path-1"></path></svg><span>Your O&#39;Reilly</span></a><ul class="flyout"><li><a
                    href="https://learning.oreilly.com/profile/"
                    class="l2 nav-icn"
                    
                  ><span>Profile</span></a></li><li><a
                    href="https://learning.oreilly.com/history/"
                    class="l2 nav-icn"
                    
                  ><span>History</span></a></li><li><a
                    href="https://learning.oreilly.com/playlists/"
                    class="l2 nav-icn"
                    
                  ><span>Playlists</span></a></li><li><a
                    href="https://learning.oreilly.com/u/ce47de5b-ce80-49f0-b5cd-c60d3d33b198/"
                    class="l2 nav-icn"
                    
                  ><span>Highlights</span></a></li></ul></li><li ><a
                href="https://learning.oreilly.com/answers/"
                class="l1 nav-icn "
                
              ><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path d="M2.31032699,3.75609006 C4.65421571,1.41371359 8.45302454,1.41472092 10.7955702,3.75860838 C13.1381158,6.10249583 13.1369405,9.90130261 10.7930518,12.243847 C8.44916311,14.5863913 4.65018639,14.5852161 2.30780867,12.2413286 C-0.0346204845,9.89749489 -0.0334929936,6.09853298 2.31032699,3.75609006 Z M8.8198605,4.98016308 C7.34193969,3.86924672 5.23410194,3.98609692 3.88914868,5.33104946 C3.12814393,6.09032122 2.72818176,7.13880077 2.79015179,8.21201133 C2.79115912,8.23064692 2.79233434,8.24928252 2.79350956,8.26791811 L2.79350956,8.26791811 C2.83179539,8.8307976 2.9944077,9.37404287 3.26947292,9.86201677 L3.26947292,9.86201677 L2.77621706,11.7027432 C2.7699968,11.7259241 2.77662063,11.7506624 2.79359185,11.7676337 C2.8105631,11.7846049 2.83530144,11.7912287 2.85848233,11.7850085 L2.85848233,11.7850085 L4.69400524,11.2922565 C5.26306363,11.6167344 5.90703177,11.786885 6.56209849,11.7858479 C8.64827865,11.7858479 10.3395879,10.094542 10.3395879,8.00836292 C10.3405204,6.84135608 9.80105674,5.73967784 8.87862141,5.02482134 L8.87862141,5.02482134 L8.82825492,4.98654283 Z M13.7933062,2 C14.7073496,2.00009863 15.4482759,2.74110484 15.4482759,3.65514822 C15.4482759,4.32460943 15.0449926,4.92814782 14.4264842,5.18432286 C13.8079757,5.44049789 13.096053,5.29885769 12.6226979,4.82545158 C12.1493429,4.35204547 12.0077795,3.64010743 12.2640213,3.02162665 C12.5202631,2.40314587 13.123845,1.99992776 13.7933062,2 Z"/></svg><span>Answers</span></a></li><li class="flyout-parent"><a
                href="apa.html#"
                class="l1 nav-icn "
                
              ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>queue icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 29.2C25.4 29.2 25.8 29.1 26.1 28.9L48.7 16.8C49.5 16.4 50 15.5 50 14.6 50 13.7 49.5 12.8 48.7 12.4L26.1 0.3C25.4-0.1 24.6-0.1 23.9 0.3L1.3 12.4C0.5 12.8 0 13.7 0 14.6 0 15.5 0.5 16.4 1.3 16.8L23.9 28.9C24.2 29.1 24.6 29.2 25 29.2ZM7.3 14.6L25 5.2 42.7 14.6 25 24 7.3 14.6ZM48.7 22.4L47.7 21.9 25 34.2 2.3 21.9 1.3 22.4C0.5 22.9 0 23.7 0 24.7 0 25.6 0.5 26.5 1.3 26.9L23.9 39.3C24.2 39.5 24.6 39.6 25 39.6 25.4 39.6 25.8 39.5 26.1 39.3L48.7 26.9C49.5 26.5 50 25.6 50 24.7 50 23.7 49.5 22.9 48.7 22.4ZM48.7 32.8L47.7 32.3 25 44.6 2.3 32.3 1.3 32.8C0.5 33.3 0 34.1 0 35.1 0 36 0.5 36.9 1.3 37.3L23.9 49.7C24.2 49.9 24.6 50 25 50 25.4 50 25.8 49.9 26.1 49.7L48.7 37.3C49.5 36.9 50 36 50 35.1 50 34.1 49.5 33.3 48.7 32.8Z"/></g></svg><span>Explore</span></a><ul class="flyout"><li><a
                    href="https://learning.oreilly.com/topics/"
                    class="l2 nav-icn"
                    
                  ><span>All Topics</span></a></li><li><a
                    href="https://learning.oreilly.com/search/?query=&amp;extended_publisher_data=true&amp;highlight=true&amp;include_assessments=false&amp;include_case_studies=true&amp;include_courses=true&amp;include_orioles=true&amp;include_playlists=true&amp;include_collections=true&amp;include_notebooks=true&amp;is_academic_institution_account=false&amp;source=user&amp;formats=book&amp;formats=case%20study&amp;formats=learning%20path&amp;formats=live%20online%20training&amp;formats=notebook&amp;formats=oriole&amp;formats=video&amp;sort=popularity&amp;facet_json=true&amp;page=0&amp;collection_type=expert"
                    class="l2 nav-icn"
                    
                  ><span>Most Popular Titles</span></a></li><li><a
                    href="https://learning.oreilly.com/recommendations/"
                    class="l2 nav-icn"
                    
                  ><span>Recommended</span></a></li><li><a
                    href="https://learning.oreilly.com/search/?query=&amp;extended_publisher_data=true&amp;highlight=true&amp;include_assessments=false&amp;include_case_studies=true&amp;include_courses=true&amp;include_orioles=true&amp;include_playlists=true&amp;include_collections=true&amp;include_notebooks=true&amp;is_academic_institution_account=false&amp;source=user&amp;formats=book&amp;sort=publication_date&amp;facet_json=true&amp;page=0"
                    class="l2 nav-icn"
                    
                  ><span>Early Releases</span></a></li><li><a
                    href="https://learning.oreilly.com/playlists/discover/"
                    class="l2 nav-icn"
                    
                  ><span>Shared Playlists</span></a></li><li><a
                    href="https://learning.oreilly.com/resource-centers/"
                    class="l2 nav-icn"
                    
                  ><span>Resource Centers</span></a></li></ul></li><li class="flyout-parent"><a
                href="apa.html#"
                class="l1 nav-icn "
                
              ><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M12.8 3.2A1.2 1.2 0 0 1 14 4.4v8.4a1.2 1.2 0 0 1-1.2 1.2H3.2A1.2 1.2 0 0 1 2 12.8V4.4a1.2 1.2 0 0 1 1.2-1.2h1.2V2h1.2v1.2h4.8V2h1.2v1.2h1.2zm-9.6 9.6h9.6V6.2H3.2v6.6zM8 9.5a1.35 1.35 0 1 1 0-2.7 1.35 1.35 0 0 1 0 2.7zm2.7 2.148v.552H5.3v-.552c0-.321.124-.634.355-.858a3.358 3.358 0 0 1 4.69 0c.23.224.355.537.355.858z" /></svg><span>Live Events</span></a><ul class="flyout"><li><a
                    href="https://learning.oreilly.com/attend/"
                    class="l2 nav-icn"
                    
                  ><span>All Events</span></a></li><li><a
                    href="https://learning.oreilly.com/featured/architectural-katas/"
                    class="l2 nav-icn"
                    
                  ><span>Architectural Katas</span></a></li><li><a
                    href="https://learning.oreilly.com/featured/ai/"
                    class="l2 nav-icn"
                    
                  ><span>AI &amp; ML</span></a></li><li><a
                    href="https://learning.oreilly.com/featured/strata/"
                    class="l2 nav-icn"
                    
                  ><span>Data Sci &amp; Eng</span></a></li><li><a
                    href="https://learning.oreilly.com/featured/oscon/"
                    class="l2 nav-icn"
                    
                  ><span>Programming</span></a></li><li><a
                    href="https://learning.oreilly.com/featured/infrastructure-ops/"
                    class="l2 nav-icn"
                    
                  ><span>Infra &amp; Ops</span></a></li><li><a
                    href="https://learning.oreilly.com/featured/software-architecture/"
                    class="l2 nav-icn"
                    
                  ><span>Software Arch</span></a></li></ul></li><li class="flyout-parent"><a
                href="apa.html#"
                class="l1 nav-icn "
                
              ><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.6467109,4.35328907 L14.7964612,7.51003884 C15.0678463,7.78304342 15.0678463,8.22395603 14.7964612,8.49696061 L11.6467109,11.6467109 L10.6597892,10.6597892 L13.3055794,8 L10.6597892,5.34021084 L11.6467109,4.35328907 Z M4.35328907,11.6467109 L1.20353875,8.48996116 C0.932153749,8.21695658 0.932153749,7.77604397 1.20353875,7.50303939 L4.35328907,4.35328907 L5.34021084,5.34021084 L2.69442057,8 L5.34021084,10.6597892 L4.35328907,11.6467109 Z M5.84417089,11.4997226 L8.67194674,4.50027742 L10.1838269,4.50027742 L7.35605105,11.4997226 L5.84417089,11.4997226 Z" id="Mask"></path></svg><span>Interactive</span></a><ul class="flyout"><li><a
                    href="https://learning.oreilly.com/scenarios/?classification=content-scenario"
                    class="l2 nav-icn"
                    
                  ><span>Scenarios</span></a></li><li><a
                    href="https://learning.oreilly.com/scenarios/?classification=sandbox-scenario"
                    class="l2 nav-icn"
                    
                  ><span>Sandboxes</span></a></li><li><a
                    href="https://learning.oreilly.com/interactive/?classification=jupyter-notebook"
                    class="l2 nav-icn"
                    
                  ><span>Jupyter Notebooks</span></a></li></ul></li><li ><a
                href="https://learning.oreilly.com/certifications/"
                class="l1 nav-icn "
                
              ><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path d="M12.912 9.18L14 8.014l-1.088-1.18a.304.304 0 01-.075-.268L13.195 5l-1.535-.463a.313.313 0 01-.194-.194l-.462-1.537-1.565.358c-.09.03-.194 0-.269-.074L8.007 2 6.845 3.09a.303.303 0 01-.269.074l-1.565-.358-.462 1.537a.313.313 0 01-.194.194L2.82 5l.358 1.567a.26.26 0 01-.075.269L2 8.015l1.088 1.164c.075.075.09.18.075.269l-.358 1.567 1.535.463c.09.03.164.104.194.194l.462 1.537 1.565-.358c.015 0 .045-.015.075-.015.075 0 .15.03.209.074L8.007 14l1.163-1.09a.303.303 0 01.269-.074l1.565.358.462-1.537a.313.313 0 01.194-.194L13.195 11l-.358-1.567a.338.338 0 01.075-.254zm-6.046 1.37L4.41 8.26l1.16-1.244 1.767 1.649L10.4 5.6l1.202 1.202-4.242 4.243-.495-.495z"/></svg><span>Certifications</span></a></li><li ><a
                href="https://learning.oreilly.com/preferences/"
                class="l1 nav-icn "
                
              ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"/></g></svg><span>Settings</span></a></li><li ><a
                href="https://learning.oreilly.com/public/support/"
                class="l1 nav-icn "
                
              ><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M7.363 6.656a2.692 2.692 0 0 1-2.681-2.703c0-1.493 1.2-2.703 2.681-2.703a2.692 2.692 0 0 1 2.682 2.703c0 1.493-1.2 2.703-2.682 2.703zm4.023 2.027c-1.852 0-3.352 1.513-3.352 3.379H2v-1.534c-.006-.31.099-.612.295-.852a6.666 6.666 0 0 1 9.09-.993zm-.543.676h1.12v.304c.003.284.16.543.408.676a.766.766 0 0 0 .77 0l.303-.176.556.966-.302.176a.772.772 0 0 0-.362.676v.08a.772.772 0 0 0 .362.677l.302.21-.556.965-.302-.175a.766.766 0 0 0-.771 0 .778.778 0 0 0-.409.675v.352h-1.106v-.372a.778.778 0 0 0-.409-.676.766.766 0 0 0-.77 0l-.303.176-.556-.912.302-.176a.772.772 0 0 0 .362-.676v-.04-.04a.772.772 0 0 0-.362-.676l-.302-.176.556-.966.289.155a.766.766 0 0 0 .77 0 .778.778 0 0 0 .41-.676V9.36zm1.562 2.703c0-.271-.108-.531-.3-.722a1.001 1.001 0 0 0-.72-.292 1.01 1.01 0 0 0-.992 1.023 1.01 1.01 0 0 0 1.01 1.004 1.01 1.01 0 0 0 1.002-1.013z" /></svg><span>Support</span></a></li><li ><a
                href="https://get.oreilly.com/email-signup.html"
                class="l1 nav-icn "
                target=&quot;_blank&quot;
              ><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.564 2.263l2.172 2.174c.17.168.264.397.264.636V11a.6.6 0 0 1-.6.6h-.6V6.2h-6V2.6a.6.6 0 0 1 .6-.6h3.527c.239 0 .468.095.637.263zM2.6 14a.6.6 0 0 1-.6-.6V6.8a.6.6 0 0 1 .6-.6h1.903a1.2 1.2 0 0 1 .849.352L6.2 7.4H11a.6.6 0 0 1 .6.6v5.4a.6.6 0 0 1-.6.6H2.6zM11 5h1.8L11 3.2V5z" /></svg><span>Newsletters</span></a></li><li ><a
                href="https://learning.oreilly.com/accounts/logout/"
                class="l1 nav-icn "
                
              ><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M2.613 12.63A.607.607 0 0 1 2 12.03V3.602C2 3.269 2.274 3 2.613 3h5.515v1.204H3.226v7.223h4.902v1.203H2.613zM5.677 9.02V6.611h4.903V4.926a.301.301 0 0 1 .19-.274.31.31 0 0 1 .33.063l2.722 2.673a.594.594 0 0 1 0 .849L11.1 10.909a.31.31 0 0 1-.331.063.301.301 0 0 1-.19-.274V9.02H5.677z" /></svg><span>Sign Out</span></a></li></ul></div></li></ul></nav></header>



      </div>
      <div id="container" class="application">
        
          <div class="nav-container clearfix">
            


            
            
          </div>

          

  <div class="js-toc">
    
      <div class="sbo-reading-menu sbo-menu-top"><section class="sbo-toc-container toc-menu"><a href="apa.html#" class="sbo-toc-thumb"><span class="sbo-title ss-list"><h1><div class="visuallyhidden">Table of Contents for </div>
      
      Beginning Lua Programming
      
    </h1></span></a><div class="toc-contents"></div></section></div>

    

    <div class="interface-controls interface-controls-top">
      <ul class="interface-control-btns js-bitlist js-reader">
        <li class="js-search-in-archive search-in-archive t-search-in-archive"><a href="apa.html#" title="Search in archive" class="js-search-controls search-controls" onclick="window.Appcues.track('SearchBook_HeronBook')"><span class="icon">Search in book...</span></a><form class="search-archive-bar js-search-form"><input type="search" name="query" placeholder="Search inside this book..." autocomplete="off"></form><div class="search-archive-results"><div class="js-sitb-results-region"></div></div></li><li class="queue-control"><div class="js-content-uri" data-content-uri="/api/v1/book/9780470069172/chapter/apa.html"><div class="js-collections-dropdown collections-dropdown menu-bit-cards" onclick="window.Appcues.track('AddPlaylist_HeronBook')"></div></div></li><li class="js-font-control-panel font-control-activator"><a href="apa.html#" data-push-state="false" id="font-controls" title="Change font size" aria-label="Change font size" onclick="window.Appcues.track('ChangeFont_HeronBook')"><span class="icon">Toggle Font Controls</span></a></li><li class="dropdown sharing-controls"><a href="apa.html#" class="trigger" data-push-state="false" title="Share" aria-label="Share" onclick="window.Appcues.track('Share_HeronBook')"><i class="fa fa-share"></i></a><ul class="social-sharing dropdown-menu"><li><a
        class="twitter share-button t-twitter"
        target="_blank"
        aria-label="Share this section on Twitter"
        title="Share this section on Twitter"
      
        href="https://twitter.com/share?url=https://learning.oreilly.com/library/view/beginning-lua-programming/9780470069172/apa.html&text=Beginning%20Lua%20Programming&via=OReillyMedia"
      ><span>Twitter</span></a></li><li><a
        class="facebook share-button t-facebook"
        target="_blank"
        aria-label="Share this section on Facebook"
        title="Share this section on Facebook"
        href="https://www.facebook.com/sharer/sharer.php?u=https://learning.oreilly.com/library/view/beginning-lua-programming/9780470069172/apa.html"
      ><span>Facebook</span></a></li><li><a
        class="googleplus share-button t-googleplus"
        target="_blank"
        aria-label="Share this secton on Google Plus"
        title="Share this secton on Google Plus"
        href="https://plus.google.com/share?url=https://learning.oreilly.com/library/view/beginning-lua-programming/9780470069172/apa.html"
      ><span>Google Plus</span></a></li><li><a
        class="email share-button t-email"
        aria-label="Share this section via email"
        title="Share this section via email"
      
        href="mailto:?subject=Safari: A.%20Answers&body=https://learning.oreilly.com/library/view/beginning-lua-programming/9780470069172/apa.html%0D%0Afrom Beginning%20Lua%20Programming%0D%0A"
      ><span>Email</span></a></li></ul></li><!-- endif request.user.is_authenticated -->
      </ul>
    </div>

      
          
      

    <section role="document">
        
        




  <script defer src="https://learning.oreilly.com/static/js/build/djangoMessagesPage.bfaca9fd8619.js"></script>


        <script src="https://fast.appcues.com/48743.js"></script>
<script>
  var userId = "ce47de5b-ce80-49f0-b5cd-c60d3d33b198";

  var userObject = {
    firstName: "Michael",
    segment: "Trial",
    admin: "False",
    profileCreatedOn: "2021-05-13",
    academic: ""
  };
  window.Appcues.identify(userId, userObject);
  window.Appcues.page();

  setTimeout(function () {
    window.Appcues.track('ViewingBook_HeronBook')
  }, 20000);
</script>


	  <div class="t-sbo-prev sbo-prev sbo-nav-top">
  
    
      
        <a href="ch19.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">19. Fitting into the Lua Community</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-top">
  
  <span class="nav-link"></span>
  
  </div>



<div id="sbo-rt-content"><div class="appendix"><div class="titlepage"><div><div><h1 class="title"><a id="answers"></a>Appendix A. Answers</h1></div></div></div><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="chapter_2"></a><a class="link" href="ch02.html" title="Chapter 2. First Steps">Chapter 2</a></h1></div></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_1_solution"></a>Exercise 1 Solution</h2></div></div></div><p>Because the "p" in <code class="literal">print</code> needs to be lowercase.</p></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_2_solution"></a>Exercise 2 Solution</h2></div></div></div><pre class="programlisting">"ABC123"</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_3_solution"></a>Exercise 3 Solution</h2></div></div></div><p>Because it reduces to the following, and the attempt to concatenate a Boolean value will trigger an error:</p><pre class="programlisting">false .. 123</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_4_solution"></a>Exercise 4 Solution</h2></div></div></div><p>One (the first one). More than one branch of an <code class="literal">if</code> is never executed. The first branch when a true test expression is executed, and after that, the <code class="literal">if</code> is exited.</p></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_5_solution"></a>Exercise 5 Solution</h2></div></div></div><pre class="programlisting">for N = 10, 2, −2 do
  print(N)
end</pre></div></div><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="chapter_3"></a><a class="link" href="ch03.html" title="Chapter 3. Extending Lua with Functions">Chapter 3</a></h1></div></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_1_solution-067"></a>Exercise 1 Solution</h2></div></div></div><pre class="programlisting">function TypedToString(Val)
  return type(Val) .. ": " .. tostring(Val)
end</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_2_solution-068"></a>Exercise 2 Solution</h2></div></div></div><pre class="programlisting">function SumProd(A, B)
  return A + B, A * B
end</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_3_solution-069"></a>Exercise 3 Solution</h2></div></div></div><p>It will print the following:</p><pre class="programlisting">6       10      25</pre><p>(<code class="literal">SumProd(3, 3)</code> returns <code class="literal">6, 9</code>, which is adjusted to one value. <code class="literal">SumProd(5, 5)</code> returns <code class="literal">10, 25</code>, and both values are used.</p></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_4_solution-070"></a>Exercise 4 Solution</h2></div></div></div><p>It prints <code class="literal">North America</code>. (The <code class="literal">Continent</code> inside <code class="literal">F</code> is local—assigning to it has no effect on the global <code class="literal">Continent</code>.)</p></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_5_solution-071"></a>Exercise 5 Solution</h2></div></div></div><p>For the functions returned to be closures (and thus have private state), <code class="literal">Dots</code> needs to be local. Because it's global, all the functions returned share the same state, so they all do the same thing. The fix is simply this:</p><pre class="programlisting">function MakeDotter(N)
  local Dots = ""
  for I = 1, N do
    Dots = Dots .. "."
  end
  return function(Str)
    return Str .. Dots
  end
end</pre><div class="blockquote"><blockquote class="blockquote"><p>As mentioned earlier, forgetting to make a variable local is a common source of bugs.</p></blockquote></div></div></div><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="chapter_4"></a><a class="link" href="ch04.html" title="Chapter 4. Working with Tables">Chapter 4</a></h1></div></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_1_solution-072"></a>Exercise 1 Solution</h2></div></div></div><pre class="programlisting">C</pre><p>To figure this sort of thing out, work from left to right: figure out what <code class="literal">D</code> is, then what <code class="literal">D.C</code> is, and then what <code class="literal">D.C["B"]</code> is.</p></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_2_solution-073"></a>Exercise 2 Solution</h2></div></div></div><p>The main trick to this is to compare things other than numbers and strings by their <code class="literal">tostring</code> value, as follows:</p><pre class="programlisting">CompAll = function(A, B)
  if type(A) ~= type(B) then
    -- If they're of different types, sort them by type:
    A, B = type(A), type(B)
  elseif type(A) ~= "number" and type(A) ~= "string" then
    -- If they're something other than numbers or strings,
    -- sort them by their tostring representation:
    A, B = tostring(A), tostring(B)
  end
  return A &lt; B
end</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_3_solution-074"></a>Exercise 3 Solution</h2></div></div></div><p><code class="literal">table.concat</code> does most of the hard work:</p><pre class="programlisting">-- "String print" -- returns a string of the form output by
-- print:
function Sprint(...)
  local Args = {...}
  -- Using select and a numeric for makes sure that no nils
  -- are missed:
  local ArgCount = select("#", ...)
  for I = 1, ArgCount do
    Args[I] = tostring(Args[I])
  end
  return table.concat(Args, "\t") .. "\n"
end</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_4_solution-075"></a>Exercise 4 Solution</h2></div></div></div><pre class="programlisting">-- Rotates self N elements to the left:
function Methods:RotateL(N)
  N = N or 1
  if #self &gt; 0 then
    self.Pos = OneMod(self.Pos + N, #self)
  end
end</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_5_solution-076"></a>Exercise 5 Solution</h2></div></div></div><p>Here's one way to do it:</p><pre class="programlisting">function SortedPairs(Tbl)
  local Sorted = {} -- A (soon to be) sorted array of Tbl's keys.
  for Key in pairs(Tbl) do
    Sorted[#Sorted + 1] = Key -- Same as table.insert.
  end
  table.sort(Sorted, CompAll)
  local I = 0

  -- The iterator itself:
  return function()
    I = I + 1
    local Key = Sorted[I]
    return Key, Tbl[Key]
  end
end</pre></div></div><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="chapter_5"></a><a class="link" href="ch05.html" title="Chapter 5. Using Strings">Chapter 5</a></h1></div></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_1_solution-077"></a>Exercise 1 Solution</h2></div></div></div><pre class="programlisting">-- Returns an array of Str's characters:
function StrToArr(Str)
  local Ret = {}
  for I = 1, #Str do
    Ret[I] = string.sub(Str, I, I)
  end
  return Ret
end</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_2_solution-078"></a>Exercise 2 Solution</h2></div></div></div><pre class="programlisting">Frmt = "%6s\n"</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_3_solution-079"></a>Exercise 3 Solution</h2></div></div></div><pre class="programlisting">-- Does a "dictionary order" less-than comparison:
function DictCmp(A, B)
  -- "Fold" each argument by deleting all non-alphanumeric
  -- characters then lowercasing it:
  local FoldedA = string.lower(string.gsub(A, "%W+", ""))
  local FoldedB = string.lower(string.gsub(B, "%W+", ""))
  -- Only compare the folded versions if they're unequal:
  if FoldedA ~= FoldedB then
    return FoldedA &lt; FoldedB
  else
    return A &lt; B
  end
end</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_4_solution-080"></a>Exercise 4 Solution</h2></div></div></div><pre class="programlisting">-- Reads lines, evaluates them as expressions, prints the
-- results:
function ExprInterp()
  io.write("expression&gt; ")
  local Line = io.read()
  while Line and Line ~= "quit" do
    -- Convert the expression to a statement, convert the
    -- statement to a function, call the function, and print
    -- its results:
    Line = "return " .. Line
    local Fnc = loadstring(Line) -- Missing error check.
    print(Fnc()) -- Missing error check.
    io.write("expression&gt; ")
    Line = io.read()
  end
end</pre><p>It could also be written with <code class="literal">io.lines</code>, like this:</p><pre class="programlisting">function ExprInterp()
  io.write("expression&gt; ")
  for Line in io.lines() do
    if Line == "quit" then
      break -- QUIT.
    end
    -- Convert the expression to a statement, convert the
    -- statement to a function, call the function, and print
    -- its results:
    Line = "return " .. Line
    local Fnc = loadstring(Line) -- Missing error check.
    print(Fnc()) -- Missing error check.
    io.write("expression&gt; ")
  end
end</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_5_solution-081"></a>Exercise 5 Solution</h2></div></div></div><p>Here's one way to do it:</p><pre class="programlisting">-- Trims leading whitespace:
function TrimLeft(Str)
  return (string.gsub(Str, "^%s+", ""))
end</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_6_solution"></a>Exercise 6 Solution</h2></div></div></div><p>No. If there's whitespace starting at the subject's first character, it deletes it all and searches no more. If there's no whitespace there, it does nothing and searches no more.</p></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_7_solution"></a>Exercise 7 Solution</h2></div></div></div><pre class="programlisting">-- Turns $XYZ into the value of the global variable XYZ (XYZ
-- is any identifier):
function Interpolate(Str)
  return (string.gsub(Str, "%$([%a_][%w_]*)",
    function(Ident)
      return tostring(getfenv()[Ident])
    end))
end</pre></div></div><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="chapter_6"></a><a class="link" href="ch06.html" title="Chapter 6. Handling and Avoiding Errors">Chapter 6</a></h1></div></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_1_solution-082"></a>Exercise 1 Solution</h2></div></div></div><p>The <code class="literal">debug.traceback</code> function is called (by Lua) while setting up the arguments to <code class="literal">print</code>, which is before the <code class="literal">print</code> function is actually called.</p></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_2_solution-083"></a>Exercise 2 Solution</h2></div></div></div><p>Here is one way:</p><pre class="programlisting">debug._traceback = debug.traceback

debug.traceback = function(Str)
  return debug._traceback('Programmer error: ' .. Str)
end</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_3_solution-084"></a>Exercise 3 Solution</h2></div></div></div><pre class="programlisting">local function zpcall(Fnc, Err, ...)
  local Args = {...}
  local function Relay()
    return Fnc(unpack(Args))
  end
  return xpcall(Relay, Err)
end

-- Test

local function Fnc(A, B, C)
  print("Here in Fnc.", A, B, C)
  print(A + B + C)
end

print(zpcall(Fnc, debug.traceback, 1, nil, 3))</pre></div></div><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="chapter_7"></a><a class="link" href="ch07.html" title="Chapter 7. Using Modules">Chapter 7</a></h1></div></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_1_solution-085"></a>Exercise 1 Solution</h2></div></div></div><p>Here's one solution. Add the following line near the top of <code class="literal">show.lua</code>:</p><pre class="programlisting">local Object = Object or {}</pre><p>This assigns the local variable <code class="literal">Object</code> to a global value of that name if it exists; otherwise this assigns the variable to a newly created empty table.</p><p>Find this function header:</p><pre class="programlisting">function ObjectDescribe(Tbl, Val, Key, TruncLen)</pre><p>and change it to this:</p><pre class="programlisting">function Object.Describe(Tbl, Val, Key, TruncLen)</pre><p>Correspondingly, change <code class="literal">ObjectShow</code> to <code class="literal">Object.Show</code>, and <code class="literal">ObjectDescribe</code> to <code class="literal">Object.Describe</code>.</p><p>Finally, add the following to the bottom of the module:</p><pre class="programlisting">return Object</pre><p>This new version of <code class="literal">show.lua</code> can be used as follows:</p><pre class="programlisting">local Obj = require("show")

Obj.Show(_G, "_G")</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_2_solution-086"></a>Exercise 2 Solution</h2></div></div></div><p>The following error message is displayed:</p><pre class="programlisting">lua: nomod.lua:1: cannot find module xyz</pre><p>Lua first examines <code class="literal">"?.lua"</code>, replacing <code class="literal">"?"</code> with <code class="literal">"xyz"</code>. It doesn't find <code class="literal">xyz.lua</code>, so it then examines <code class="literal">"nomod.lua"</code>, replacing all occurrences of <code class="literal">"?"</code> with <code class="literal">"xyz"</code>. This results in <code class="literal">"nomod.lua"</code> (there are no <code class="literal">"?"</code> characters to replace), so it looks for <code class="literal">nomod.lua</code>, finds it, loads it, and runs it, resulting in the error message.</p><p>Note that Lua already has a superior mechanism to report an unfound module. The message it generates lists all of the filenames it attempted to locate before failing.</p></div></div><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="chapter_8"></a><a class="link" href="ch08.html" title="Chapter 8. Extending Lua's Behavior with Metamethods">Chapter 8</a></h1></div></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_1_solution-087"></a>Exercise 1 Solution</h2></div></div></div><pre class="programlisting">Meta = {
  -- Returns a reverse-order copy of an array:
  __unm = function(Arr)
    local Ret = {}
    for I = #Arr, 1, −1 do
      Ret[#Ret + 1] = Arr[I]
    end
    return Ret
  end}</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_2_solution-088"></a>Exercise 2 Solution</h2></div></div></div><pre class="programlisting">-- Makes Tbl read-only (and returns it):
function Protect(Tbl)
  -- Tbl will be used as a proxy table; transfer all its
  -- pairs to OrigTbl:
  local OrigTbl = {}
  for Key, Val in pairs(Tbl) do
    OrigTbl[Key] = Val
    Tbl[Key] = nil -- Clear the soon-to-be proxy.
  end
  -- __newindex prevents writes to the table; __index allows
  -- reads from the (original) table; __metatable prevents
  -- metatable trickery:
  local ProtectMeta = {
    __newindex = function()
      error("attempt to assign to a protected table")
    end,</pre><pre class="programlisting">__index = OrigTbl,
    __metatable = true}
  -- As well as setting Tbl's metatable, return it (for
  -- convenience):
  return setmetatable(Tbl, ProtectMeta)
end</pre><p>These techniques can be used to rewrite <code class="literal">ring.lua</code> (from <a class="link" href="ch04.html" title="Chapter 4. Working with Tables">Chapter 4</a>) to protect the object returned by <code class="literal">MakeRing</code> from tampering.</p></div></div><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="chapter_9"></a><a class="link" href="ch09.html" title="Chapter 9. Handling Events Naturally with Coroutines">Chapter 9</a></h1></div></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_1_solution-089"></a>Exercise 1 Solution</h2></div></div></div><p>The script prints this:</p><pre class="programlisting">0
1
1
2
3
5
8
13</pre><p>These are the first eight numbers in the number series named after Leonardo Fibonacci, the medieval Italian mathematician. Beginning with <code class="literal">0, 1</code>, each value is the sum of the two before it.</p></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_2_solution-090"></a>Exercise 2 Solution</h2></div></div></div><p>This is one solution:</p><pre class="programlisting">function JoinPairs(AList, BList)
  local function Iter()
    local Pos = 1
    local A, B = AList[Pos], BList[Pos]
    while A ~= nil and B ~= nil do
      coroutine.yield(A, B)
      Pos = Pos + 1
      A, B = AList[Pos], BList[Pos]
    end
  end
  return coroutine.wrap(Iter)
end</pre><p>Notice that the iterator is generic in the sense that it doesn't care what value or type each array element is.</p></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_3_solution-091"></a>Exercise 3 Solution</h2></div></div></div><p>Here is one solution:</p><pre class="programlisting">local function LclConsumer(Evt)
  print("Consumer: initialize")
  while Evt ~= "end" do
    print("Consumer: " .. Evt)
    Evt = coroutine.yield()
  end
  print("Consumer: finalize")
end

local function LclProducer()
  print("Producer: initialize")
  local PutEvent = coroutine.wrap(LclConsumer)
  -- Simulate event generation
  local List = {"mouse", "keyboard", "keyboard", "mouse"}
  for J, Val in ipairs(List) do
    local Evt = string.format("Event %d (%s)", J, Val)
    print("Producer: " .. Evt)
    PutEvent(Evt)
  end
  PutEvent("end")
  print("Producer: finalize")
end

LclProducer()</pre><p>Notice how little the overall structure of the program is changed from the original.</p></div></div><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="chapter_10"></a><a class="link" href="ch10.html" title="Chapter 10. Looking Under the Hood">Chapter 10</a></h1></div></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_1_solution-092"></a>Exercise 1 Solution</h2></div></div></div><p>Somehow, the character <code class="literal">"\27"</code> (an ASCII escape character) has been left at the beginning of the file, causing Lua to try (and fail) to treat it as bytecode.</p></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_2_solution-093"></a>Exercise 2 Solution</h2></div></div></div><p>This function boils down to: See if it's a local; if not, then see if it's an upvalue; if not, then see if it's a global. It's getting all the details right that's hard. Here they are:</p><pre class="programlisting">-- Gets the value of the named variable from its calling
-- scope:
function GetVar(Name)
  local CallerInfo = debug.getinfo(2, "uf")
  local Caller, Nups = CallerInfo.func, CallerInfo.nups
  local Found, FoundVal
  -- Look at the variables local to the caller; the last hit
  -- (if any) will be the desired one:
  local LclIndex = 1
  local Loop = true
  while Loop do
    local MaybeName, MaybeVal = debug.getlocal(2, LclIndex)</pre><pre class="programlisting">if MaybeName then
      if MaybeName == Name then
        -- Found one hit (of possibly several):
        Found, FoundVal = true, MaybeVal
      end
      LclIndex = LclIndex + 1
    else
      -- No more locals; break the loop:
      Loop = false
    end
  end
  -- If it wasn't found as a local, search the caller's
  -- upvalues:
  if not Found then
    for UpIndex = 1, Nups do
      local MaybeName, MaybeVal = debug.getupvalue(Caller,
        UpIndex)
      if MaybeName == Name then
        -- FOUND IT! -- RECORD THE VALUE AND BREAK THE LOOP:
        Found, FoundVal = true, MaybeVal
        break
      end
    end
  end
  -- If it wasn't found as either a local or an upvalue, get
  -- it as a global (from the caller's environment):
  if not Found then
    FoundVal = getfenv(2)[Name]
  end
  return FoundVal
end</pre></div></div><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="chapter_12"></a><a class="link" href="ch12.html" title="Chapter 12. Using Community Libraries">Chapter 12</a></h1></div></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_1_solution-094"></a>Exercise 1 Solution</h2></div></div></div><p>The following script is one solution.</p><pre class="programlisting">require "sqlite3"

local Cn = {}
Cn.DbStr = "test.db"
Cn.InitStr = [[
  BEGIN TRANSACTION;
  DROP TABLE IF EXISTS T1;
  CREATE TABLE T1(A, B, C);
  INSERT INTO T1 VALUES (12, 91, 40);
  INSERT INTO T1 VALUES (27, 79,  5);
  INSERT INTO T1 VALUES (32, 66, 53);
  END TRANSACTION;
]]

local DbHnd, ErrStr = sqlite3.open(Cn.DbStr)</pre><pre class="programlisting">if DbHnd then
  if DbHnd:exec(Cn.InitStr) then
    DbHnd:set_function("format", −1, string.format)
    print(DbHnd:first_cols("SELECT FORMAT('%05d %05d', 12, 34)"))
    for Row in DbHnd:rows("SELECT FORMAT('A %05d, B %05d, C %05d', A, B, C) " ..
      "AS Rec FROM T1") do
      print(Row.Rec)
    end
  else
    io.write("Error initializing ", Cn.DbStr, "\n")
  end
  DbHnd:close()
else
  io.write("Error opening ", Cn.DbStr, ": ", tostring(ErrStr), "\n")
end</pre><p>This simply registers <code class="literal">string.format</code> as a SQLite multivalue query function. The −1 value indicates a variable number of arguments. The <code class="literal">string.format</code> function meets the criteria for a <code class="literal">lua-sqlite3</code> user function, so it didn't need to be wrapped in a user-written function.</p></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_2_solution-095"></a>Exercise 2 Solution</h2></div></div></div><p>Copy the following script to a file named <code class="literal">pngchunk.lua</code>:</p><pre class="programlisting">require "pack"

local PngFileStr = arg[1] or "logo.png"

local function LclFileGet(FileStr)
  local Str
  local Hnd, ErrStr = io.open(FileStr, "rb")
  if Hnd then
    Str = Hnd:read("*all")
    Hnd:close()
  end
  return Str, ErrStr
end

local function printf(FrmtStr, ...)
  io.write(string.format(FrmtStr, ...))
end

local PngStr, ErrStr = LclFileGet(PngFileStr)
if PngStr then
  local PngSize = string.len(PngStr)
  local DataLen, DataStr, HdrStr, Crc
  -- Documented PNG signature
  local SignatureStr = string.char(137, 80, 78, 71, 13, 10, 26, 10)
  local Pos = string.len(SignatureStr)
  if SignatureStr == string.sub(PngStr, 1, Pos) then
    Pos = Pos + 1
    printf("Header Length  CRC\n")
    printf("------ ------  ----------\n")</pre><pre class="programlisting">while Pos and Pos &lt; PngSize do
      Pos, DataLen, HdrStr = string.unpack(PngStr, "&gt;LA4", Pos)
      if Pos then
        -- print("unpack_1", Pos, DataLen, HdrStr)
        if DataLen &gt; 0 then
          Pos, DataStr, Crc = string.unpack(PngStr, "&gt;A" .. DataLen .. "L", Pos)
        else
          Pos, Crc = string.unpack(PngStr, "&gt;L", Pos)
          DataStr = ""
        end
        -- print("unpack_2", Frmt, Pos, string.len(DataStr), Crc)
        if Pos then
          printf("%s %8u  0x%08X\n", HdrStr, DataLen, Crc)
          if HdrStr == "IEND" then
            Pos = nil -- End of loop
          end
        end
      end
    end
  else
    io.write("Error: ", PngFileStr, " does not have expected signature\n")
  end
else
  io.write("Error: ", ErrStr, "\n")
end</pre><p>Pass the name of the PNG file as an argument to the script. For example, if the PNG file you want to summarize is named <code class="literal">chart.png</code>, run the script as follows:</p><pre class="programlisting">lua pngchunk.lua chart.png</pre><p>Note that this script actually reads each chunk's data field. To do this, it uses the <code class="literal">A</code> specifier concatenated with the data length. It implements a special case for zero-length data fields. An alternative method is to read the data length and chunk header fields in the first call to <code class="literal">string.unpack</code>, adjust the starting position value based on the data length, and call <code class="literal">string.unpack</code> again to retrieve the CRC field.</p></div></div><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="chapter_13"></a><a class="link" href="ch13.html" title="Chapter 13. Interfacing Lua with Other Languages">Chapter 13</a></h1></div></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_1_solution-096"></a>Exercise 1 Solution</h2></div></div></div><p>In the <code class="literal">luaopen_ud_example</code> function in <code class="literal">ud_example.c</code>, copy the following lines from the <code class="literal">MetaMap</code> array and place them unmodified into the <code class="literal">Map</code> array:</p><pre class="programlisting">{"close", LclExampleClose},
{"get", LclExampleGet},
{"set", LclExampleSet},</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_2_solution-097"></a>Exercise 2 Solution</h2></div></div></div><p>Here is the code with possible comments:</p><pre class="programlisting">// Stk: ...
lua_newtable(L);
// Stk: ... Namespace
lua_newtable(L);
// Stk: ... Namespace Upvalue
lua_pushstring(L, "Rip Van Winkle");
// Stk: ... Namespace Upvalue NameStr
lua_setfield(L, −2, "Name");
// Stk: ... Namespace Upvalue
lua_pushvalue(L, −1);
// Stk: ... Namespace Upvalue Upvalue
lua_pushcclosure(L, FncA, 1);
// Stk: ... Namespace Upvalue FncA
lua_setfield(L, −3, "a");
// Stk: ... Namespace Upvalue
lua_pushcclosure(L, FncB, 1);
// Stk: ... Namespace FncB
lua_setfield(L, −2, "b");
// Stk: ... Namespace
lua_pushvalue(L, −1);
// Stk: ... Namespace Namespace
lua_setglobal(L, "test");
// Stk: ... Namespace</pre><p>The code creates a global namespace table called <code class="literal">test</code> that includes two functions: <code class="literal">"a"</code> and <code class="literal">"b"</code>. Each of these functions has one upvalue: a table that is accessible only to the two functions. Inside this table is the string <code class="literal">"Rip Van Winkle"</code> keyed by the string <code class="literal">"Name"</code>. The namespace table is left on the stack as a possible return value.</p></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_3_solution-098"></a>Exercise 3 Solution</h2></div></div></div><p>Here is one possible solution:</p><pre class="programlisting">#include "lua.h"
#include "lualib.h"
#include "lauxlib.h"

/* * */

static int BitOr(
  lua_State *L)

{ // BitOr
  int Val, J, Top;

  Top = lua_gettop(L);
  Val = 0;
  for (J = 1; J &lt;= Top; J++) Val |= luaL_checkinteger(L, J);
  lua_pushinteger(L, Val);
  return 1;
} // BitOr

/* * */

static int BitAnd(</pre><pre class="programlisting">lua_State *L)

{ // BitAnd
  int Val, J, Top;

  Top = lua_gettop(L);
  Val = Top &gt; 0 ? −1 : 0;
  for (J = 1; J &lt;= Top; J++) Val &amp;= luaL_checkinteger(L, J);
  lua_pushinteger(L, Val);
  return 1;
} // BitAnd

/* * */

int luaopen_bit(
  lua_State *L)

{ // luaopen_bit
  static const luaL_reg Map[] = {
    {"_and",  BitAnd},
    {"and",  BitAnd},
    {"_or",  BitOr},
    {"or",  BitOr},
    {NULL, NULL}
  };

  luaL_register(L, "bit", Map);
  return 1;
} // luaopen_bit</pre></div></div><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="chapter_14"></a><a class="link" href="ch14.html" title="Chapter 14. Managing Information with Databases">Chapter 14</a></h1></div></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_1_solution-099"></a>Exercise 1 Solution</h2></div></div></div><pre class="programlisting">-- Converts a cursor to an array of associative tables:
function CursorToTbl(Cursor)
  local Ret = {}

  -- A wrapper for Cursor:fetch that lets it return a table
  -- without being given one:
  local function RowsIter()
    local Row = {}
    return Cursor:fetch(Row, "a") -- alphanumeric/associative
  end

  -- Get each row:
  for Row in RowsIter do
    table.insert(Ret, Row)
  end
  Cursor:close()
  return Ret
end</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_2_solution-100"></a>Exercise 2 Solution</h2></div></div></div><p>All three tables have an <code class="literal">Id</code> column. The database system doesn't know which one you want, so it returns the error message <code class="literal">Column 'Id' in field list is ambiguous</code>. You can fix this by specifying the following table:</p><pre class="programlisting">SELECT Ord.Id, CustId, NameLast, ProductId, DescStr, Count
FROM Cust, Ord, Product
WHERE Cust.Id = Ord.CustId
  AND Ord.ProductId = Product.Id</pre><p>The column will still be called <code class="literal">"Id"</code> (not <code class="literal">"Ord.Id"</code>) in the result. SQL offers a way to make it appear under another name—the <code class="literal">AS</code> keyword:</p><pre class="programlisting">SELECT Ord.Id AS OrdId, CustId, NameLast, ProductId, DescStr, Count
FROM Cust, Ord, Product
WHERE Cust.Id = Ord.CustId
  AND Ord.ProductId = Product.Id</pre><p>That gives the following result:</p><pre class="programlisting">OrdId  CustId  NameLast  ProductId  DescStr          Count
-----  ------  --------  ---------  ---------------  -----
    6       2  Finn              4  thingamajig          2
    1       3  Darcy             2  gizmo               52
    2       3  Darcy             4  thingamajig         87
    3       4  Bennet            1  whatchamacallit     12
    4       4  Bennet            3  gewgaw               8
    5       4  Bennet            5  widget              20</pre></div></div><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="chapter_15"></a><a class="link" href="ch15.html" title="Chapter 15. Programming for the Web">Chapter 15</a></h1></div></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_1_solution-101"></a>Exercise 1 Solution</h2></div></div></div><p>Save the following file as <code class="literal">ex1.lua</code> in your web server's <code class="literal">cgi-bin</code> directory:</p><pre class="programlisting">#!/usr/local/bin/lua

local Cgi = require("cgi")

local Cn = {}

Cn.HdrStr = [[Content-Type: text/html

&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"&gt;

&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;Greeting&lt;/title&gt;
  &lt;link rel="stylesheet" href="/css/general.css" type="text/css" /&gt;
&lt;/head&gt;</pre><pre class="programlisting">&lt;body&gt;

]]

Cn.FtrStr = "&lt;/body&gt;\n\n&lt;/html&gt;"

local Rec = os.date("*t")
local Hr = Rec.hour
local Str
if Hr &gt;= 3 then
  if Hr &gt;= 12 then
    if Hr &gt;= 18 then
      Str = "Good evening"
    else
      Str = "Good afternoon"
    end
  else
    Str = "Good morning"
  end
else
  Str = "Good night"
end
local Prm = Cgi.Params()
Str = Str .. ", " .. (Prm.Get.Name or "Unknown user") .. "!"
io.write(Cn.HdrStr, '&lt;p class="hdr shade"&gt;', Cgi.Escape(Str), '&lt;/p&gt;', Cn.FtrStr)</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_2_solution-102"></a>Exercise 2 Solution</h2></div></div></div><p>This solution calls the CGI script from the previous exercise using the <code class="literal">GET</code> method. Save the following file as <code class="literal">ex2.html</code> in your web server's document root directory:</p><pre class="programlisting">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"&gt;

&lt;html&gt;

&lt;head&gt;
  &lt;title&gt;Greeting Form&lt;/title&gt;
  &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;
  &lt;link rel="stylesheet" href="/css/general.css" type="text/css" /&gt;
&lt;/head&gt;

&lt;body&gt;
  &lt;h1&gt;Greeting Form&lt;/h1&gt;
  &lt;form action="/cgi-bin/ex1.lua" method="get"&gt;
  &lt;table class="shade" summary=""&gt;&lt;tbody&gt;
  &lt;tr&gt;
  &lt;td class="label"&gt;Name&lt;/td&gt;
  &lt;td&gt;&lt;input type="text" size="20" name="Name" /&gt;&lt;/td&gt;
  &lt;td&gt;&lt;input type="submit" value="Submit" /&gt;&lt;/td&gt;
  &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;/table&gt;
  &lt;/form&gt;
&lt;/body&gt;

&lt;/html&gt;</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_3_solution-103"></a>Exercise 3 Solution</h2></div></div></div><p>Here is one solution. It uses one CGI script handle both the request form and the calendar presentation. Save the following file as <code class="literal">ex3.lua</code> in your web server's <code class="literal">cgi-bin</code> directory:</p><pre class="programlisting">#!/usr/local/bin/lua

local Cgi = require("cgi")

local Cn = {}

Cn.HdrStr = [[Content-Type: text/html

&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"&gt;

&lt;html&gt;

&lt;head&gt;

  &lt;title&gt;Calendar&lt;/title&gt;

  &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;

  &lt;link rel="stylesheet" href="/css/general.css" type="text/css" /&gt;

  &lt;style type="text/css"&gt;

  table.data td {border-right : 1px solid; border-bottom : 1px solid;
  border-color:inherit; color:#404040; background-color:#FFFFFF;
  vertical-align:top; width:14%;}

  table.data td.today {background-color:#f0f0ff;}

  table.data td.name {font-weight:bold; text-align:center; color:#505060;
  background-color:#f0f0ff;}

  table.data td.edge {width:15%;}

  &lt;/style&gt;

&lt;/head&gt;

&lt;body&gt;

]]

Cn.FtrStr = "&lt;/body&gt;\n\n&lt;/html&gt;"

local function CalendarShow(Year, Month)

  local DaysInMonth = { 31, 0, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 }

  -- For the specified month and year, this function returns the day of week of
  -- the first day in the month, and the number of days in the month.

  local function Calendar(Year, Month)</pre><pre class="programlisting">assert(Year &gt; 1900 and Year &lt; 2100, "Year out of range")
    assert(Month &gt;= 1 and Month &lt;= 12, "Month out of range")
    local Rec = os.date("*t", os.time{year = Year, month = Month, day = 1})
    local DayMax = DaysInMonth[Rec.month]
    if DayMax == 0 then
      DayMax = math.mod(Rec.year, 4) == 0 and 29 or 28
    end
    return Rec.wday, DayMax
  end

  local Dow, DayMax = Calendar(Year, Month)

  io.write(Cn.HdrStr)

  io.write('&lt;table class="data shade" border="0" cellspacing="0" ',
    'cellpadding="5" summary="" width="100%"&gt;\n',
    '&lt;tbody&gt;\n',
    '&lt;tr&gt;&lt;th colspan="7"&gt;', os.date('%B %Y', os.time{year = Year,
      month = Month, day = 1}), '&lt;/th&gt;&lt;/tr&gt;\n',
    '&lt;tr&gt;\n')
  local Base = 8 - Dow
  for Col = 1, 7 do
    local Wd = (Col == 1 or Col == 7) and ' edge' or ''
    io.write('&lt;td class="name', Wd, '"&gt;', os.date("%a",
      os.time{year = Year, month = Month, day = Base + Col}),
      '&lt;/td&gt;\n')
  end
  io.write('&lt;/tr&gt;\n')
  local Day = 2 - Dow
  while Day &lt;= DayMax do
    io.write('&lt;tr&gt;')
    for Col = 1, 7 do
      io.write('&lt;td&gt;', (Day &gt;= 1 and Day &lt;= DayMax) and Day or '&amp;nbsp;',
        '&lt;/td&gt;\n')
      Day = Day + 1
    end
    io.write("&lt;/tr&gt;\n")
  end
  io.write('&lt;/tbody&gt;&lt;/table&gt;\n')
  io.write(Cn.FtrStr)

end

local function CalendarRequest(ScriptStr)
  io.write(Cn.HdrStr, '&lt;h1&gt;Calendar Request&lt;/h1&gt;\n',
    '&lt;form action="', ScriptStr, '" method="get"&gt;\n',
    '&lt;table class="shade" summary=""&gt;&lt;tbody&gt;\n',
    '&lt;tr&gt;\n',
    '&lt;td class="label"&gt;Month&lt;/td&gt;\n',
    '&lt;td&gt;\n',</pre><pre class="programlisting">'&lt;select name="Month" size="1"&gt;\n')
  local Today = os.date("*t")
  for J = 1, 12 do
    local AttrStr = Today.month == J and ' selected="selected"' or ""
    local MonthStr = os.date("%B", os.time{year=2000, month=J, day = 1})
    io.write('&lt;option', AttrStr, ' value="', J, '"&gt;', MonthStr, '&lt;/option&gt;\n')
  end
  io.write('&lt;/select&gt;\n',
    '&lt;/td&gt;\n',
    '&lt;td class="label"&gt;Year&lt;/td&gt;\n',
    '&lt;td&gt;\n',
    '&lt;select name="Year" size="1"&gt;\n')
  for J = Today.year - 12, Today.year + 12 do
    local AttrStr = Today.year == J and ' selected="selected"' or ""
    io.write('&lt;option', AttrStr, ' value="', J, '"&gt;', J, '&lt;/option&gt;\n')
  end
  io.write('&lt;/select&gt;\n',
    '&lt;/td&gt;\n',
    '&lt;td&gt;&lt;input type="submit" value="Submit" /&gt;&lt;/td&gt;\n',
    '&lt;/tr&gt;\n',
    '&lt;/tbody&gt;&lt;/table&gt;\n',
    '&lt;/form&gt;\n',
    Cn.FtrStr)
end

-- If UserMonth and UserYear were passed in and are valid, present the
-- requested calendar, otherwise present a request form.

local Prm = Cgi.Params()
local UserMonth, UserYear
local ShowForm = true
UserMonth = tonumber(Prm.Get.Month)
if UserMonth and UserMonth &gt;= 1 and UserMonth &lt;= 12 then
  UserYear = tonumber(Prm.Get.Year)
  if UserYear and UserYear &gt;= 1970 and UserYear &lt; 2038 then
    ShowForm = false
  end
end

if ShowForm then
  if Prm.SCRIPT_NAME then
    CalendarRequest(Prm.SCRIPT_NAME)
  else
    io.write(Cn.HdrStr, "&lt;p&gt;Error: could not determine name of script.&lt;/p&gt;\n",
      Cn.FtrStr)
  end
else
  CalendarShow(UserYear, UserMonth)
end</pre></div></div><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="chapter_16"></a><a class="link" href="ch16.html" title="Chapter 16. Connecting to a Larger World">Chapter 16</a></h1></div></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_1_solution-104"></a>Exercise 1 Solution</h2></div></div></div><p>The following is one of many possible solutions:</p><pre class="programlisting">local ltn12 = require("ltn12")

local function Transform(Str, ...)
  -- Source is specified string
  local Src = ltn12.source.string(Str)
  -- Chain all specified filters into one
  local Filter = ltn12.filter.chain(...)
  -- Send all data chunks to table
  local Snk, Tbl = ltn12.sink.table()
  -- Filter chunks before delivering to sink
  Snk = ltn12.sink.chain(Filter, Snk)
  -- Open the valve
  local Code, ErrStr = ltn12.pump.all(Src, Snk)
  return Code and table.concat(Tbl) or nil, ErrStr
end

-- Return the rot13 cipher of the character Ch

local function Rot13Char(Ch)
  local Val = string.byte(Ch)
  return string.char(Val &lt; 65 and Val or
    Val &lt; 78 and Val + 13 or
    Val &lt; 91 and Val - 13 or
    Val &lt; 97 and Val or
    Val &lt; 110 and Val + 13 or
    Val &lt; 123 and Val - 13 or Val)
end

-- Filter that returns a rot13 cipher of the string Str

local function Rot13(Str)
  return Str and string.gsub(Str, "(%a)", Rot13Char)
end

local Str = "The quick brown fox jumps over the lazy dog"
local CnvStr = Transform(Str, Rot13)
io.write(Str, "\n", CnvStr, "\n",
  Str == Transform(CnvStr, Rot13) and "OK" or "Not OK", "\n",
  Str == Transform(Str, Rot13, Rot13) and "OK" or "Not OK", "\n")</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_2_solution-105"></a>Exercise 2 Solution</h2></div></div></div><p>The following is a possible solution:</p><pre class="programlisting">local function LclBodyPrint(PopHnd, Pos)
  local Str, Tbl
  Str, Tbl = LclTransact(PopHnd, "retr " .. Pos, true)</pre><pre class="programlisting">if Str then
    io.write(Str, "\n")
    local Show
    for K, Str in ipairs(Tbl) do
      if Show then
        io.write(Str, "\n")
      elseif Str == "" then
        Show = true
      end
    end
  else
    io.write('Error: ', Tbl, "\n") -- Tbl is error message
  end
end</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_3_solution-106"></a>Exercise 3 Solution</h2></div></div></div><p>The following script sends three lines, displays the echoed response, and sends an empty string to terminate the session:</p><pre class="programlisting">local socket = require("socket")

local Cn = {SrvPort = 23032, SrvAddr = "localhost"}

local SckHnd = socket.connect(Cn.SrvAddr, Cn.SrvPort)
if SckHnd then
  local RcvStr, ErrStr = SckHnd:receive()
  if RcvStr then
    io.write(RcvStr, "\n")
    local SendList = {"One", "Two", "Three", ""}
    for J, Str in ipairs(SendList) do
      SckHnd:send(Str .. "\r\n")
      local RcvStr, ErrStr = SckHnd:receive()
      if RcvStr then
        io.write(RcvStr, "\n")
      elseif ErrStr ~= "closed" then
        io.write("Error: ", ErrStr, "\n")
      end
    end
  else
    io.write("Error: ", ErrStr, "\n")
  end
  SckHnd:close()
else
  io.write("Error creating client socket\n")
end</pre></div></div><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="chapter_17"></a><a class="link" href="ch17.html" title="Chapter 17. Programming Games with Lua">Chapter 17</a></h1></div></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_solution"></a>Exercise Solution</h2></div></div></div><p>It displays a 4×4 grid of goodies and baddies in random order.</p></div></div><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="chapter_18"></a><a class="link" href="ch18.html" title="Chapter 18. Carrying Lua with You">Chapter 18</a></h1></div></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_1_solution-107"></a>Exercise 1 Solution</h2></div></div></div><p>Here is one solution:</p><pre class="programlisting">-- star.lua

screen.clear()
local Wd, Ht = screen.mode()
gui.title("Star")
local X, Y = screen.pos()
screen.moveto(Wd / 2, Y + Ht / 10)
screen.heading(252)
for J = 1, 5 do
  screen.walk(2 * Wd / 3)
  screen.turn(144)
end
gui.event()</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_2_solution-108"></a>Exercise 2 Solution</h2></div></div></div><p>A possible solution is as follows:</p><pre class="programlisting">-- lua_expr.lua

screen.clear()
gui.title("Lua expression")
local X, Y
local Wd, Ht = screen.mode()
gui.label("Lua expression")
gui.nl()
local CtlExpr = gui.control{type = "field", lines = 1, columns = 24,
  limit = 256, editable = true, underlined = true}
local CtlGo = gui.control{type = "button", text = "Go"}
gui.nl()
gui.label("Result")
gui.nl()
local CtlResult = gui.control{type = "field", lines = 1, columns = 28,
  limit = 256, editable = false, underlined = false}
gui.setfocus(CtlExpr)
local Loop = true
while Loop do
  local Evt, Id = gui.event()
  if Evt == appStop then
    Loop = false
  elseif Evt == ctlSelect then
    if Id == CtlGo then
      local Fnc
      local Str = gui.gettext(CtlExpr)
      if string.len(Str) &gt; 0 then
        Fnc, Str = loadstring("return tostring(" .. Str .. ")")
        if Fnc then
          local Status</pre><pre class="programlisting">Status, Str = pcall(Fnc)
        end
        gui.settext(CtlResult, tostring(Str))
      end
    end
  end
end</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="exercise_3_solution-109"></a>Exercise 3 Solution</h2></div></div></div><p>Here is a solution:</p><pre class="programlisting">-- barchart.lua

function Barchart(TitleStr, Tbl)
  local Count = table.getn(Tbl) -- Lua 5.0
  if Count &gt; 0 then
    local ScrWd, ScrHt, ScrDepth = screen.mode()
    local ScrBase = ScrWd / 160
    screen.clear()
    gui.title(TitleStr)
    local X, Top = screen.pos()
    local BarWd, GapHrz, GapVrt = 3, 3, 4 * ScrBase
    if Count * (BarWd + GapHrz) - GapHrz &lt;= ScrWd then
      BarWd = math.floor((ScrWd + GapHrz - (Count * GapHrz)) / Count)
      local Lf = math.floor((ScrWd + GapHrz - Count * (BarWd + GapHrz)) / 2)
      local Max = Tbl[1]
      for J, Val in ipairs(Tbl) do
        if Val &gt; Max then
          Max = Val
        end
      end
      if Max &gt; 0 then
        local Mlt = (ScrHt - Top - GapVrt - GapVrt) / Max
        local Clr = screen.rgb(128, 128, 128)
        X = Lf
        for J, Val in ipairs(Tbl) do
          local Ht = math.floor(Val * Mlt)
          screen.box(X, ScrHt - GapVrt - Ht, BarWd, Ht, Clr)
          X = X + BarWd + GapHrz
        end
        gui.event()
      else
        gui.alert("Values must be positive")
      end
    else
      gui.alert("Too many elements")
    end
  else
    gui.alert("Table is empty")
  end
end

Barchart("Example", {12, 34, 23, 25, 67, 45, 23, 7, 5, 54, 48, 50})</pre><p>Nice extensions to this routine would include the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Bar colors</p></li><li class="listitem"><p>Interactive use, in which tapping a bar would result in detail information for the corresponding value</p></li><li class="listitem"><p>A scale</p></li></ul></div></div></div></div></div>



  <div class="t-sbo-prev sbo-prev sbo-nav-bottom">
  
    
      
        <a href="ch19.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">19. Fitting into the Lua Community</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-bottom">
  
  <span class="nav-link"></span>
  
  </div>


        
    </section>
  </div>
<section class="sbo-saved-archives"></section>



          
          
  




    
    
      <div id="js-subscribe-nag" class="subscribe-nag clearfix trial-panel t-subscribe-nag">
        
        

        
          <p>You have 6 days left in your trial, Michaelschiner. Subscribe today. <a href="https://learning.oreilly.com/subscribe/" class="ga-active-trial-subscribe-nag">See pricing options.</a></p>
        
        

      </div>

    
    



        
      </div>
      
        

<footer class="pagefoot t-pagefoot">
  <a href="apa.html#" class="icon-up" onclick="window.Appcues.track('JumpTop_HeronBook')"><div class="visuallyhidden">Back to top</div></a>
  <ul class='js-footer-nav'>
  
    
    <li><a href="https://learning.oreilly.com/public/support/">Support</a></li>
    
    <li><a href="https://learning.oreilly.com/accounts/logout/">Sign Out</a></li>
    
  
  
  </ul>
  <span class="copyright">&#169; 2021 <a href="https://learning.oreilly.com/" target="_blank">O'Reilly Media, Inc</a>.</span>
  
    
    <a href="https://www.oreilly.com/terms/">Terms of Service</a> 
     / 
    
    <a href="https://learning.oreilly.com/privacy">Privacy Policy</a> 
    
    
  
</footer>

      
    
    <script src="https://learning.oreilly.com/jsi18n/web/" charset="utf-8"></script>
    <script src="https://learning.oreilly.com/library/jsi18n/appcache/" charset="utf-8"></script>
  </body>
</html>
